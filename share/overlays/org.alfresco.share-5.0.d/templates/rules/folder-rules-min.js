(function(){var d=YAHOO.util.Dom;Alfresco.FolderRules=function g(){Alfresco.FolderRules.superclass.constructor.call(this,"Alfresco.FolderRules",null,["button"]);YAHOO.Bubbling.on("rulesCopiedFrom",this.onRulesCopiedFrom,this);YAHOO.Bubbling.on("rulesLinkedTo",this.onRulesLinkedTo,this);YAHOO.Bubbling.on("folderRulesetDetailsAvailable",this.onFolderRulesetDetailsAvailable,this);YAHOO.Bubbling.on("folderRulesDetailsChanged",this.onFolderRulesDetailsChanged,this);YAHOO.Bubbling.on("inheritChange",this.onInheritChange,this);return this};YAHOO.extend(Alfresco.FolderRules,Alfresco.component.Base,{options:{nodeRef:null,siteId:"",folderName:"",pathToFolder:"",ruleset:null},onComponentsLoaded:function c(){YAHOO.util.Event.onDOMReady(this.onReady,this,true)},onReady:function i(){this.widgets.inheritedRulesList=d.get("inherited-rules-container");YAHOO.Bubbling.fire("folderDetailsAvailable",{folderDetails:{nodeRef:this.options.nodeRef.toString(),location:{path:this.options.folder.path,file:this.options.folder.name},fileName:this.options.folder.name,type:"folder"}});if(this.options.linkedToFolder){YAHOO.Bubbling.fire("linkedToFolderDetailsAvailable",{linkedToFolder:this.options.linkedToFolder})}this._fireFolderRulesetDetailsAvailable();this._displayInheritedRules()},onRulesCopiedFrom:function k(m,l){document.location.reload()},onRulesLinkedTo:function j(m,l){document.location.reload()},onFolderRulesetDetailsAvailable:function h(n,m){var l=m[1].folderRulesetDetails;if(this.options.ruleset.linkedToRuleSet!=l.linkedToRuleSet||!this.options.ruleset.rules&&l.rules||this.options.ruleset.rules&&!l.rules){document.location.reload()}},_displayInheritedRules:function f(m,l){var n=this.options.ruleset?this.options.ruleset.inheritedRules:null;if(n&&n.length>0){d.removeClass(this.widgets.inheritedRulesList,"hidden")}else{d.addClass(this.widgets.inheritedRulesList,"hidden")}},onInheritChange:function b(m,l){window.location.reload()},onFolderRulesDetailsChanged:function a(n,l){var m=this.options.ruleset&&this.options.ruleset.rules?this.options.ruleset.rules.length:0;Alfresco.util.Ajax.jsonGet({url:Alfresco.constants.PROXY_URI_RELATIVE+"api/node/"+this.options.nodeRef.uri+"/ruleset",successCallback:{fn:function(o,q){if(o.json){this.options.ruleset=o.json.data;this._fireFolderRulesetDetailsAvailable();var p=this.options.ruleset&&this.options.ruleset.rules?this.options.ruleset.rules.length:0;if((p==0&&q!=0)||(p!=0&&q==0)){window.location.reload()}}},obj:m,scope:this},failureMessage:this.msg("message.getRuleFailure",this.name)})},_fireFolderRulesetDetailsAvailable:function e(){YAHOO.Bubbling.fire("folderRulesetDetailsAvailable",{folderRulesetDetails:this.options.ruleset})}})})();