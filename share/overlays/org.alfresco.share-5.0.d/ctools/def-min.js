/*!
 * Copyright 2002 - 2013 Webdetails, a Pentaho company.  All rights reserved.
 *
 * This software was developed by Webdetails and is provided under the terms
 * of the Mozilla Public License, Version 2.0, or any later version. You may not use
 * this file except in compliance with the license. If you need a copy of the license,
 * please go to  http://mozilla.org/MPL/2.0/. The Initial Developer is Webdetails.
 *
 * Software distributed under the Mozilla Public License is distributed on an "AS IS"
 * basis, WITHOUT WARRANTY OF ANY KIND, either express or  implied. Please refer to
 * the license for the specific language governing your rights and limitations.
 */
;var def=function(){function h(u,v){return n[u]=v}function p(x,z){var B=z||l;if(x){var A=x.split("."),u=A.length;if(u){var w,y=0;if(B===k.global){w=A[0];var v=k.getOwn(n,w);if(v){B=v;y++}}for(;u>y;){w=A[y++];B=B[w]||(B[w]={})}}}return B}function e(u,x,v){if(k.fun.is(x)){v=x;x=null}var w=p(u,x);if(v){s.push(l);try{v(w)}finally{l=s.pop()}}return w}function d(v,u,w){!k.hasOwn(v,u)||k.fail.operationInvalid("Name '{0}' is already defined in namespace.",[u]);return v[u]=w}function a(u){return function(v){return f(v,t.call(arguments,1),u)}}function f(v,w,z){for(var y=0,u=w.length;u>y;y++){var x=w[y];if(x){x=k.object.as(x.prototype||x);x&&j(v,x,z)}}return v}function j(u,v,w){for(var x in v){o(u,x,v[x],w)}}function o(u,y,v,w){if(void 0!==v){var z,x=k.object.asNative(u[y]);if(x){z=k.object.as(v);if(z){r.call(u,y)||(u[y]=x=Object.create(x));j(x,z,w)}else{u[y]=v}}else{z=k.object.asNative(v);z&&(v=(w||Object.create)(z));u[y]=v}}}function b(u){for(var w in u){var v=k.object.asNative(u[w]);v&&b(u[w]=Object.create(v))}}function m(){for(;this._source.next();){var u=this._selectMany?this._selectMany.call(this._ctx,this._source.item,this._source.index):this._source.item;if(null!=u){this._manySource=k.query(u);return !0}}}var t=Array.prototype.slice;Object.keys||(Object.keys=function(w){if(w!==Object(w)){throw new TypeError("Object.keys called on non-object")}var u=[];for(var v in w){Object.prototype.hasOwnProperty.call(w,v)&&u.push(v)}return u});Object.create||(Object.create=function(){function u(y){w.prototype=y||{};var x=new w();w.prototype=v;return x}var w=function(){},v=w.prototype;return u}());Function.prototype.bind||(Function.prototype.bind=function(u){var v=t.call(arguments,1),w=this;return function(){return w.apply(u,v.concat(t.call(arguments)))}});this.JSON||(this.JSON={});this.JSON.stringify||(this.JSON.stringify=function(u){return""+u});var r=Object.prototype.hasOwnProperty,k={global:this,get:function(y,x,w){var u;return y&&null!=(u=y[x])?u:w},gets:function(v,u){return u.map(function(w){return v[w]})},getPath:function(v,C,u,z){if(!v){return u}if(null!=C){var x=k.array.is(C)?C:C.split("."),A=x.length;if(A){for(var y=0;A>y;){var w=x[y++],B=v[w];if(null==B){if(!z){return u}B=v[w]=null==u||isNaN(+u)?{}:[]}v=B}}}return v},setPath:function(z,y,u){if(z&&null!=y){var x=k.array.is(y)?y:y.split(".");if(x.length){var w=x.pop();z=k.getPath(z,x,w,!0);null!=z&&(z[w]=u)}}return z},propGet:function(v,u){v=""+v;return function(w){return w?w[v]:u}},getOwn:function(y,x,w){var u;return y&&r.call(y,x)&&null!=(u=y[x])?u:w},hasOwn:function(v,u){return !!v&&r.call(v,u)},hasOwnProp:r,set:function(y){for(var v=y||{},w=arguments,x=1,u=w.length-1;u>x;x+=2){v[w[x]]=w[x+1]}return v},setDefaults:function(B,y){var z,v=B||{},w=arguments,u=w.length;if(2===u&&k.object.is(y)){for(z in y){null==v[z]&&(v[z]=y[z])}}else{u--;for(var x=1;u>x;x+=2){z=w[x];null==v[z]&&(v[z]=w[x+1])}}return v},setUDefaults:function(B,y){var z,v=B||{},w=arguments,u=w.length;if(2===u&&k.object.is(y)){for(z in y){void 0===v[z]&&(v[z]=y[z])}}else{u--;for(var x=1;u>x;x+=2){z=w[x];void 0===v[z]&&(v[z]=w[x+1])}}return v},eachOwn:function(x,v,u){if(x){for(var w in x){r.call(x,w)&&v.call(u,x[w],w,x)}}},each:function(x,v,u){if(x){for(var w in x){v.call(u,x[w],w,x)}}},copyOwn:function(v,u){var y,x;if(arguments.length>=2){y=v||{};x=u}else{y={};x=v}if(x){for(var w in x){r.call(x,w)&&(y[w]=x[w])}}return y},copy:function(v,u){var y,x;if(arguments.length>=2){y=v||{};x=u}else{y={};x=v}if(x){for(var w in x){y[w]=x[w]}}return y},copyProps:function(v,u,w){var y,x;if(arguments.length>=3){y=v||{};x=u}else{y={};x=v;w=u}w&&w.forEach(x?function(z){y[z]=x[z]}:function(z){y[z]=void 0});return y},keys:function(w){var u=[];for(var v in w){u.push(v)}return u},values:function(w){var u=[];for(var v in w){u.push(w[v])}return u},uniqueIndex:function(A,y,u){var x={};for(var z in A){var w=y?y.call(u,A[z]):A[z];null==w||r.call(x,w)||(x[w]=z)}return x},ownKeys:Object.keys,own:function(x,w,u){var v=Object.keys(x);return v.map(w?function(y){return w.call(u,x[y],y)}:function(y){return x[y]})},scope:function(v,u){return v.call(u)},bit:{set:function(v,w,u){return u||null==u?v|w:v&~w}},compare:function(v,u){return v===u?0:v>u?1:-1},compareReverse:function(v,u){return v===u?0:v>u?-1:1},methodCaller:function(v,u){return u?function(){return u[v].apply(u,arguments)}:function(){return this[v].apply(this,arguments)}},identity:function(u){return u},add:function(v,u){return v+u},negate:function(u){return function(){return !u.apply(this,arguments)}},sqr:function(u){return u*u},noop:function(){},retTrue:function(){return !0},retFalse:function(){return !1},number:{is:function(u){return"number"==typeof u},as:function(x,w){var u=parseFloat(x);return isNaN(u)?w||0:u},to:function(x,w){var u=parseFloat(x);return isNaN(u)?w||0:u}},array:{is:function(u){return u instanceof Array},isLike:function(u){return u&&null!=u.length&&"string"!=typeof u},as:function(u){return u instanceof Array?u:null!=u?[u]:null},to:function(u){return u instanceof Array?u:null!=u?[u]:null},lazy:function(v,x,w,u){return v[x]||(v[x]=w?w.call(u,x):[])},copy:function(u){return t.apply(u,t.call(arguments,1))}},object:{is:function(u){return u&&"object"==typeof u},isNative:function(u){return !!u&&u.constructor===Object},as:function(u){return u&&"object"==typeof u?u:null},asNative:function(u){return u&&u.constructor===Object?u:null},lazy:function(v,x,w,u){return v[x]||(v[x]=w?w.call(u,x):{})}},string:{is:function(u){return"string"==typeof u},to:function(u,w){return null!=u?""+u:w||""},join:function(z){var x,B,w=arguments,u=w.length;switch(u){case 3:x=w[1];B=w[2];return null!=x&&""!==x?null!=B&&""!==B?""+x+z+(""+B):""+x:null!=B&&""!==B?""+B:"";case 2:x=w[1];return null!=x?""+x:"";case 1:case 0:return""}for(var y=[],A=1;u>A;A++){x=w[A];null!=x&&""!==x&&y.push(""+x)}return y.join(z)},padRight:function(v,x,w){v||(v="");null==w&&(w=" ");var u=~~((x-v.length)/w.length);return u>0?v+new Array(u+1).join(w):v}},fun:{is:function(u){return"function"==typeof u},as:function(u){return"function"==typeof u?u:null},to:function(u){return"function"==typeof u?u:k.fun.constant(u)},constant:function(u){return function(){return u}}},nullyTo:function(u,w){return null!=u?u:w},between:function(w,x,u){return Math.max(x,Math.min(w,u))},nully:function(u){return null==u},notNully:function(u){return null!=u},notUndef:function(u){return void 0!==u},empty:function(u){return null==u||""===u},notEmpty:function(u){return null!=u&&""!==u},truthy:function(u){return !!u},falsy:function(u){return !u},firstUpperCase:function(v){if(v){var w=v.charAt(0),u=w.toUpperCase();w!==u&&(v=u+v.substr(1))}return v},firstLowerCase:function(v){if(v){var w=v.charAt(0),u=w.toLowerCase();w!==u&&(v=u+v.substr(1))}return v},format:function(v,w,u){if(null==v||""===v){return""}var x=w&&k.fun.is(w);return v.replace(/(^|[^{])\{([^{}]+)\}/g,function(y,A,B){var z=w?x?w.call(u,B):w[B]:null;return A+(null==z?"":String(z))})},destructuringTypeBind:function(B,y){var z=B.length,u=new Array(z);if(z&&y){var w=y.length;if(w){var x=0,A=0;do{var C=y[x];if(null==C||typeof C===B[A]){u[A]=C;x++}A++}while(z>A&&w>x)}}return u},error:function(u){return u instanceof Error?u:new Error(u)},fail:function(u){throw k.error(u)},assert:function(v,u){throw k.error.assertionFailed(v,u)}};k.ascending=k.compare;k.descending=k.compareReverse;var i=k.array.like=k.copyOwn(function(u){return i.is(u)?u:[u]},{is:function(u){return u&&null!=u.length&&"string"!=typeof u},as:function(u){return i.is(u)?u:null}});i.to=i;k.lazy=k.object.lazy;k.shared=function(){function v(y){function x(){u=y}return x}function w(y){if(null!=u){throw new Error("Access denied.")}y();var x;x=u;u=null;return x}var u=null;w.safe=v;return w};var g={operationInvalid:function(v,u){return k.error(k.string.join(" ","Invalid operation.",k.format(v,u)))},notImplemented:function(){return k.error("Not implemented.")},argumentRequired:function(u){return k.error(k.format("Required argument '{0}'.",[u]))},argumentInvalid:function(u,w,v){return k.error(k.string.join(" ",k.format("Invalid argument '{0}'.",[u]),k.format(w,v)))},assertionFailed:function(v,u){return k.error(k.string.join(" ","Assertion failed.",k.format(v,u)))}};k.copyOwn(k.error,g);k.eachOwn(g,function(v,u){k.fail[u]=function(){throw v.apply(null,arguments)}});var l=k,n={},s=[];k.space=e;k.globalSpace=h;k.mixin=a(Object.create);k.copyOwn(k.mixin,{custom:a,inherit:k.mixin,copy:a(k.copy),share:a(k.identity)});k.create=function(){var w=t.call(arguments),v=!0,x=w.shift();if("boolean"==typeof x){v=x;x=w.shift()}var u=x?Object.create(x):{};v&&b(u);if(w.length>0){w.unshift(u);k.mixin.apply(k,w)}return u};k.scope(function(){function C(){return k.error.operationInvalid("Type is locked.")}function K(O,P){if(O){do{var N=k.getOwn(O.constructor,P);if(void 0!==N){return N}}while(O=O.base)}}function D(N){var O;if(N){if(N instanceof Array){O=N;N=O.join(".")}else{O=N.split(".")}}if(O&&O.length>1){this.name=O.pop();this.namespace=O.join(".");this.namespaceParts=O}else{this.name=N||null;this.namespace=null;this.namespaceParts=[]}}function u(N){this.fun=N.as;this.isAbstract=!!N.isAbstract}function H(N){if(N){if(k.fun.is(N)){return new u({as:N})}if(N instanceof u){return N}if(k.fun.is(N.as)){return new u(N)}if(N.isAbstract){return new u({isAbstract:!0,as:k.fail.notImplemented})}}return null}function w(N){return H(N)||k.fail.argumentInvalid("fun")}function B(){}function E(O,N){return function(){var P=I.base;I.base=N;try{return O.apply(this,arguments)}finally{I.base=P}}}function G(N,O){this[N]=E(O,this[N]);return this}function M(){return""+this.constructor}function F(N,P){var O=N.prototype=Object.create(P.prototype);O.constructor=N;return O}function L(Q){function P(){if(O){for(var R=0;N[R].apply(this,arguments)!==!1&&++R<O;){}}}var O=1,N=[function(){O=0;if(Q.initOrPost){N.length=0;if(Q.init){N.push(Q.init);O++}if(Q.post){N.push(Q.post);O++}P.apply(this,arguments);return !1}N=null}];return P}function x(){var N=k.destructuringTypeBind(J,arguments);return z.apply(this,N)}function z(O,U,T){var P,N=new D(O);if(U){P=U.safe&&v(U.safe)||k.fail.operationInvalid('Invalid "foreign" base type.');P.locked=!0}else{U=B;P=A}var S=Object.create(P);S.locked=!1;S.base=P;S.methods=Object.create(P.methods);var Q=L(S);k.copyOwn(Q,y);Q.name=N.name;Q.typeName=N;Q.safe=v.safe(S);Q.toString=function(){return""+this.typeName||"Anonymous type"};var R=F(Q,U);S.constructor=Q;R.override=G;R.toString=M;N.name&&d(k.space(N.namespace,T),N.name,Q);return Q}var v=k.shared(),y={init:function(P){P||k.fail.argumentRequired("init");var O=v(this.safe);!O.locked||k.fail(C());var N=O.init;N&&(P=E(P,N));O.init=P;O.initOrPost=!0;return this},postInit:function(N){N||k.fail.argumentRequired("postInit");var P=v(this.safe);!P.locked||k.fail(C());var O=P.post;O&&(N=E(N,O));P.post=N;P.initOrPost=!0;return this},add:function(N){var Q=v(this.safe);!Q.locked||k.fail(C());var P=this.prototype,O=Q.base;k.each(N.prototype||N,function(S,T){switch(T){case"base":case"constructor":return;case"toString":if(S===M){return}break;case"override":if(S===G){return}}if(S){var V=H(S);if(V){var R,U=Q.methods[T];if(U&&U instanceof u){R=U}else{if(O){U=O.methods[T];U&&U instanceof u&&(R=U)}}Q.methods[T]=V;R&&(S=R.override(V));P[T]=S;return}}o(P,T,S,k.identity)});return this},getStatic:function(N){return K(v(this.safe),N)},addStatic:function(N){var Q=v(this.safe);!Q.locked||k.fail(C());for(var R in N){if("prototype"!==R){var T=N[R],O=k.object.as(T);if(O){var U=k.getOwn(this,R),S=void 0!==U;S||(U=K(Q.base,R));var P=k.object.asNative(U);if(P){if(S){k.mixin(U,T);continue}T=k.create(U,T)}}this[R]=T}}return this}};D.prototype.toString=function(){return k.string.join(".",this.namespace+"."+this.name)};k.copyOwn(u.prototype,{override:function(O){if(this.isAbstract){return O.fun}var N=E(O.fun,this.fun);O.fun=N;return N}});var I=B.prototype;I.base=void 0;var A={locked:!0,init:void 0,postInit:void 0,initOrPost:!1,methods:{},constructor:B};B.safe=v.safe(A);var J=["string","function","object"];k.type=x;k.method=w});k.makeEnum=function(u){var v=1,w={};u.forEach(function(x){w[x]=v;v<<=1});return w};k.copyOwn(k.array,{create:function(u,x){var v=u>=0?new Array(u):[];if(void 0!==x){for(var w=0;u>w;w++){v[w]=x}}return v},append:function(y,x,z){null==z&&(z=0);for(var w=0,u=x.length,v=y.length;u>w;w++){y[v+w]=x[z+w]}return y},appendMany:function(B){var v=arguments,y=v.length;if(y>1){for(var x=B.length,z=1;y>z;z++){var A=v[z];if(A){for(var w=0,u=A.length;u>w;){B[x++]=A[w++]}}}}return B},prepend:function(x,w,y){null==y&&(y=0);for(var v=0,u=w.length;u>v;v++){x.unshift(w[y+v])}return x},removeAt:function(v,u){return v.splice(u,1)[0]},insertAt:function(w,u,v){w.splice(u,0,v);return w},removeIf:function(z,y,v){for(var w=0,u=z.length;u>w;){if(y.call(v,z[w],w)){u--;z.splice(w,1)}else{w++}}return z},binarySearch:function(B,z,y,x){y||(y=k.compare);for(var v=0,A=B.length-1;A>=v;){var w=v+A>>1,u=y(z,x?x(B[w]):B[w]);if(0>u){A=w-1}else{if(!(u>0)){return w}v=w+1}}return ~v},insert:function(x,w,v){var u=k.array.binarySearch(x,w,v);0>u&&x.splice(~u,0,w);return u},remove:function(x,w,v){var u=k.array.binarySearch(x,w,v);return u>=0?x.splice(u,1)[0]:void 0}});var c=1,q={};k.nextId=function(v){if(v){var u=k.getOwn(q,v)||1;q[v]=u+1;return u}return c++};k.type("Set").init(function(v,u){this.source=v||{};this.count=v?null!=u?u:k.ownKeys(v).length:0}).add({has:function(u){return r.call(this.source,u)},add:function(v){var u=this.source;if(!r.call(u,v)){this.count++;u[v]=!0}return this},rem:function(u){if(r.call(this.source,u)){delete this.source[u];this.count--}return this},clear:function(){if(this.count){this.source={};this.count=0}return this},members:function(){return k.ownKeys(this.source)}});k.type("Map").init(function(v,u){this.source=v||{};this.count=v?null!=u?u:k.ownKeys(v).length:0}).add({has:function(u){return r.call(this.source,u)},get:function(u){return r.call(this.source,u)?this.source[u]:void 0},set:function(x,u){var w=this.source;r.call(w,x)||this.count++;w[x]=u;return this},rem:function(u){if(r.call(this.source,u)){delete this.source[u];this.count--}return this},clear:function(){if(this.count){this.source={};this.count=0}return this},copy:function(u){k.eachOwn(u.source,function(v,w){this.set(w,v)},this)},values:function(){return k.own(this.source)},keys:function(){return k.ownKeys(this.source)},clone:function(){return new k.Map(k.copy(this.source),this.count)},symmetricDifference:function(v){if(!this.count){return v.clone()}if(!v.count){return this.clone()}var u={},y=0,w=this.source,x=v.source;k.eachOwn(w,function(z,A){if(!r.call(x,A)){u[A]=z;y++}});k.eachOwn(x,function(z,A){if(!r.call(w,A)){u[A]=z;y++}});return new k.Map(u,y)},intersect:function(v,u){u||(u=new k.Map());k.eachOwn(this.source,function(w,x){v.has(x)&&u.set(x,w)});return u}});k.type("OrderedMap").init(function(){this._list=[];this._map={}}).add({has:function(u){return r.call(this._map,u)},count:function(){return this._list.length},get:function(u){var v=this._map;return r.call(v,u)?v[u].value:void 0},at:function(u){var v=this._list[u];return v?v.value:void 0},add:function(x,u,w){var y=this._map,z=r.call(y,x)&&y[x];if(z){z.value!==u&&(z.value=u)}else{z=y[x]={key:x,value:u};null==w?this._list.push(z):k.array.insertAt(this._list,w,z)}return this},rem:function(v){var w=this._map,x=r.call(w,v)&&w[v];if(x){var u=this._list.indexOf(x);this._list.splice(u,1);delete this._map[v]}return this},clear:function(){if(this._list.length){this._map={};this._list.length=0}return this},keys:function(){return k.ownKeys(this._map)},forEach:function(v,u){return this._list.forEach(function(w){v.call(u,w.value,w.key)})}});k.html={escape:function(u){return k.string.to(u).replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/gm,"&quot;")}};k.type("Query").add({index:-1,item:void 0,next:function(){var v=this,u=v.index;if(-2===u){return !1}u++;if(!v._next(u)){v._finish();return !1}v.index=u;return !0},_next:k.method({isAbstract:!0}),_finish:function(){var u=this;if(u.index>-2){u.next=k.retFalse;u.index=-2;delete u.item}},each:function(w,u){for(var v=this;v.next();){if(w.call(u,v.item,v.index)===!1){return !0}}return !1},array:function(){for(var v=[],u=this;u.next();){v.push(u.item)}return v},sort:function(v,w){v||(v=k.compare);if(w){var x=v;v=function(z,y){return x(w(z),w(y))}}var u=this.array().sort(v);return new k.ArrayLikeQuery(u)},object:function(y){for(var z=k.get(y,"target")||{},v=k.get(y,"name"),x=k.get(y,"value"),u=k.get(y,"context");this.next();){var w=""+(v?v.call(u,this.item,this.index):this.item);z[w]=x?x.call(u,this.item,this.index):this.item}return z},reduce:function(v){var u,w=0;if(arguments.length<2){if(!this.next()){throw new TypeError("Length is 0 and no second argument")}u=this.item}else{u=arguments[1]}for(;this.next();){u=v(u,this.item,this.index);++w}return u},count:function(){for(var u=0;this.next();){u++}return u},first:function(v,u,w){for(;this.next();){if(!v||v.call(u,this.item,this.index)){var x=this.item;this._finish();return x}}return w},last:function(v,u,w){for(var x=w;this.next();){(!v||v.call(u,this.item,this.index))&&(x=this.item)}return x},any:function(v,u){for(;this.next();){if(!v||v.call(u,this.item,this.index)){this._finish();return !0}}return !1},all:function(v,u){for(;this.next();){if(!v.call(u,this.item,this.index)){this._finish();return !1}}return !0},min:function(){for(var u=null;this.next();){(null===u||this.item<u)&&(u=this.item)}return u},max:function(){for(var u=null;this.next();){(null===u||this.item>u)&&(u=this.item)}return u},range:function(){for(var v=null,u=null;this.next();){var w=this.item;if(null===v){v=u=w}else{v>w&&(v=w);w>u&&(u=w)}}return null!=v?{min:v,max:u}:null},multipleIndex:function(v,u){var w={};this.each(function(y){var x=v?v.call(u,y):y;if(null!=x){var z=k.getOwn(w,x)||(w[x]=[]);z.push(y)}});return w},uniqueIndex:function(v,u){var w={};this.each(function(y){var x=v?v.call(u,y):y;null==x||r.call(w,x)||(w[x]=y)});return w},select:function(v,u){return new k.SelectQuery(this,v,u)},prop:function(u){return new k.SelectQuery(this,function(v){return v?v[u]:void 0})},selectMany:function(v,u){return new k.SelectManyQuery(this,v,u)},union:function(){var u=k.array.append([this],arguments);return new k.SelectManyQuery(new k.ArrayLikeQuery(u))},where:function(v,u){return new k.WhereQuery(this,v,u)},distinct:function(v,u){return new k.DistinctQuery(this,v,u)},skip:function(u){return new k.SkipQuery(this,u)},take:function(u){return 0>=u?new k.NullQuery():isFinite(u)?new k.TakeQuery(this,u):this},whayl:function(v,u){return new k.WhileQuery(this,v,u)},reverse:function(){return new k.ReverseQuery(this)}});k.type("NullQuery",k.Query).add({next:k.retFalse});k.type("AdhocQuery",k.Query).init(function(u){this._next=u});k.type("ArrayLikeQuery",k.Query).init(function(y){function u(){for(;++w<v;){if(r.call(y,w)){x.index=w;x.item=y[w];return !0}}x._finish();return !1}var x=this;k.array.isLike(y)||(y=[y]);x._list=y;x._count=y.length;var w=-1,v=y.length;x.next=u}).add({count:function(){var u=this._count;this.index>=0&&(u-=this.index+1);this._finish();return u}});k.type("RangeQuery",k.Query).init(function(w,v,u){this._index=w;this._count=v;this._step=null==u?1:u}).add({_next:function(u){if(u<this._count){this.item=this._index;this._index+=this._step;return !0}},count:function(){var u=this._count;this.index>=0&&(u-=this.index+1);this._finish();return u}});k.type("WhereQuery",k.Query).init(function(z,A,u){function y(){for(;z.next();){var x=z.item;if(A.call(u,x,z.index)){w.item=x;w.index=++v;return !0}}w._finish();return !1}var w=this,v=-1;w.next=y});k.type("WhileQuery",k.Query).init(function(w,A,u){function z(){if(w.next()){var x=w.item;if(A.call(u,x,w.index)){y.item=x;y.index=++v;return !0}}y._finish();return !1}var y=this,v=-1;y.next=z});k.type("SelectQuery",k.Query).init(function(w,A,u){function z(){if(w.next()){y.item=A.call(u,w.item,w.index);y.index=++v;return !0}y._finish();return !1}var y=this,v=-1;y.next=z});k.type("SelectManyQuery",k.Query).init(function(w,v,u){this._selectMany=v;this._ctx=u;this._source=w;this._manySource=null}).add({_next:function(){for(;;){if(this._manySource){if(this._manySource.next()){this.item=this._manySource.item;return !0}this._manySource=null}if(!m.call(this)){break}}}});k.type("DistinctQuery",k.Query).init(function(z,w,v){function u(){for(;z.next();){var C=z.item,x=w?w.call(v,C,z.index):C;if(null!=x&&!r.call(B,x)){A.item=C;A.index=++y;return B[x]=!0}}A._finish();return !1}var A=this,y=-1,B={};A.next=u});k.type("SkipQuery",k.Query).init(function(v,u){this._source=v;this._skip=u}).add({_next:function(){for(;this._source.next();){if(!(this._skip>0)){this.item=this._source.item;return !0}this._skip--}}});k.type("TakeQuery",k.Query).init(function(v,u){this._source=v;this._take=u}).add({_next:function(){if(this._take>0&&this._source.next()){this._take--;this.item=this._source.item;return !0}}});k.type("ReverseQuery",k.Query).init(function(u){this._source=u}).add({_next:function(u){if(!u){this._source instanceof k.Query&&(this._source=this._source instanceof k.ArrayLikeQuery?this._source._list:this._source.array());this._count=this._source.length}var w=this._count;if(w>u){for(var v=w-u-1,x=this._source;!r.call(x,v);){if(--v<0){return !1}this._count--}this.item=x[v];return !0}}});k.query=function(u){return void 0===u?new k.NullQuery():u instanceof k.Query?u:k.fun.is(u)?new k.AdhocQuery(u):new k.ArrayLikeQuery(u)};k.range=function(w,v,u){return new k.RangeQuery(w,v,u)};l=k.global;return k}();