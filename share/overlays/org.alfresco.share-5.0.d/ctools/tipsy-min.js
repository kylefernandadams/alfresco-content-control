/*!
 * Copyright 2002 - 2013 Webdetails, a Pentaho company.  All rights reserved.
 *
 * This software was developed by Webdetails and is provided under the terms
 * of the Mozilla Public License, Version 2.0, or any later version. You may not use
 * this file except in compliance with the license. If you need a copy of the license,
 * please go to  http://mozilla.org/MPL/2.0/. The Initial Developer is Webdetails.
 *
 * Software distributed under the Mozilla Public License is distributed on an "AS IS"
 * basis, WITHOUT WARRANTY OF ANY KIND, either express or  implied. Please refer to
 * the license for the specific language governing your rights and limitations.
 */
;!function(){function b(e){return pv.Transform.identity.translate(e.left(),e.top()).times(e.transform())}function a(h){for(var k,e,j,l=h.instance(),g=l.left,i=l.top,f=l.width,m=l.height;j=h.parent;){if(0>g){f+=g;g=0}if(0>i){m+=i;i=0}k=l.right;0>k&&(f+=k);e=l.bottom;0>e&&(m+=e);var n=b(j),o=n.k;g=n.x+o*g;i=n.y+o*i;f=o*f;m=o*m;h=j;l=h.instance()}return{left:g,top:i,width:f,height:m}}var d=0;pv.Behavior.tipsy=function(E){function k(){var R=m.instance(),S=m.properties.tooltip?R.tooltip:"function"==typeof m.tooltip?m.tooltip():R.title||R.text;"function"==typeof S&&(S=S());return S||""}function x(){var V,aa,T,ae,ab=m.instance();if(m.properties.width){var R=a(m);V=R.left;aa=R.top;T=R.width;ae=R.height}else{var Y,af=m.toScreenTransform();if(m.properties.outerRadius){var U=ab.startAngle+ab.angle/2;Y=ab.outerRadius;V=af.x+ab.left+Y*Math.cos(U);aa=af.y+ab.top+Y*Math.sin(U)}else{if(m.properties.shapeRadius){Y=Math.max(2,ab.shapeRadius);var X=ab.left,W=ab.top;switch(ab.shape){case"diamond":Y*=Math.SQRT2;break;case"circle":Y/=Math.SQRT2}V=(X-Y)*af.k+af.x;aa=(W-Y)*af.k+af.y;ae=T=2*Y*af.k}else{V=ab.left*af.k+af.x;aa=ab.top*af.k+af.y}}}var ad=Math.ceil(V),Z=Math.ceil(aa),S=ad-V,ac=Z-aa;T=Math.max(1,Math.floor((T||0)-S));ae=Math.max(1,Math.floor((ae||0)-ac));return{left:ad,top:Z,width:T,height:ae}}function g(){i&&(K=i.call(m)||$.fn.tipsy.defaults.gravity);return K}function P(ad,Z){function R(ag){var af=Z(ag);return V(ag,af)}function V(aj,ai){var ah=aa(ai.left,"width"),af=aa(ai.top,"height"),ag=ah.fits&&af.fits;return{gravity:aj,width:ah,height:af,value:ah.value+af.value+(2-aj.length),isTotal:ag,isPartial:!ag&&(ah.fits||af.fits)}}function aa(ah,ag){var ai=ac[ag],af=ad[ag],am=ah-X[ag],al=ai-(am+af),aj=am>=0&&al>=0,ak=(am>=0?am:4*am)+(al>=0?al:4*al);return{fits:aj,value:ak}}this===D[0]||def.assert();var S=$(window),X={width:S.scrollLeft(),height:S.scrollTop()},ac={width:S.width(),height:S.height()},ae=K;"c"===ae&&(ae="w");var U=R(ae);if(!U.isTotal){for(var Y=p.indexOf(ae),T=1,ab=p.length;ab>T;T++){var W=(Y+T)%ab;U=t(U,R(p[W]))}c.debug>=21&&ae!==U.gravity&&c.log("[TIPSY] #"+G+" Choosing gravity '"+U.gravity+"' over '"+ae+"'");ae=U.gravity}c.debug>=21&&c.log("[TIPSY] #"+G+" Gravity '"+ae+"'");return ae}function t(S,R){if(S.isTotal){if(!R.isTotal){return S}}else{if(R.isTotal){if(!S.isTotal){return R}}else{if(S.isPartial){if(!R.isPartial){return S}}else{if(R.isPartial&&!S.isPartial){return R}}}}return R.value>S.value?R:S}function A(R){D.css({left:R.left+parseFloat(s.css("padding-left")),top:R.top+parseFloat(s.css("padding-top")),width:R.width,height:R.height})}function u(U){var T=U.root.canvas();s=$(T);T.style.position="relative";s.mouseleave(r);L();I||(I="tipsyPvBehavior_"+new Date().getTime());var R=document.getElementById(I);if(!R){R=document.createElement("div");R.id=I;T.appendChild(R)}var S=R.style;S.padding="0px";S.margin="0px";S.position="absolute";S.pointerEvents="none";S.display="block";S.zIndex=-10;D=$(R);h();D.data("tipsy",null);D.tipsy(E)}function L(){M=s.data("tipsy-pv-shared-info");if(M){var R=s[0].$pvCreateId||0;if(M.createId===R){M.behaviors.push(Q);return}M.behaviors.forEach(function(S){S()})}M={createId:s[0].$pvCreateId||0,behaviors:[Q]};s.data("tipsy-pv-shared-info",M)}function h(){D&&D.css(c.debug>=22?{borderColor:"red",borderWidth:"1px",borderStyle:"solid",zIndex:1000}:{borderWidth:"0px",zIndex:-10})}function y(R){R||(R=pv.event);var T=5,S=s.offset();return{left:R.pageX-S.left-T,top:R.pageY-S.top-T,width:10+2*T,height:20}}function J(R,S){if(!B&&R||B&&B[0]!==R){c.debug>=20&&c.log("[TIPSY] #"+G+" Changing target element.");if(B){B.unbind("mousemove",w);O||B.unbind("mouseleave",r)}B=R?$(R):null;m=R?S:null;o=n=C=null;if(B){B.mousemove(w);O||B.mouseleave(r)}}}function f(){return F++}function j(R){return R===F-1}function r(){var R=f();c.debug>=20&&c.log("[TIPSY] #"+G+" Delayed Hide Begin opId="+R);if(z>0){window.setTimeout(function(){if(j(R)){c.debug>=20&&c.log("[TIPSY] #"+G+" Hiding opId="+R+" nextOperationId="+F);e(R)}else{c.debug>=20&&c.log("[TIPSY] #"+G+" Delayed Hide Cancelled opId="+R)}},z)}else{c.debug>=20&&c.log("[TIPSY] #"+G+" Hiding Immediately opId="+R);e(R)}}function Q(){var R=f();c.debug>=20&&c.log("[TIPSY] #"+G+" Hiding as Other opId="+R);e(R)}function e(){J(null,null);D&&D.tipsy("leave")}function v(){var R=M&&M.behaviors;R&&R.length>1&&R.forEach(function(S){S!==Q&&S()})}function w(W){if(D&&!(null!=o&&Math.abs(W.clientX-o)<3&&Math.abs(W.clientY-n)<3)){var S,R=this.$scene;if(R&&(S=R.scenes)&&S.mark&&S.mark===m){var Y=m.renderId(),X=Y!==C,U=E.followMouse;if(U||X){var T=f();c.debug>=20&&c.log("[TIPSY] #"+G+" Updating opId="+T);o=W.clientX;n=W.clientY;var V;U&&(V=y(W));if(X){C=Y;m.context(S,R.index,function(){U||(V=x());var Z=k();c.debug>=20&&c.log("[TIPSY] #"+G+" Update text. Was hidden. Text: "+Z);D.tipsy("setTitle",Z);g()})}A(V);v();D.tipsy("update")}}}}function q(R){c.debug>=20&&c.log("[TIPSY] #"+G+" Creating");u(R);O&&R.event("unpoint",r)}function l(U){var R=f();c.debug>=20&&c.log("[TIPSY] #"+G+" Show IN opId="+R);s||q(U);var S=!B;J(pv.event.target,U);var T=k();c.debug>=20&&c.log("[TIPSY] #"+G+" Text: "+T);D.tipsy("setTitle",T);A(E.followMouse?y():x());g();v();D.tipsy(S?"enter":"update");c.debug>=20&&c.log("[TIPSY] #"+G+" Show OUT")}function H(){var R=this;(!N||N(H,R))&&l(R)}var G=d++;E=E?Object.create(E):{};E.trigger="manual";var i,K=E.gravity||$.fn.tipsy.defaults.gravity;if("function"==typeof K){i=K;K=null}E.gravity=P;var D,B,o,n,C,m,I,s,M,F=0,z=E.delayOut,O=E.usesPoint,N=E.isEnabled;E.delayOut=0;var p=["nw","n","ne","e","se","s","sw","w"];return H};var c=pv.Behavior.tipsy;c.debug=0;c.setDebug=function(e){c.debug=e};c.log=function(e){"undefined"!=typeof console&&console.log(""+e)}}();