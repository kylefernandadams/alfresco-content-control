(function(){var h=YAHOO.util.Dom,m=YAHOO.util.Event,e=YAHOO.util.Element;Alfresco.module.ConfigBlog=function(q){this.name="Alfresco.module.ConfigBlog";this.id=q;Alfresco.util.YUILoaderHelper.require(["button","container","connection","json"],this.onComponentsLoaded,this);return this};Alfresco.module.ConfigBlog.prototype={options:{siteId:"",containerId:"blog",width:"40em"},widgets:{},modules:{},containerDiv:null,setOptions:function c(q){this.options=YAHOO.lang.merge(this.options,q);return this},setMessages:function p(q){Alfresco.util.addMessages(q,this.name);return this},onComponentsLoaded:function l(){},showDialog:function f(){if(!this.containerDiv){Alfresco.util.Ajax.request({url:Alfresco.constants.URL_SERVICECONTEXT+"modules/blog/config/config-blog",dataObj:{htmlid:this.id,siteId:this.options.siteId,containerId:this.options.containerId},successCallback:{fn:this.onTemplateLoaded,scope:this},failureMessage:"Unable to load dialog",execScripts:true})}else{this.loadDialogData()}},onTemplateLoaded:function j(q){this.containerDiv=document.createElement("div");this.containerDiv.setAttribute("style","display:none");this.containerDiv.innerHTML=q.serverResponse.responseText;var r=h.getFirstChild(this.containerDiv);while(r&&r.tagName.toLowerCase()!="div"){r=h.getNextSibling(r)}this.widgets.dialog=Alfresco.util.createYUIPanel(r,{width:this.options.width});this.widgets.okButton=Alfresco.util.createYUIButton(this,"ok",null,{type:"submit"});this.widgets.cancelButton=Alfresco.util.createYUIButton(this,"cancel",this.onCancel);this.modules.form=new Alfresco.forms.Form(this.id+"-form");this.modules.form.setSubmitElements(this.widgets.okButton);this.modules.form.setAJAXSubmit(true,{successMessage:this._msg("message.saveconfig.success"),successCallback:{fn:this.onSuccess,scope:this},failureMessage:this._msg("message.saveconfig.failure")});this.modules.form.setSubmitAsJSON(true);this.loadDialogData()},loadDialogData:function n(){Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"api/blog/site/"+this.options.siteId+"/"+this.options.containerId,successCallback:{fn:this.onLoadDialogDataSuccess,scope:this},failureCallback:{fn:this.onLoadDialogDataFailed,scope:this}})},onLoadDialogDataSuccess:function g(r){var q=r.json.item;this._showDialog(q)},onLoadDialogDataFailed:function b(q){Alfresco.util.PopupManager.displayMessage({text:this._msg("message.loaddata.failure")});this._hideDialog()},onSuccess:function i(q){YAHOO.Bubbling.fire("blogConfigChanged");this._hideDialog()},onCancel:function k(q,r){this._hideDialog()},_showDialog:function o(s){var r=h.get(this.id+"-form");var q=YAHOO.util.Selector.query('option[value="'+s.type+'"]',this.id+"-blogType")[0];if(q){h.get(this.id+"-blogType").selectedIndex=q.index}else{h.get(this.id+"-blogType").selectedIndex=0}h.get(this.id+"-blogid").value=s.id?s.id:"";h.get(this.id+"-title").value=s.name?s.name:"";h.get(this.id+"-description").value=s.description?s.description:"";h.get(this.id+"-url").value=s.url?s.url:"";h.get(this.id+"-username").value=s.username?s.username:"";h.get(this.id+"-password").value=s.password?s.password:"";this.modules.form.init();this.widgets.dialog.show();Alfresco.util.caretFix(this.id+"-form");this.modules.form.applyTabFix();h.get(this.id+"-blogType").focus()},_hideDialog:function d(){var q=h.get(this.id+"-form");Alfresco.util.undoCaretFix(q);this.widgets.dialog.hide()},_msg:function a(q){return Alfresco.util.message.call(this,q,this.name,Array.prototype.slice.call(arguments).slice(1))}}})();new Alfresco.module.ConfigBlog(null);