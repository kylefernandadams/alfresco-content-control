(function(){Alfresco.module.DeleteSite=function(g){var f=Alfresco.util.ComponentManager.get(g);if(f!==null){throw new Error("An instance of Alfresco.module.DeleteSite already exists.")}Alfresco.module.DeleteSite.superclass.constructor.call(this,"Alfresco.module.DeleteSite",g,["button","container","connection","selector","json"]);this.deletePromptActive=false;return this};YAHOO.extend(Alfresco.module.DeleteSite,Alfresco.component.Base,{localized:false,deletePromptActive:false,show:function e(f){var g=f;if(this.localized){this._showDialog(g)}else{Alfresco.util.Ajax.request({url:Alfresco.constants.URL_SERVICECONTEXT+"modules/delete-site",dataObj:{htmlid:this.id},successCallback:{fn:function(){this.onMessagesLoaded(g)},scope:this},execScripts:true,failureMessage:"Could not load delete site messages"})}},onMessagesLoaded:function d(f){this.localized=true;this._showDialog(f)},_showDialog:function a(f){if(!this.deletePromptActive){this.deletePromptActive=true;var g=this,j=f;Alfresco.util.PopupManager.displayPrompt({title:Alfresco.util.message("title.deleteSite",this.name),text:Alfresco.util.message("label.deleteSite",this.name,{"0":Alfresco.util.encodeHTML(j.site.title)}),noEscape:true,buttons:[{text:Alfresco.util.message("button.delete",this.name),handler:function i(){this.destroy();g._onDeleteClick.call(g,j)}},{text:Alfresco.util.message("button.cancel",this.name),handler:function h(){g.deletePromptActive=false;this.destroy()},isDefault:true}]})}},_onDeleteClick:function b(g){var h=this,j=g;Alfresco.util.PopupManager.displayPrompt({title:Alfresco.util.message("title.deleteSite",this.name),text:Alfresco.util.message("label.confirmDeleteSite",this.name),noEscape:true,buttons:[{text:Alfresco.util.message("button.yes",this.name),handler:function f(){this.destroy();h._onConfirmedDeleteClick.call(h,j)}},{text:Alfresco.util.message("button.no",this.name),handler:function i(){h.deletePromptActive=false;this.destroy()},isDefault:true}]})},_onConfirmedDeleteClick:function c(f){var g=this,i=f;var h=Alfresco.util.PopupManager.displayMessage({text:Alfresco.util.message("message.deletingSite",this.name),spanClass:"wait",displayTime:0});Alfresco.util.Ajax.jsonPost({url:Alfresco.constants.URL_SERVICECONTEXT+"modules/delete-site",dataObj:{shortName:f.site.shortName},successCallback:{fn:function(j){g.deletePromptActive=false;h.destroy();if(j.json&&j.json.success){Alfresco.util.PopupManager.displayMessage({text:Alfresco.util.message("message.siteDeleted",this.name)});YAHOO.Bubbling.fire("siteDeleted",{site:i.site})}else{Alfresco.util.PopupManager.displayMessage({text:Alfresco.util.message("message.deleteFailed",this.name)})}},scope:this},failureCallback:{fn:function(j){g.deletePromptActive=false;h.destroy();Alfresco.util.PopupManager.displayMessage({text:Alfresco.util.message("message.deleteFailed",this.name)})},scope:this}})}})})();Alfresco.module.getDeleteSiteInstance=function(){var a="alfresco-deletesite-instance";return Alfresco.util.ComponentManager.get(a)||new Alfresco.module.DeleteSite(a)};