(function(){Alfresco.module.DoclibCopyMoveTo=function(h){Alfresco.module.DoclibCopyMoveTo.superclass.constructor.call(this,h);this.name="Alfresco.module.DoclibCopyMoveTo";var i=Alfresco.module.DoclibGlobalFolder;Alfresco.util.ComponentManager.reregister(this);this.options=YAHOO.lang.merge(this.options,{allowedViewModes:[i.VIEW_MODE_SITE,i.VIEW_MODE_RECENT_SITES,i.VIEW_MODE_FAVOURITE_SITES,i.VIEW_MODE_SHARED,i.VIEW_MODE_REPOSITORY,i.VIEW_MODE_USERHOME],extendedTemplateUrl:Alfresco.constants.URL_SERVICECONTEXT+"modules/documentlibrary/copy-move-to"});return this};YAHOO.extend(Alfresco.module.DoclibCopyMoveTo,Alfresco.module.DoclibGlobalFolder,{setOptions:function g(j){var h={};if(typeof j.mode!=="undefined"){var i={copy:"copy-to",move:"move-to"};if(typeof i[j.mode]=="undefined"){throw new Error("Alfresco.module.CopyMoveTo: Invalid mode '"+j.mode+"'")}h.dataWebScript=i[j.mode]}h.viewMode=Alfresco.module.DoclibGlobalFolder.VIEW_MODE_RECENT_SITES;this.modules.actions=new Alfresco.module.DoclibActions();return Alfresco.module.DoclibCopyMoveTo.superclass.setOptions.call(this,YAHOO.lang.merge(h,j))},onTemplateLoaded:function a(h){Alfresco.util.Ajax.request({url:this.options.extendedTemplateUrl,dataObj:{htmlid:this.id},successCallback:{fn:this.onExtendedTemplateLoaded,obj:h,scope:this},failureMessage:"Could not load 'copy-move-to' template:"+this.options.extendedTemplateUrl,execScripts:true})},onExtendedTemplateLoaded:function c(h,i){Alfresco.module.DoclibCopyMoveTo.superclass.onTemplateLoaded.call(this,i)},onOK:function d(q,v){var k,w=[],n,p,o,m={copy:"Copied",move:"Moved"};if(YAHOO.lang.isArray(this.options.files)){k=this.options.files}else{k=[this.options.files]}for(p=0,o=k.length;p<o;p++){w.push(k[p].node.nodeRef)}var u=function s(A){var x,C=A.json.successCount,D=A.json.failureCount;this.widgets.dialog.hide();if(!A.json.overallSuccess){var B="message.failure";for(var z=0,y=A.json.totalResults;z<y;z++){x=A.json.results[z];if(!x.success&&x.fileExist){if("folder"==x.type){B="message.exists.failure.folder"}else{B="message.exists.failure.file"}}}Alfresco.util.PopupManager.displayMessage({text:this.msg(B)});return}YAHOO.Bubbling.fire("files"+m[this.options.mode],{destination:this.currentPath,successCount:C,failureCount:D});for(var z=0,y=A.json.totalResults;z<y;z++){x=A.json.results[z];if(x.success){YAHOO.Bubbling.fire((x.type=="folder"?"folder":"file")+m[this.options.mode],{multiple:true,nodeRef:x.nodeRef,destination:this.currentPath})}}if(this.options.mode=="move"&&window.location.pathname.lastIndexOf("document-details")===(window.location.pathname.length-"document-details".length)){window.location.reload()}else{Alfresco.util.PopupManager.displayMessage({text:this.msg("message.success",C)});YAHOO.Bubbling.fire("metadataRefresh")}};var l=function h(i){this.widgets.dialog.hide();Alfresco.util.PopupManager.displayMessage({text:this.msg("message.failure")})};var r=this.options.dataWebScript+"/node/{nodeRef}",t=new Alfresco.util.NodeRef(this.selectedNode.data.nodeRef);this.modules.actions.genericAction({success:{callback:{fn:u,scope:this}},failure:{callback:{fn:l,scope:this}},webscript:{method:Alfresco.util.Ajax.POST,name:r,params:{nodeRef:t.uri}},wait:{message:this.msg("message.please-wait")},config:{requestContentType:Alfresco.util.Ajax.JSON,dataObj:{nodeRefs:w,parentId:this.options.parentId}}});this.widgets.okButton.set("disabled",true);this.widgets.cancelButton.set("disabled",true)},msg:function b(i){var h=Alfresco.util.message.call(this,this.options.mode+"."+i,this.name,Array.prototype.slice.call(arguments).slice(1));if(h==(this.options.mode+"."+i)){h=Alfresco.util.message.call(this,i,this.name,Array.prototype.slice.call(arguments).slice(1))}if(h==i){h=Alfresco.util.message(i,"Alfresco.module.DoclibGlobalFolder",Array.prototype.slice.call(arguments).slice(1))}return h},_showDialog:function f(){this.widgets.okButton.set("label",this.msg("button"));return Alfresco.module.DoclibCopyMoveTo.superclass._showDialog.apply(this,arguments)}});var e=new Alfresco.module.DoclibCopyMoveTo("null")})();