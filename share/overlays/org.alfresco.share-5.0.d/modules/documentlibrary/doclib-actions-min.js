(function(){Alfresco.module.DoclibActions=function(){this.name="Alfresco.module.DoclibActions";Alfresco.util.YUILoaderHelper.require(["json"],this.onComponentsLoaded,this);return this};Alfresco.module.DoclibActions.prototype={isReady:false,defaultConfig:{method:"POST",urlStem:Alfresco.constants.PROXY_URI+"slingshot/doclib/action/",dataObj:null,successCallback:null,successMessage:null,failureCallback:null,failureMessage:null,object:null},onComponentsLoaded:function e(){this.isReady=true},_runAction:function b(f,g){if(!this.isReady){return false}if(typeof g=="object"){f=YAHOO.lang.merge(f,g)}if(f.method==Alfresco.util.Ajax.DELETE){if(f.dataObj!==null){f.method=Alfresco.util.Ajax.POST;if(f.url.indexOf("alf_method")<1){f.url+=(f.url.indexOf("?")<0?"?":"&")+"alf_method=delete"}Alfresco.util.Ajax.jsonRequest(f)}else{Alfresco.util.Ajax.request(f)}}else{Alfresco.util.Ajax.jsonRequest(f)}},genericAction:function a(l){var r="",q=l.success,h=l.failure,g=l.webscript,k=l.params?l.params:l.webscript.params,j=l.config,n=l.wait,i=null,o=this;if(l.params){Alfresco.logger.warn("Alfresco.module.DoclibActions.genericAction()","action.params deprecated. Use action.webscript.params instead.")}var m=function p(s,t){if(t){var u=function(){if(t.callback&&t.callback.fn){t.callback.fn.call((typeof t.callback.scope=="object"?t.callback.scope:this),{config:s.config,json:s.json,serverResponse:s.serverResponse},t.callback.obj)}if(t.event&&t.event.name){YAHOO.Bubbling.fire(t.event.name,t.event.obj)}if(YAHOO.lang.isArray(t.events)){for(var v=0,w=t.events.length;v<w;v++){YAHOO.Bubbling.fire(t.events[v].name,t.events[v].obj)}}if(t.popup){t.popup.destroy()}if(t.message){Alfresco.util.PopupManager.displayMessage({text:t.message})}};if(t.activity!==undefined){o.postActivity(t.activity.siteId,t.activity.activityType,t.activity.page,t.activity.activityData,u)}else{if(t.fn){t.fn.call((typeof t.scope=="object"?t.scope:this))}u()}}};if(n&&n.message){if(typeof q!="object"){q={}}if(typeof h!="object"){h={}}q.popup=Alfresco.util.PopupManager.displayMessage({modal:true,displayTime:0,text:n.message,effect:null});h.popup=q.popup}var f;if(g.stem){f=g.stem+g.name}else{f=this.defaultConfig.urlStem+g.name}if(k){f=YAHOO.lang.substitute(f,k);i=k}if(g.queryString){f+="?"+g.queryString}var i=YAHOO.lang.merge(this.defaultConfig,{successCallback:{fn:m,scope:this,obj:q},successMessage:null,failureCallback:{fn:m,scope:this,obj:h},failureMessage:null,url:f,method:g.method,responseContentType:Alfresco.util.Ajax.JSON,object:i});return this._runAction(i,j)},postActivity:function d(k,f,i,h,m){if(!Alfresco.util.isValueSet(k)){if(typeof m==="function"){m()}return}var l=function(){if(typeof m==="function"){m()}};var g={method:"POST",url:Alfresco.constants.PROXY_URI+"slingshot/doclib/activity",successCallback:{fn:l,scope:this},successMessage:null,failureCallback:{fn:l,scope:this},failureMessage:null,object:null};g.dataObj=YAHOO.lang.merge({site:k,type:f,page:i},h);Alfresco.logger.debug("Alfresco.module.DoclibActions.postActivity: ",g.dataObj);try{Alfresco.util.Ajax.jsonRequest(g)}catch(j){}}};var c=new Alfresco.module.DoclibActions()})();