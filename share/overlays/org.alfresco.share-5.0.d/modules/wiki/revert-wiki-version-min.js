(function(){Alfresco.module.RevertWikiVersion=function(l){this.name="Alfresco.module.RevertWikiVersion";this.id=l;var k=Alfresco.util.ComponentManager.get(this.id);if(k!==null){throw new Error("An instance of Alfresco.module.RevertWikiVersion already exists.")}Alfresco.util.ComponentManager.register(this);Alfresco.util.YUILoaderHelper.require(["button","container","datatable","datasource"],this.onComponentsLoaded,this);return this};Alfresco.module.RevertWikiVersion.prototype={defaultShowConfig:{siteId:null,pageTitle:null,version:null,versionId:null,onRevertWikiVersionComplete:null},showConfig:{},widgets:{},onComponentsLoaded:function i(){if(this.id===null){return}},show:function e(k){this.showConfig=YAHOO.lang.merge(this.defaultShowConfig,k);if(false&&this.showConfig.nodeRef===undefined&&this.showConfig.version===undefined){throw new Error("A nodeRef, filename and version must be provided")}if(this.widgets.panel){this._showPanel()}else{Alfresco.util.Ajax.request({url:Alfresco.constants.URL_SERVICECONTEXT+"modules/wiki/revert-wiki-version?htmlid="+this.id,successCallback:{fn:this.onTemplateLoaded,scope:this},failureMessage:Alfresco.util.message("message.templateFailure",this.name),execScripts:true})}},onTemplateLoaded:function f(k){var m=YAHOO.util.Dom;var n=document.createElement("div");n.innerHTML=k.serverResponse.responseText;var l=YAHOO.util.Dom.getFirstChild(n);this.widgets.panel=Alfresco.util.createYUIPanel(l);this.widgets.promptText=m.get(this.id+"-prompt-span");this.widgets.okButton=Alfresco.util.createYUIButton(this,"ok-button",this.onOkButtonClick);this.widgets.cancelButton=Alfresco.util.createYUIButton(this,"cancel-button",this.onCancelButtonClick);this._showPanel()},onOkButtonClick:function h(){this.widgets.okButton.set("disabled",true);this.widgets.cancelButton.set("disabled",true);var k=YAHOO.lang.substitute(Alfresco.constants.PROXY_URI+"slingshot/wiki/version/{site}/{title}/{version}",{site:this.showConfig.siteId,title:encodeURIComponent(this.showConfig.pageTitle),version:this.showConfig.versionId});Alfresco.util.Ajax.request({method:Alfresco.util.Ajax.GET,url:k,successCallback:{fn:this.onVersionContent,scope:this},failureMessage:"Could not retrieve version content"});this.widgets.panel.hide();this.widgets.feedbackMessage=Alfresco.util.PopupManager.displayMessage({text:Alfresco.util.message("message.reverting",this.name,{"0":this.showConfig.pageTitle,"1":this.showConfig.version}),spanClass:"wait",displayTime:0})},onVersionContent:function c(m){var l=YAHOO.lang.substitute(Alfresco.constants.PROXY_URI+"slingshot/wiki/page/{site}/{title}",{site:this.showConfig.siteId,title:encodeURIComponent(this.showConfig.pageTitle)});var k=m.serverResponse.responseText;var n={pagecontent:k,page:"wiki-page",forceSave:true};Alfresco.util.Ajax.request({method:Alfresco.util.Ajax.PUT,url:l,dataObj:n,requestContentType:Alfresco.util.Ajax.JSON,successCallback:{fn:this.onRevertSuccess,scope:this},failureCallback:{fn:this.onRevertFailure,scope:this}})},onRevertSuccess:function d(k){this.widgets.feedbackMessage.destroy();YAHOO.Bubbling.fire("wikiVersionReverted",{siteId:this.showConfig.siteId,pageTitle:this.showConfig.pageTitle,version:this.showConfig.version,versionId:this.showConfig.versionId});var l={successful:[{siteId:this.showConfig.siteId,pageTitle:this.showConfig.pageTitle,version:this.showConfig.version,versionId:this.showConfig.versionId}]};var m=this.showConfig.onRevertWikiVersionComplete;if(m&&typeof m.fn=="function"){m.fn.call((typeof m.scope=="object"?m.scope:this),l,m.obj)}},onRevertFailure:function g(k){this.widgets.feedbackMessage.destroy();this.widgets.okButton.set("disabled",false);Alfresco.util.PopupManager.displayMessage({text:Alfresco.util.message("message.failure",this.name,{"0":this.showConfig.pageTitle})})},onCancelButtonClick:function b(){this.widgets.panel.hide();this.widgets.okButton.set("disabled",false)},_applyConfig:function j(){var l=YAHOO.util.Dom;var k=Alfresco.util.message("label.prompt",this.name,{"0":this.showConfig.pageTitle,"1":this.showConfig.version});this.widgets.promptText.innerHTML=k;this.widgets.cancelButton.set("disabled",false)},_showPanel:function a(){this._applyConfig();this.widgets.panel.show()}}})();Alfresco.module.getRevertWikiVersionInstance=function(){var a="alfresco-revertWikiVersion-instance";return Alfresco.util.ComponentManager.get(a)||new Alfresco.module.RevertWikiVersion(a)};