Alfresco.gutter=function(c){var b=YAHOO.util.Dom,a=YAHOO.util.Anim;return({status:false,gutter:null,createGutter:function(){this.gutter=new YAHOO.widget.Overlay("gutter1",{height:"372px",width:"260px",position:"absolute",visible:false});this.gutter.hideEvent.subscribe(function(){b.setStyle("image_results","overflow","hidden");b.setStyle("gutter1","visibility","hidden")},this,true);this.gutter.showEvent.subscribe(function(){this.gutter.cfg.setProperty("context",[b.get(c.getContainer()),YAHOO.widget.Overlay.TOP_RIGHT,YAHOO.widget.Overlay.TOP_RIGHT]);b.setStyle("gutter1","visibility","visible");b.setStyle("image_results","overflow","auto")},this,true);new YAHOO.util.KeyListener(document,{keys:YAHOO.util.KeyListener.KEY.ESCAPE},{fn:function(){if(this.status){this.toggle()}},scope:this,correctScope:true}).enable();var d=Alfresco.util.message("imagelib.title");this.gutter.setBody('<div class="yui-toolbar-container"><div class="yui-toolbar-titlebar"><h2>'+d+'</h2></div></div><div id="image_results"></div>');this.gutter.render(document.body)},open:function(){this.gutter.show();this.status=true},close:function(){this.gutter.hide();this.status=false},toggle:function(){if(this.status){this.close()}else{this.open()}}})};Alfresco.util=Alfresco.util||{};Alfresco.util.createImageEditor=function(a,i){var d=YAHOO.util.Dom,h=YAHOO.util.Event;var c=Alfresco.util.encodeHTML;YAHOO.Bubbling.on("editorInitialized",function(j){b.createGutter()});i.setup=function(j){j.addButton("alfresco-imagelibrary",{title:Alfresco.util.message("imagelib.tooltip"),icon:"image",onclick:function(k){b.toggle.call(b)}});j.addButton("alfresco-linklibrary",{title:Alfresco.util.message("linklib.tooltip"),icon:"newdocument",onclick:function(k){f.onShowPicker()}});YAHOO.Bubbling.on("alfresco-imagelibClick",function(m,k){if(k&&k[1].img){var l='<img src="'+k[1].img+'" title="'+m.title+'"/>';j.execCommand("mceInsertContent",false,l)}b.toggle()});YAHOO.Bubbling.on("onDocumentsSelected",function(p,s){if(s&&s[1].items){var k=j.selection.getContent();for(var n=0,m=s[1].items.length;n<m;n++){var l=s[1].items[n],t=encodeURIComponent(l.nodeRef),r=(k&&k.length>0)?k:l.name;var q=Alfresco.util.siteURL("document-details?nodeRef="+t);var o='<a href="'+q+'">'+r+"</a> ";if(YAHOO.env.ua.ie==8){e.focus()}j.execCommand("mceInsertContent",false,o);f.resetSelection()}}})};var e=new Alfresco.util.RichEditor(Alfresco.constants.HTML_EDITOR,a,i);var b=new Alfresco.gutter(e);var f;var g=Alfresco.constants.PROXY_URI+"slingshot/doclib/container/"+i.siteId+"/documentlibrary";Alfresco.util.Ajax.jsonGet({url:g,successCallback:{fn:function(j){var k=j.json.container.nodeRef;f=new Alfresco.module.DocumentPicker(a+"-docPicker",Alfresco.ObjectRenderer);f.setOptions({displayMode:"items",itemFamily:"node",itemType:"cm:content",multipleSelectMode:true,parentNodeRef:k,restrictParentNavigationToDocLib:true});f.onComponentsLoaded()},scope:this}});h.onAvailable("image_results",function(){h.on("image_results","mousedown",function(k){h.stopEvent(k);var l=h.getTarget(k);if(l.tagName.toLowerCase()=="img"){var j=l.getAttribute("longdesc");if(YAHOO.env.ua.ie>0&&YAHOO.env.ua.ie<8){j=l.longdesc}if(j){title=l.getAttribute("title");YAHOO.Bubbling.fire("alfresco-imagelibClick",{type:"alfresco-imagelibClick",img:j,title:title})}}},e,true);Alfresco.util.Ajax.request({method:Alfresco.util.Ajax.GET,dataObj:{max:"250"},url:Alfresco.constants.PROXY_URI+"slingshot/doclib/images/site/"+i.siteId+"/documentLibrary",successCallback:{fn:function(o){var s=YAHOO.lang.JSON.parse(o.serverResponse.responseText);if(s){var k=d.get("image_results"),p=s.items,r,q,n;for(var m=0,l=p.length;m<l;m++){r=p[m];q=r.nodeRef.replace(":/","");n=document.createElement("img");n.setAttribute("src",Alfresco.constants.PROXY_URI+"api/node/"+q+"/content/thumbnails/doclib?c=queue&ph=true");n.setAttribute("longdesc",Alfresco.constants.PROXY_URI_RELATIVE+"api/node/content/"+q+"/"+c(r.title));n.setAttribute("title",c(r.title));k.appendChild(n)}}},scope:this},failureCallback:{fn:function(j){return}}})});return e};