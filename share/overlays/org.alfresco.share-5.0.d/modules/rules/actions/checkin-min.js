(function(){var f=YAHOO.util.Dom,e=YAHOO.util.KeyListener;var c=Alfresco.util.encodeHTML;Alfresco.module.RulesCheckinAction=function(i){Alfresco.module.RulesCheckinAction.superclass.constructor.call(this,"Alfresco.module.RulesCheckinAction",i,["button","container","connection"]);return this};YAHOO.extend(Alfresco.module.RulesCheckinAction,Alfresco.component.Base,{options:{templateUrl:Alfresco.constants.URL_SERVICECONTEXT+"modules/rules/actions/checkin"},containerDiv:null,showDialog:function d(i){if(!this.containerDiv){Alfresco.util.Ajax.request({url:this.options.templateUrl,dataObj:{htmlid:this.id},successCallback:{fn:this.onTemplateLoaded,obj:i,scope:this},failureMessage:"Could not load template:"+this.options.templateUrl,execScripts:true})}else{this._showDialog(i)}},onTemplateLoaded:function h(j,l){this.containerDiv=document.createElement("div");this.containerDiv.setAttribute("style","display:none");this.containerDiv.innerHTML=j.serverResponse.responseText;var k=f.getFirstChild(this.containerDiv);this.widgets.dialog=Alfresco.util.createYUIPanel(k);this.widgets.okButton=Alfresco.util.createYUIButton(this,"ok-button",null,{type:"submit"});this.widgets.cancelButton=Alfresco.util.createYUIButton(this,"cancel-button",this.onCancelClick);var m=new Alfresco.forms.Form(this.id+"-form");this.widgets.form=m;m.addValidation(this.id+"-comments",Alfresco.forms.validation.length,{max:256,crop:true},"keyup");m.setSubmitElements(this.widgets.okButton);m.doBeforeAjaxRequest={fn:function(n,o){YAHOO.Bubbling.fire("checkinConfigCompleted",{options:{version:n.dataObj.version,comments:n.dataObj.comments},eventGroup:this});this.widgets.dialog.hide();return false},obj:null,scope:this};m.applyTabFix();m.init();var i=new e(document,{keys:e.KEY.ESCAPE},{fn:function(o,n){this.onCancelClick()},scope:this,correctScope:true});i.enable();this._showDialog(l)},_showDialog:function b(k){k=k?k:{};var i=f.get(this.id+"-version-major"),l=f.get(this.id+"-version-minor"),j;if(k.version=="minor"||k.version==null||k.version==""){l.checked=true;j=l;i.checked=false}else{if(k.version=="major"){i.checked=true;j=i;l.checked=false}}f.get(this.id+"-comments").value=k.comments?k.comments:"";this.widgets.form.validate();this.widgets.dialog.show();j.focus()},onCancelClick:function a(i,j){this.widgets.dialog.hide()}});var g=new Alfresco.module.RulesCheckinAction("null")})();