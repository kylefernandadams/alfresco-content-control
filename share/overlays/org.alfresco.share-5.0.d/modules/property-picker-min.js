(function(){var c=YAHOO.util.Dom,g=YAHOO.util.Event;Alfresco.module.PropertyPicker=function(j){Alfresco.module.PropertyPicker.superclass.constructor.call(this,j);this.options=YAHOO.lang.merge(this.options,Alfresco.util.deepCopy(Alfresco.module.PropertyPicker.superclass.options,{copyFunctions:true}));this.options.dataTableColumnDefinitions.push({key:"id",sortable:true});this.name="Alfresco.module.PropertyPicker";Alfresco.util.ComponentManager.reregister(this);return this};YAHOO.extend(Alfresco.module.PropertyPicker,Alfresco.module.DataPicker,{options:{propertyPickerTemplateUrl:Alfresco.constants.URL_SERVICECONTEXT+"modules/property-picker",transientProperties:{},classFilter:{aspects:{visible:[]},types:{visible:[]}},tabs:[{id:"properties",treeNodes:[{id:"all",listItems:{url:"{url.proxy}api/properties",dataModifier:function(k,j){return this._addTransientProperties(k)},id:"{item.name}",type:"{item.dataType}",label:"{item.title}",title:"{item.name}"}},{id:"aspects",treeNodes:{url:"{url.proxy}api/classes?cf=aspect",id:"{node.name}",title:"{node.name}",label:"{node.title}",listItems:{url:"{url.proxy}api/classes/{node.name}/properties",dataModifier:function(k,j){return this._addTransientProperties(k)},id:"{item.name}",type:"{item.dataType}",label:"{item.title}",title:"{item.name}"}}},{id:"types",treeNodes:{url:"{url.proxy}api/classes?cf=type",id:"{node.name}",title:"{node.name}",label:"{node.title}",listItems:{url:"{url.proxy}api/classes/{node.name}/properties",dataModifier:function(k,j){return this._addTransientProperties(k)},id:"{item.name}",type:"{item.dataType}",label:"{item.title}",title:"{item.name}"}}}],listItems:[]}]},onTemplateLoaded:function d(j){Alfresco.util.Ajax.request({url:this.options.propertyPickerTemplateUrl,dataObj:{htmlid:this.id},successCallback:{fn:this.onPropertyPickerTemplateLoaded,obj:j,scope:this},failureMessage:this.msg("message.load.template.error",this.options.propertyPickerTemplateUrl),execScripts:true})},onPropertyPickerTemplateLoaded:function f(j,k){var l=document.createElement("div");l.setAttribute("style","display:none");l.innerHTML=j.serverResponse.responseText;Alfresco.module.PropertyPicker.superclass.onTemplateLoaded.call(this,k)},_filterClasses:function b(m,n){var j=[];for(var l=0,k=m.length;l<k;l++){if(Alfresco.util.arrayContains(n,m[l].name)){j.push(m[l])}}return j},_addTransientProperties:function e(s,k){var p=[],l=this.options.transientProperties,w=0;for(var n=0,r=s.length;n<r;n++){for(var j in l){if(l.hasOwnProperty(j)&&s[n].dataType==j){p.push({type:j,index:n,properties:l[j]})}}}for(n=0,r=p.length;n<r;n++){var m=p[n],u=m.properties.length,x=p[n].index+w,t=Alfresco.util.deepCopy(s[x]),q=t.title?t.title:t.name,v,o;for(o=0;o<u;o++){s.splice(x+o,0,Alfresco.util.deepCopy(t))}for(o=0;o<u;o++){v=s[x+o+1];v.title=this.msg("label.transientProperty",m.properties[o].displayLabel,t.name);v.name=t.name+":"+m.properties[o].value}w+=u}return s},msg:function a(k){var j=Alfresco.util.message.call(this,k,this.name,Array.prototype.slice.call(arguments).slice(1));if(j==k){j=Alfresco.util.message(k,"Alfresco.module.DataPicker",Array.prototype.slice.call(arguments).slice(1))}return j},_showDialog:function i(){c.addClass(this.widgets.dialog.body.parentNode,"property-picker");Alfresco.module.PropertyPicker.superclass._showDialog.call(this)}});var h=new Alfresco.module.PropertyPicker("null")})();