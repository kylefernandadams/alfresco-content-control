(function(){var d=YAHOO.util.Dom,k=YAHOO.util.Event,a=YAHOO.util.Element;var c=Alfresco.util.encodeHTML;Alfresco.ConsoleTrashcan=function(n){this.name="Alfresco.ConsoleTrashcan";Alfresco.ConsoleTrashcan.superclass.constructor.call(this,n);Alfresco.util.ComponentManager.register(this);Alfresco.util.YUILoaderHelper.require(["button","container","datasource","datatable","paginator","json","history"],this.onComponentsLoaded,this);var p=this;ListPanelHandler=function q(){ListPanelHandler.superclass.constructor.call(this,"list")};YAHOO.extend(ListPanelHandler,Alfresco.ConsolePanelHandler,{onLoad:function o(){p.widgets.emptyButton=Alfresco.util.createYUIButton(p,"empty-button",p.onEmptyClick)}});new ListPanelHandler();return this};YAHOO.extend(Alfresco.ConsoleTrashcan,Alfresco.ConsoleTool,{onReady:function m(){Alfresco.ConsoleTrashcan.superclass.onReady.call(this);var n=Alfresco.constants.PROXY_URI+"api/archive/workspace/SpacesStore";this.widgets.pagingDataTable=new Alfresco.util.DataTable({dataTable:{container:this.id+"-datalist",columnDefinitions:[{key:"thumbnail",sortable:false,formatter:this.bind(this.renderCellIcon),width:32},{key:"description",sortable:false,formatter:this.bind(this.renderCellDescription)},{key:"actions",sortable:false,formatter:this.bind(this.renderCellActions),width:200}]},dataSource:{url:n,config:{responseSchema:{resultsList:"data.deletedNodes"}}},paginator:{config:{containers:[this.id+"-paginator"],rowsPerPage:50}}})},onEmptyClick:function j(p,n){var o=this;Alfresco.util.PopupManager.displayPrompt({title:o.msg("button.empty"),text:o.msg("message.empty.confirm"),buttons:[{text:o.msg("button.ok"),handler:function(){this.destroy();var s=Alfresco.util.PopupManager.displayMessage({displayTime:0,effect:null,text:o.msg("message.empty.inprogress")});Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"api/archive/workspace/SpacesStore",method:"DELETE",successCallback:{fn:function r(t){s.destroy();o.refreshDataTable()}},failureCallback:{fn:function q(t){s.destroy();Alfresco.util.PopupManager.displayPrompt({text:o.msg("message.recover.failure")})}}})}},{text:o.msg("button.cancel"),handler:function(){this.destroy()},isDefault:true}]})},renderCellIcon:function h(q,p,r,t){var n=p.getData("name"),o=p.getData("nodeType"),s=n.substring(n.lastIndexOf("."));d.setStyle(q,"width",r.width+"px");d.setStyle(q.parentNode,"width",r.width+"px");q.innerHTML='<span class="icon32"><img src="'+Alfresco.constants.URL_RESCONTEXT+"components/images/filetypes/"+Alfresco.util.getFileIcon(n,o)+'" alt="'+c(n)+'" /></span>'},renderCellDescription:function l(o,n,q,t){var s=n.getData("firstName")+" "+n.getData("lastName");var p=c(this.msg("message.metadata",Alfresco.util.formatDate(Alfresco.util.fromISO8601(n.getData("archivedDate"))),s));var r='<div class="name">'+c(n.getData("name"))+'</div><div class="desc">'+p+'</div><div class="desc">'+c(n.getData("displayPath"))+"</div>";o.innerHTML=r},renderCellActions:function g(p,o,q,s){var n=o.getData("nodeRef"),r=o.getData("name");this._createActionButton(p,n.split("/")[3],"button.recover",function(t,u){Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"api/archive/"+u.nodeRef.replace(":/",""),method:"PUT",successCallback:{fn:this._onRecoverSuccess,obj:u,scope:this},failureMessage:this.msg("message.recover.failure",r)})},{nodeRef:n,name:r});this._createActionButton(p,n.split("/")[3],"button.delete",function(t,u){Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"api/archive/"+u.nodeRef.replace(":/",""),method:"DELETE",successCallback:{fn:this._onDeleteSuccess,obj:u,scope:this},failureMessage:this.msg("message.delete.failure",r)})},{nodeRef:n,name:r})},refreshDataTable:function e(){this.widgets.pagingDataTable.loadDataTable()},_onRecoverSuccess:function f(n,o){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.recover.success",o.name)});this.refreshDataTable()},_onDeleteSuccess:function i(n,o){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.delete.success",o.name)});this.refreshDataTable()},_createActionButton:function b(p,u,t,r,s){var q=this;var o=document.createElement("span");o.id=q.id+u;var n=new YAHOO.widget.Button({container:q.id+u});n.set("label",q.msg(t));n.set("onclick",{fn:r,obj:s,scope:q});p.appendChild(o)}})})();