(function(){var d=YAHOO.util.Dom,b=YAHOO.util.Event,c=YAHOO.util.Element;var a=Alfresco.util.encodeHTML;Alfresco.GenericFormTool=function(f){this.name="Alfresco.GenericFormTool";Alfresco.GenericFormTool.superclass.constructor.call(this,f);Alfresco.util.ComponentManager.register(this);Alfresco.util.YUILoaderHelper.require(["button","history"],this.onComponentsLoaded,this);var i=this;ViewPanelHandler=function k(){ViewPanelHandler.superclass.constructor.call(this,"view")};YAHOO.extend(ViewPanelHandler,Alfresco.ConsolePanelHandler,{onBeforeShow:function h(){Alfresco.util.Ajax.request({url:Alfresco.constants.URL_SERVICECONTEXT+"components/form",dataObj:{htmlid:i.id+"-"+i.options.mode+"-"+Alfresco.util.generateDomId(),itemKind:i.options.itemKind,itemId:i.options.itemId,mode:"view",formUI:false,err:i.options.errorKey||""},successCallback:{fn:function l(m){var n=d.get(i.id+"-"+this.id+"-form");n.innerHTML=m.serverResponse.responseText},scope:this},failureMessage:i.msg("message.failure"),scope:this,execScripts:true})}});new ViewPanelHandler();EditPanelHandler=function j(){EditPanelHandler.superclass.constructor.call(this,"edit");YAHOO.Bubbling.on("beforeFormRuntimeInit",this.onBeforeFormRuntimeInit,this);YAHOO.Bubbling.on("formContentReady",this.onFormContentReady,this)};YAHOO.extend(EditPanelHandler,Alfresco.ConsolePanelHandler,{onBeforeShow:function h(){Alfresco.util.Ajax.request({url:Alfresco.constants.URL_SERVICECONTEXT+"components/form",dataObj:{htmlid:i.id+"-"+i.options.mode+"-"+Alfresco.util.generateDomId(),itemKind:i.options.itemKind,itemId:i.options.itemId,mode:"edit",formUI:true,submitType:"json",showCaption:true,showCancelButton:i.options.showCancelButton,showSubmitButton:i.options.showSubmitButton},successCallback:{fn:function l(m){var n=d.get(i.id+"-"+this.id+"-form");n.innerHTML=m.serverResponse.responseText},scope:this},failureMessage:i.msg("message.failure"),scope:this,execScripts:true})},onFormContentReady:function g(m,l){if(l[1].buttons.submit){l[1].buttons.submit.set("label",i.msg("button.save"))}if(l[1].buttons.cancel){l[1].buttons.cancel.addListener("click",i.showViewPanel,i,true)}},onBeforeFormRuntimeInit:function e(m,l){l[1].runtime.setAJAXSubmit(true,{successCallback:{fn:function(){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.save.success")});this.showViewPanel()},scope:i},failureCallback:{fn:function(n){Alfresco.util.PopupManager.displayPrompt({title:this.msg("message.failure"),text:(n.json&&n.json.message?n.json.message:this.msg("message.save.failure"))})},scope:i}})}});new EditPanelHandler();return this};YAHOO.extend(Alfresco.GenericFormTool,Alfresco.ConsoleTool,{options:{itemKind:null,itemId:null,errorKey:null,showCancelButton:true,showSubmitButton:true},showViewPanel:function(){this.refreshUIState({panel:"view"})},showEditPanel:function(){this.refreshUIState({panel:"edit"})}})})();