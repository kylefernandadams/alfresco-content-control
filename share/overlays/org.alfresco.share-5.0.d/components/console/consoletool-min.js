(function(){var g=YAHOO.util.Dom;Alfresco.ConsoleTool=function(k){this.id=k;this.widgets={};this.modules={};this.services={};this.popups={};this.panels=[];this.currentPanelId="";YAHOO.Bubbling.on("stateChanged",this.onStateChanged,this);var p=this;Alfresco.ConsolePanelHandler=function(r){this.id=r;this.widgets={};this.modules={};this.forms={};p.panels.push(this)};Alfresco.ConsolePanelHandler.prototype={id:null,widgets:null,modules:null,forms:null,onLoad:function o(){},onBeforeShow:function n(){},onShow:function q(){},onUpdate:function m(){},onHide:function l(){}};return this};YAHOO.extend(Alfresco.ConsoleTool,Alfresco.component.Base,{popups:null,panels:null,currentPanelId:null,onReady:function a(){var m=YAHOO.util.History.getBookmarkedState("state")||this.encodeHistoryState({panel:this.panels[0].id});YAHOO.util.History.register("state",m,function k(n){YAHOO.Bubbling.fire("stateChanged",{state:n})});YAHOO.util.History.onReady(this.onHistoryManagerReady,this,true);try{YAHOO.util.History.initialize("yui-history-field","yui-history-iframe")}catch(l){Alfresco.logger.error("Alfresco.ConsoleTool: Couldn't initialize HistoryManager.",l);this.onHistoryManagerReady()}},onHistoryManagerReady:function d(){if(!this.historyManagerReady){for(var k in this.panels){this.panels[k].onLoad()}var l=YAHOO.util.History.getBookmarkedState("state")||this.encodeHistoryState({panel:this.panels[0].id});YAHOO.Bubbling.fire("stateChanged",{state:l});this.historyManagerReady=true}var l=YAHOO.util.History.getBookmarkedState("state")||this.encodeHistoryState({panel:this.panels[0].id});YAHOO.Bubbling.fire("stateChanged",{state:l})},onStateChanged:function i(m,k){var l=this.decodeHistoryState(k[1].state);if(l.panel){this.showPanel(l.panel)}},decodeHistoryState:function f(m){var n={};var l=m.split("&");for(var k=0;k<l.length;k++){var o=l[k].split("=");n[o[0]]=decodeURIComponent(o[1])}return n},encodeHistoryState:function b(m){var k={};if(this.currentPanelId!==""){k.panel=this.currentPanelId}var l="";if(m.panel||k.panel){l+="panel="+encodeURIComponent(m.panel?m.panel:k.panel)}return l},showPanel:function h(n){if(this.currentPanelId!==n){this.currentPanelId=n;var l=null,k,m;for(m in this.panels){k=this.panels[m];if(k.id===n){l=k}else{g.addClass(this.id+"-"+k.id,"hidden");k.onHide()}}if(l!==null){l.onBeforeShow();g.removeClass(this.id+"-"+n,"hidden");g.setStyle(this.id+"-"+n,"display","none");Alfresco.util.Anim.fadeIn(this.id+"-"+n);l.onShow()}}},_getCurrentPanel:function e(){var k=null;for(var l in this.panels){if(this.panels[l].id===this.currentPanelId){k=this.panels[l];break}}return k},updateCurrentPanel:function c(){for(var k in this.panels){if(this.panels[k].id===this.currentPanelId){this.panels[k].onUpdate();break}}},refreshUIState:function j(k){YAHOO.util.History.navigate("state",this.encodeHistoryState(k))}})})();