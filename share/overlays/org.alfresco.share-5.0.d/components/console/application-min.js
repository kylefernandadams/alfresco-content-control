(function(){var d=YAHOO.util.Dom,b=YAHOO.util.Event,c=YAHOO.util.Element;var a=Alfresco.util.encodeHTML;Alfresco.ConsoleApplication=function(g){this.name="Alfresco.ConsoleApplication";Alfresco.ConsoleApplication.superclass.constructor.call(this,g);Alfresco.util.ComponentManager.register(this);Alfresco.util.YUILoaderHelper.require(["button","container","json","history"],this.onComponentsLoaded,this);var i=this;OptionsPanelHandler=function k(){OptionsPanelHandler.superclass.constructor.call(this,"options")};YAHOO.extend(OptionsPanelHandler,Alfresco.ConsolePanelHandler,{onLoad:function h(){i.widgets.applyButton=Alfresco.util.createYUIButton(i,"apply-button",null,{type:"submit"});i.widgets.upload=Alfresco.util.createYUIButton(i,"upload-button",this.onUpload);i.widgets.reset=Alfresco.util.createYUIButton(i,"reset-button",this.onReset);var m=new Alfresco.forms.Form(i.id+"-options-form");m.setSubmitElements([i.widgets.applyButton]);m.setSubmitAsJSON(true);m.setAJAXSubmit(true,{successCallback:{fn:this.onSuccess,scope:this}});m.init()},onSuccess:function l(m){if(m&&m.json){if(m.json.success){window.location.reload(true)}else{if(m.json.message){Alfresco.util.PopupManager.displayPrompt({text:m.json.message})}}}else{Alfresco.util.PopupManager.displayPrompt({text:Alfresco.util.message("message.failure")})}},onUpload:function f(n,o){if(!this.fileUpload){this.fileUpload=Alfresco.getFileUploadInstance()}var m={flashUploadURL:"slingshot/application/uploadlogo",htmlUploadURL:"slingshot/application/uploadlogo.html",mode:this.fileUpload.MODE_SINGLE_UPLOAD,onFileUploadComplete:{fn:this.onFileUploadComplete,scope:this}};this.fileUpload.show(m);b.preventDefault(n)},onReset:function j(n,o){var m=d.get(this.id+"-logoimg");m.src=i.options.defaultlogo;d.get("console-options-logo").value="reset"}});new OptionsPanelHandler();return this};YAHOO.extend(Alfresco.ConsoleApplication,Alfresco.ConsoleTool,{onFileUploadComplete:function e(f){var i=f.successful.length;if(i!=0){var h=f.successful[0].nodeRef;var g=d.get(this.id+"-logoimg");g.src=Alfresco.constants.PROXY_URI+"api/node/"+h.replace("://","/")+"/content";d.get("console-options-logo").value=h}}})})();