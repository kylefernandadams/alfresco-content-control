(function(){var g=YAHOO.util.Dom,l=YAHOO.util.Event;var e=Alfresco.util.encodeHTML;Alfresco.dashlet.SavedSearch=function m(n){Alfresco.dashlet.SavedSearch.superclass.constructor.call(this,"Alfresco.dashlet.SavedSearch",n,["container","datasource","datatable"]);this.configDialog=null;return this};YAHOO.extend(Alfresco.dashlet.SavedSearch,Alfresco.component.SearchBase,{onReady:function h(){g.get(this.id+"-title").innerHTML=this.buildTitle(this.options.title);this.createDataTable(this.options.searchTerm,this.options.limit)},buildNameWithHref:function i(n,o){return'<h3 class="itemname"> <a class="theme-color-1" href='+n+">"+o+"</a></h3>"},buildDescription:function k(n,o,p){var r="";var q=this.options.siteId;if(!(q&&q!=null)){r=n+" "+this.msg("message.insite")+' <a href="'+Alfresco.constants.URL_PAGECONTEXT+"site/"+o+'/dashboard">'+e(p)+"</a>"}return r},buildTitle:function c(n){var n=YAHOO.lang.trim(n);if(!n||n==null||n.length==0){n=this.msg("header.title")}return n},buildUrl:function b(o,n){var p=Alfresco.constants.PROXY_URI+"slingshot/search?term={term}&maxResults={maxResults}&rootNode={rootNode}";var q=this.options.siteId;if(q&&q!=null){p+="&site="+q}return YAHOO.lang.substitute(p,{term:encodeURIComponent(YAHOO.lang.trim(o)),maxResults:YAHOO.lang.trim(n),rootNode:encodeURIComponent(this.options.searchRootNode)})},createDataTable:function j(o,n){this.widgets.alfrescoDataTable=new Alfresco.util.DataTable({dataSource:{url:this.buildUrl(o,n),config:{responseSchema:{resultsList:"items"}}},dataTable:{container:this.id+"-search-results",columnDefinitions:[{key:"site",formatter:this.bind(this.renderCellThumbnail),width:48},{key:"path",formatter:this.bind(this.renderCellDescription)}],config:{MSG_EMPTY:this.msg("no.result")}}})},renderCellThumbnail:function a(o,n,p,q){if(n.getData("type")==="document"){g.addClass(o.parentNode,"thumbnail")}o.innerHTML=this.buildThumbnailHtml(n,48,48)},renderCellDescription:function f(A,D,v,s){var w=D.getData("type"),q=D.getData("name"),x=D.getData("displayName"),r=D.getData("site"),C=D.getData("path"),z=D.getData("nodeRef"),p=D.getData("container"),o=D.getData("modifiedOn"),y=r.shortName,t=r.title,B=Alfresco.util.formatDate(Alfresco.util.fromISO8601(o)),u=this.buildTextForType(w),n=this.getBrowseUrl(q,w,r,C,z,p,B);A.innerHTML=this.buildNameWithHref(n,x)+this.buildDescription(u,y,t)+this.buildPath(w,C,r)},onConfigSearchClick:function d(o){l.stopEvent(o);if(!this.configDialog){this.configDialog=new Alfresco.module.SimpleDialog(this.id+"-configDialog").setOptions({width:"50em",templateUrl:Alfresco.constants.URL_SERVICECONTEXT+"modules/search/config",onSuccess:{fn:function n(t){var s=t.config.dataObj,r=s.searchTerm,q=s.limit,u=s.title;this.options.searchTerm=r;this.options.limit=q;this.options.title=this.buildTitle(u);g.get(this.id+"-title").innerHTML=this.options.title;this.createDataTable(r,q)},scope:this},doSetupFormsValidation:{fn:function p(q){q.addValidation(this.configDialog.id+"-searchTerm",Alfresco.forms.validation.mandatory,null,"keyup");g.get(this.configDialog.id+"-searchTerm").value=this.options.searchTerm;g.get(this.configDialog.id+"-limit").value=this.options.limit;g.get(this.configDialog.id+"-title").value=this.options.title},scope:this}})}this.configDialog.setOptions({actionUrl:Alfresco.constants.URL_SERVICECONTEXT+"modules/dashlet/config/"+this.options.componentId}).show()}})})();