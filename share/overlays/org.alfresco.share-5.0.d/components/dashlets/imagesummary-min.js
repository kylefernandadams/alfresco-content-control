(function(){var i=YAHOO.util.Event,c=YAHOO.util.Dom;var b=Alfresco.util.encodeHTML,f=Alfresco.util.hasEventInterest;Alfresco.dashlet.ImageSummary=function h(j){Alfresco.dashlet.ImageSummary.superclass.constructor.call(this,"Alfresco.dashlet.ImageSummary",j);i.addListener(window,"resize",this.resizeThumbnailList,this,true);return this};YAHOO.extend(Alfresco.dashlet.ImageSummary,Alfresco.component.Base,{itemsPerRow:0,itemPadding:"",onReady:function g(){this.refreshImages();YAHOO.Bubbling.on("folderSelected",function(k,j){if(f(this.modules.folderPicker,j)){var l=j[1].selectedFolder;if(l!==null){if(l.siteId===this.options.siteId){this.options.siteFolderPath=l.path;Alfresco.util.Ajax.jsonRequest({method:"POST",url:Alfresco.constants.URL_SERVICECONTEXT+"modules/dashlet/config/"+this.options.componentId,dataObj:{siteFolderPath:this.options.siteFolderPath},successCallback:{fn:function(m){this.refreshImages()},scope:this}})}}}},this)},refreshImages:function d(){c.addClass(this.id+"-message","hidden");var j=c.get(this.id+"-images");c.addClass(j,"hidden");j.innerHTML="";c.removeClass(this.id+"-wait","hidden");Alfresco.util.Ajax.jsonRequest({url:Alfresco.constants.PROXY_URI+"slingshot/doclib/images/site/"+this.options.siteId+"/documentLibrary"+(this.options.siteFolderPath?encodeURI(this.options.siteFolderPath):"")+"?max=250",successCallback:{fn:function(l){var r=c.get(this.id+"-item-template"),o=l.json.items;var q=unescape(r.innerHTML);for(var n=0,m=o.length,p,s;n<m;n++){s=o[n];var k={nodeRef:s.nodeRef,nodeRefUrl:s.nodeRef.replace(":/",""),name:encodeURIComponent(s.name),title:b(s.title),modifier:this.msg("text.modified-by",b(s.modifier)),modified:Alfresco.util.formatDate(Alfresco.util.fromISO8601(s.modifiedOn))};p=r.cloneNode(true);p.innerHTML=YAHOO.lang.substitute(q,k);j.appendChild(p)}c.addClass(this.id+"-wait","hidden");this.itemsPerRow=0;this.itemPadding="";this.resizeThumbnailList(null);c.removeClass(j,"hidden")},scope:this},failureCallback:{fn:function(k){c.addClass(this.id+"-wait","hidden");var l=c.get(this.id+"-message");if(k.json){l.innerHTML=b(k.json.message)}else{l.innerHTML=b(k.serverResponse.statusText)}c.removeClass(l,"hidden")},scope:this}})},resizeThumbnailList:function e(o){var r=c.get(this.id+"-list");if(r){var s=r.clientWidth-16-(o?0:16),n=Math.floor(s/110),q=(((s%110)/n/2)+3.5).toFixed(1);if(n===0){n=1}if(n!==this.itemsPerRow||q!==this.itemPadding){var p=c.getElementsByClassName("item",null,r);for(var m=0,l=p.length,k="0 "+q+"px 8px";m<l;m++){if(q!==this.itemPadding){c.setStyle(p[m],"padding",k)}if(n!==this.itemsPerRow){if(m%n===0){c.addClass(p[m],"initial")}else{c.removeClass(p[m],"initial")}}}this.itemPadding=q;this.itemsPerRow=n}}},onConfigImageFolderClick:function a(j){if(!this.modules.folderPicker){this.modules.folderPicker=new Alfresco.module.DoclibGlobalFolder(this.id+"-rulesPicker")}this.modules.folderPicker.setOptions({siteId:this.options.siteId,allowedViewModes:[Alfresco.module.DoclibGlobalFolder.VIEW_MODE_SITE],path:this.options.siteFolderPath,title:this.msg("text.selectfolder",this.options.siteTitle)}).showDialog()}})})();