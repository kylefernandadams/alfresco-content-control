(function(){var c=YAHOO.util.Dom,j=YAHOO.util.Event;var b=Alfresco.util.encodeHTML,m=Alfresco.util.formatDate,a=Alfresco.util.fromISO8601,f=Alfresco.util.toISO8601,h=Alfresco.util.message("date-format.longDate"),e=Alfresco.util.message("date-format.shortTime"),i=h+" "+e;Alfresco.dashlet.UserCalendar=function g(o){Alfresco.dashlet.UserCalendar.superclass.constructor.call(this,"Alfresco.dashlet.UserCalendar",o,["container","datasource","datatable"]);return this};YAHOO.extend(Alfresco.dashlet.UserCalendar,Alfresco.component.Base,{events:null,options:{listSize:100,maxDays:60},loadEvents:function(){var o=new Date();o.setDate(o.getDate()+this.options.maxDays);o=f(o).split("T")[0];Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"calendar/events/user?from=now&to="+o+"&size="+this.options.listSize,successCallback:{fn:this.onEventsLoaded,scope:this}})},onEventsLoaded:function d(o){this.events=o.json.events;var p=function q(r,s,t){s.results=this.events;this.widgets.dataTable.onDataReturnInitializeTable.call(this.widgets.dataTable,r,s,t)};this.widgets.dataSource.sendRequest(this.sites,{success:p,scope:this})},onReady:function n(){this.widgets.dataSource=new YAHOO.util.DataSource(this.events,{responseType:YAHOO.util.DataSource.TYPE_JSARRAY});var o=[{key:"icon",label:"",sortable:false,formatter:this.bind(this.renderCellIcon),width:32},{key:"event",label:"",sortable:false,formatter:this.bind(this.renderCellEvent)}];this.widgets.dataTable=new YAHOO.widget.DataTable(this.id+"-events",o,this.widgets.dataSource,{MSG_EMPTY:this.msg("label.noEvents")});this.loadEvents()},renderCellIcon:function l(p,o,q,s){c.setStyle(p,"width",q.width+"px");var r='<div class="icon"><img src="'+Alfresco.constants.URL_RESCONTEXT+'components/calendar/images/calendar-16.png" alt="event"/></div>';p.innerHTML=r},renderCellEvent:function k(v,x,t,o){var p=a(x.getData("startAt").iso8601),r=a(x.getData("endAt").iso8601),q=(m(p,h)===m(r,h))?true:false,w=(m(p,e)===m(r,e))?true:false,u=(x.getData("allday")==="true")?true:false,s='<div class="detail"><h4><a href="'+Alfresco.constants.URL_CONTEXT+x.getData("url")+'" class="theme-color-1">'+b(x.getData("title"))+"</a></h4>";s+="<div>";if(q){s+=m(p,h);if(!u){s+=" "+m(p,e);if(!w){s+=" - "+m(r,e)}}}else{if(u){s+=m(p,h)+" - "+m(r,h)}else{s+=m(p,i)+" - "+m(r,i)}}s+='</div><div><a href="'+Alfresco.constants.URL_PAGECONTEXT+"site/"+x.getData("site")+'/dashboard" class="theme-link-1">'+b(x.getData("siteTitle"))+"</a></div></div>";v.innerHTML=s}})})();