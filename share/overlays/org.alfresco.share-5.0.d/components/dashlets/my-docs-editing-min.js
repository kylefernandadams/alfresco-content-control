(function(){var c=YAHOO.util.Dom;var a=Alfresco.util.encodeHTML;$siteURL=Alfresco.util.siteURL,$profileURL=Alfresco.util.profileURL;Alfresco.dashlet.MyDocsEditing=function b(f){Alfresco.dashlet.MyDocsEditing.superclass.constructor.call(this,"Alfresco.dashlet.MyDocsEditing",f);return this};YAHOO.extend(Alfresco.dashlet.MyDocsEditing,Alfresco.component.Base,{onReady:function d(){Alfresco.util.Ajax.jsonRequest({url:Alfresco.constants.PROXY_URI+"slingshot/doclib/doclist/documents/node/alfresco/company/home?filter=editingMe&max=3&sortField=cm:modified&sortAsc=false",successCallback:{fn:function(h){var n=c.get(this.id+"-documents"),t=c.get(this.id+"-document-template"),q=h.json.items,p="onerror=\"this.src='"+Alfresco.constants.URL_CONTEXT+"res/components/images/filetypes/generic-file-32.png'\"";if(q.length!==0){var s=unescape(t.innerHTML);for(var m=0,k=q.length,r,u;m<k;m++){u=q[m];var f=u.location.site?$siteURL("dashboard",{site:u.location.site}):$profileURL(u.lockedByUser,u.lockedBy),o=u.fileName.lastIndexOf("."),v=o!==-1?u.fileName.substring(o+1):"generic",l=u.location.site?this.msg("details.editing-started-in-site",'<span class="relativeTime">'+Alfresco.util.relativeTime(u.modifiedOn)+"</span>",'<a class="theme-color-1 site-link" href="'+f+'">'+a(u.location.siteTitle)+"</a>"):this.msg("details.editing-started-by",'<span class="relativeTime">'+Alfresco.util.relativeTime(u.modifiedOn)+"</span>",'<a class="theme-color-1" href="'+f+'">'+a(u.lockedBy)+"</a>");var g={name:a(u.displayName),filename:encodeURIComponent(u.fileName),fileExt:v,site:u.location.site?("/site/"+u.location.site):"",editingMessage:l,onerror:p};r=t.cloneNode(true);r.innerHTML=YAHOO.lang.substitute(s,g);n.appendChild(r)}}else{n.innerHTML='<div class="detail-list-item first-item"><span class="faded">'+this.msg("label.noItems")+"</span>"}c.addClass(this.id+"-documents-wait","hidden");c.removeClass(n,"hidden")},scope:this},failureCallback:{fn:function(f){c.addClass(this.id+"-documents-wait","hidden");var g=c.get(this.id+"-message");g.innerHTML+="<p>"+a(f.json.message);+"</p>";c.removeClass(g,"hidden")},scope:this}});if(c.get(this.id+"-content-wait")!==null){Alfresco.util.Ajax.jsonRequest({url:Alfresco.constants.PROXY_URI+"slingshot/dashlets/my-contents",successCallback:{fn:function(g){var f=g.json,h=c.get(this.id+"-item-template");this.renderContentItems(f.blogPosts.items,"-blogposts","blog-postview?postId=","blogpost-32.png",h);this.renderContentItems(f.wikiPages.items,"-wikipages","wiki-page?title=","wikipage-32.png",h);this.renderContentItems(f.forumPosts.items,"-forumposts","discussions-topicview?topicId=","topicpost-32.png",h);c.getElementsByClassName("relativeTime","span",c.get(this.id+"-my-docs-dashlet"),function(){this.innerHTML=Alfresco.util.relativeTime(this.innerHTML)})},scope:this},failureCallback:{fn:function(f){c.addClass(this.id+"-content-wait","hidden");var g=c.get(this.id+"-message");g.innerHTML+="<p>"+a(f.json.message);+"</p>";c.removeClass(g,"hidden")},scope:this}})}},renderContentItems:function e(o,s,g,t,u){var m=c.get(this.id+s),n="components/images/"+t;if(o.length!==0){var r=unescape(u.innerHTML);for(var l=0,h=o.length,q,v;l<h;l++){v=o[l];var p=$siteURL("dashboard",{site:v.site.shortName}),k=this.msg("text.edited-on",'<span class="relativeTime">'+v.modifiedOn+"</span>",'<a class="theme-color-1 site-link" href="'+p+'">'+a(v.site.title)+"</a>");var f={name:a(v.displayName),icon:n,browseURL:$siteURL(g,{site:v.site.shortName})+encodeURIComponent(v.name),editingMessage:k};q=u.cloneNode(true);q.innerHTML=YAHOO.lang.substitute(r,f);m.appendChild(q)}}else{m.innerHTML='<div class="detail-list-item first-item"><span class="faded">'+this.msg("label.noItems")+"</span>"}c.addClass(this.id+"-content-wait","hidden");c.removeClass(m,"hidden")}})})();