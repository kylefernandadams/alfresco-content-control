(function(){var e=YAHOO.util.Dom,d=YAHOO.util.Event,c=YAHOO.util.Selector;var b=Alfresco.util.encodeHTML;Alfresco.CustomisePages=function(h){return Alfresco.CustomisePages.superclass.constructor.call(this,"Alfresco.CustomisePages",h,["button"])};YAHOO.extend(Alfresco.CustomisePages,Alfresco.component.Base,{options:{siteId:null},onReady:function g(){this.widgets.dnd=new Alfresco.util.DragAndDrop({draggables:[{container:this.id+"-availablePages-ul",groups:[Alfresco.util.DragAndDrop.GROUP_MOVE],cssClass:"customise-pages-page-list-item",vertical:false,movesOnEnterKey:true,callback:{fn:this.onAvailableDragAndDropAction,scope:this}},{container:this.id+"-currentPages-ul",groups:[Alfresco.util.DragAndDrop.GROUP_MOVE,Alfresco.util.DragAndDrop.GROUP_DELETE],cssClass:"customise-pages-page-list-item",vertical:false,callback:{fn:this.onCurrentDragAndDropAction,scope:this}}],targets:[{container:this.id+"-availablePages-ul",group:Alfresco.util.DragAndDrop.GROUP_MOVE},{container:this.id+"-currentPages-ul",group:Alfresco.util.DragAndDrop.GROUP_MOVE}]});this.widgets.saveButton=Alfresco.util.createYUIButton(this,"save-button",this.onSaveButtonClick);this.widgets.cancelButton=Alfresco.util.createYUIButton(this,"cancel-button",this.onCancelButtonClick)},onRenameClick:function(i,k){var h=e.get(this.id+"-page-"+i),m=c.query("input[name=sitePageTitle]",h,true),j=c.query("h3.title",h,true),l=c.query("div.type",h,true).innerHTML;Alfresco.util.PopupManager.getUserInput({title:this.msg("popup.rename.header",b(l)),text:this.msg("popup.rename.label"),input:"text",value:b(m.value),callback:{fn:this.onPageRenamed,obj:[m,j],scope:this}})},onPageRenamed:function(i,h){h[0].value=i;h[1].innerHTML=b(i)},onAvailableDragAndDropAction:function(j,h,i){this.resetPage(h)},onCurrentDragAndDropAction:function(j,h,i){if(j==Alfresco.util.DragAndDrop.ACTION_DELETE){this.removeCurrentPage(h);return false}},onRemoveClick:function(h,i){this.removeCurrentPage(e.get(this.id+"-page-"+h))},removeCurrentPage:function(h){this.resetPage(h);e.get(this.id+"-availablePages-ul").appendChild(h)},resetPage:function(h){var i=c.query("div.type",h,true).innerHTML;c.query("input[name=sitePageTitle]",h,true).value="";c.query("h3.title",h,true).innerHTML=i},onSaveButtonClick:function f(m){this.widgets.saveButton.set("disabled",true);this.widgets.cancelButton.set("disabled",true);var p=c.query(".current-pages ul li input",this.id),o,h=[],n;for(var l=0,j=p.length;l<j;l++){o=p[l];if(o.name=="pageId"){n={pageId:o.value};h.push(n)}else{if(o.name=="sitePageTitle"&&o.value.length>0){n.sitePageTitle=o.value}}}var k=e.get(this.id+"-theme-menu").value;Alfresco.util.Ajax.jsonRequest({method:Alfresco.util.Ajax.POST,url:Alfresco.constants.URL_SERVICECONTEXT+"components/site/customise-pages",dataObj:{siteId:this.options.siteId,pages:h,themeId:k},successCallback:{fn:function(){document.location.href=Alfresco.constants.URL_PAGECONTEXT+"site/"+this.options.siteId+"/dashboard"},scope:this},failureMessage:Alfresco.util.message("message.saveFailure",this.name),failureCallback:{fn:function(){this.widgets.feedbackMessage.destroy();this.widgets.saveButton.set("disabled",false);this.widgets.cancelButton.set("disabled",false)},scope:this}});this.widgets.feedbackMessage=Alfresco.util.PopupManager.displayMessage({text:Alfresco.util.message("message.saving",this.name),spanClass:"wait",displayTime:0})},onCancelButtonClick:function a(h){document.location.href=Alfresco.constants.URL_PAGECONTEXT+"site/"+this.options.siteId+"/dashboard"}})})();