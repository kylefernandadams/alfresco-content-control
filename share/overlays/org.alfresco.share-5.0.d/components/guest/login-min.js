(function(){var c=YAHOO.util.Dom,a=YAHOO.util.Event;Alfresco.component.Login=function b(f){Alfresco.component.Login.superclass.constructor.call(this,"Alfresco.component.Login",f,["button"]);return this};YAHOO.extend(Alfresco.component.Login,Alfresco.component.Base,{options:{error:false,errorDisplay:"container",lastUsername:null},onReady:function d(){var k=c.get(this.id+"-form");a.addListener(k,"submit",function l(){this.widgets.submitButton.set("disabled",true);return true},this,true);var j=function(n,m){if(k.getAttribute("alflogin")==null){k.setAttribute("alflogin",true)}};var h=new YAHOO.util.KeyListener(k,{keys:YAHOO.util.KeyListener.KEY.ENTER},j,"keydown");h.enable();this.widgets.submitButton=Alfresco.util.createYUIButton(this,"submit",null,{type:"submit"});var i=c.get(this.id+"-language");if(i){a.addListener(i,"change",this.setLangCookie,this,true)}var g=Alfresco.util.createYUIOverlay(c.get(this.id),{effect:{effect:YAHOO.widget.ContainerEffect.FADE,duration:0.25}},{render:false});c.removeClass(this.id+"-body","hidden");g.render(document.body);g.center();g.showEvent.subscribe(function(){if(this.options.errorDisplay=="prompt"){this.displayError()}c.get(this.options.lastUsername?this.id+"-password":this.id+"-username").focus()},this,true);g.show();if(!YAHOO.env.ua.ios&&!YAHOO.env.ua.android){a.addListener(window,"resize",function f(){g.center()},this,true)}c.get(this.id+"-success").value+=location.href.indexOf("#")>-1?location.href.substr(location.href.indexOf("#")):""},setLangCookie:function e(h){var g=a.getTarget(h);var f=g.options[g.selectedIndex].value;var i=c.get(this.id+"-username").value;expirationdate=new Date();expirationdate.setFullYear(expirationdate.getFullYear()+10);document.cookie="alfLocale="+f+";expires="+expirationdate.toUTCString()+";path=/";expirationdate=new Date();expirationdate.setDate(expirationdate.getDate()+7);document.cookie="alfUsername3="+encodeURIComponent(i)+";expires="+expirationdate.toUTCString()+";path="+Alfresco.constants.URL_CONTEXT;location.reload(true)},displayError:function(){if(this.options.error){var g=c.get(this.id+"-username");Alfresco.util.PopupManager.displayPrompt({title:this.msg("message.loginfailure"),text:this.msg("message.loginautherror"),buttons:[{text:this.msg("button.ok"),handler:function h(){this.destroy();g.focus();g.select()},isDefault:true}]})}else{document.cookie="_alfTest=_alfTest";var f=(document.cookie.indexOf("_alfTest")!=-1);if(f==false){Alfresco.util.PopupManager.displayPrompt({title:this.msg("message.cookiesfailure"),text:this.msg("message.cookieserror"),buttons:[{text:this.msg("button.ok"),handler:function h(){this.destroy()},isDefault:false}]})}}}})})();