(function(){var f=YAHOO.util.Dom,j=YAHOO.util.Event;var b=Alfresco.util.encodeHTML,d=Alfresco.util.combinePaths,e=Alfresco.util.siteURL;Alfresco.action.WorkflowActions={};Alfresco.action.WorkflowActions.prototype={endWorkflow:function k(n,l,t,s){var o=this,q=s.title,r=s.text;Alfresco.util.PopupManager.displayPrompt({title:this.msg(q),text:this.msg(r,l),noEscape:true,buttons:[{text:Alfresco.util.message("button.yes",this.name),handler:function p(){this.destroy();o._endWorkflow.call(o,n,t,s)}},{text:Alfresco.util.message("button.no",this.name),handler:function m(){this.destroy()},isDefault:true}]})},deleteWorkflow:function g(n,l){var m={};m.title="workflow.delete.title";m.text="workflow.delete.label";m.feedback="workflow.delete.feedback";m.success="workflow.delete.success";m.failure="workflow.delete.failure";this.endWorkflow(n,l,true,m)},cancelWorkflow:function a(n,l){var m={};m.title="workflow.cancel.title";m.text="workflow.cancel.label";m.feedback="workflow.cancel.feedback";m.success="workflow.cancel.success";m.failure="workflow.cancel.failure";this.endWorkflow(n,l,false,m)},_endWorkflow:function c(p,m,n){var l=this;var o=Alfresco.util.PopupManager.displayMessage({text:this.msg(n.feedback),spanClass:"wait",displayTime:0});Alfresco.util.Ajax.jsonDelete({url:Alfresco.constants.PROXY_URI+"api/workflow-instances/"+p+"?forced="+m,successCallback:{fn:function(q,r){o.destroy();if(q.json&&q.json.success){Alfresco.util.PopupManager.displayMessage({text:this.msg(n.success,this.name)});YAHOO.Bubbling.fire("workflowCancelled",{workflow:{id:r}})}else{Alfresco.util.PopupManager.displayMessage({text:Alfresco.util.message(n.failure,this.name)})}},obj:p,scope:this},failureCallback:{fn:function(q){o.destroy();Alfresco.util.PopupManager.displayMessage({text:Alfresco.util.message(n.failure,this.name)})},scope:this}})},createFilterURLParameters:function i(m,q){if(YAHOO.lang.isString(m.filterData)){var p,l=null;for(var o=0,n=q.length;o<n;o++){p=q[o];if((m.filterId==p.id||p.id=="*")&&(m.filterData==p.data||p.data=="*")){return this.substituteParameters(p.parameters,{id:m.filterId,data:m.filterData})}}}return null},substituteParameters:function(t,o){var q=t.match(/{[^}]+}/g);if(q){var l={},m,s,n;for(var p=0,r=q.length;p<r;p++){m=q[p].substring(1,q[p].length-1);s=m;n=new Date();if(/^[\-\+]?\d+(d|dt)$/.test(s)){if(/^[\-\+]?\d+(d)$/.test(s)){n.setHours(11);n.setMinutes(59);n.setSeconds(59);n.setMilliseconds(999)}n.setDate(n.getDate()+parseInt(s));s=n}else{s=o[m]}l[m]=Alfresco.util.isDate(s)?Alfresco.util.toISO8601(s):s}return YAHOO.lang.substitute(t,l)}return t},createAction:function h(r,m,n,q,p){var s=document.createElement("div");f.addClass(s,n);s.onmouseover=function(){f.addClass(this,n+"-over")};s.onmouseout=function(){f.removeClass(this,n+"-over")};var l=document.createElement("a");if(YAHOO.lang.isFunction(q)){j.addListener(l,"click",q,p,this);l.setAttribute("href","#")}else{l.setAttribute("href",q)}var o=document.createElement("span");f.addClass(o,"theme-color-1");o.appendChild(document.createTextNode(m));l.appendChild(o);s.appendChild(l);r.appendChild(s)}}})();