(function(){var g=YAHOO.util.Dom,i=YAHOO.util.Event;var d=Alfresco.util.encodeHTML,f=Alfresco.util.siteURL;Alfresco.component.WorkflowList=function(j){Alfresco.component.WorkflowList.superclass.constructor.call(this,"Alfresco.component.WorkflowList",j,["button","menu","container","datasource","datatable","paginator","json","history"]);YAHOO.Bubbling.on("filterChanged",this.onFilterChanged,this);YAHOO.Bubbling.on("workflowCancelled",this.onWorkflowCancelled,this);return this};YAHOO.extend(Alfresco.component.WorkflowList,Alfresco.component.Base);YAHOO.lang.augmentProto(Alfresco.component.WorkflowList,Alfresco.action.WorkflowActions);YAHOO.lang.augmentObject(Alfresco.component.WorkflowList.prototype,{options:{hiddenWorkflowNames:[],filterParameters:[],workflowDefinitions:[],maxItems:50},onReady:function c(){var j=Alfresco.constants.PROXY_URI+"api/workflow-instances?initiator="+encodeURIComponent(Alfresco.constants.USERNAME)+"&exclude="+this.options.hiddenWorkflowNames.join(",");this.widgets.alfrescoDataTable=new Alfresco.util.DataTable({dataTable:{container:this.id+"-workflows",columnDefinitions:[{key:"id",sortable:false,formatter:this.bind(this.renderCellIcons),width:40},{key:"title",sortable:false,formatter:this.bind(this.renderCellWorkflowInfo)},{key:"name",sortable:false,formatter:this.bind(this.renderCellActions),width:200}],config:{MSG_EMPTY:this.msg("message.noWorkflows")}},dataSource:{url:j,defaultFilter:{filterId:"workflows.active"},filterResolver:this.bind(function(k){return this.createFilterURLParameters(k,this.options.filterParameters)})},paginator:{config:{containers:[this.id+"-paginator"],rowsPerPage:this.options.maxItems}}})},onFilterChanged:function e(n,l){var o=Alfresco.util.cleanBubblingObject(l[1]);if(o.filterId=="workflowType"){var j;for(var m=0,k=this.options.workflowDefinitions.length;m<k;m++){if(this.options.workflowDefinitions[m].name==o.filterData){g.get(this.id+"-filterTitle").innerHTML=d(this.msg("filter."+o.filterId,this.options.workflowDefinitions[m].title))}}}else{g.get(this.id+"-filterTitle").innerHTML=d(this.msg("filter."+o.filterId+(o.filterData?"."+o.filterData:""),o.filterData))}},onWorkflowCancelled:function e(k,j){this.widgets.alfrescoDataTable.loadDataTable()},renderCellIcons:function a(n,l,o,q){var k=l.getData("priority"),m={"1":"high","2":"medium","3":"low"},j=m[k+""],p='<img src="'+Alfresco.constants.URL_RESCONTEXT+"components/images/priority-"+j+'-16.png" title="'+this.msg("label.priority",this.msg("priority."+j))+'"/>';n.innerHTML=p},renderCellWorkflowInfo:function b(n,r,l,j){var m=r.getData();var s=m.message,o=m.dueDate?Alfresco.util.fromISO8601(m.dueDate):null,p=m.startDate?Alfresco.util.fromISO8601(m.startDate):null;if(s===null){s=this.msg("workflow.no_message")}var k='<h3><a href="'+f("workflow-details?workflowId="+m.id+"&referrer=workflows&myWorkflowsLinkBack=true")+'" class="theme-color-1" title="'+this.msg("link.viewWorkflow")+'">'+d(s)+"</a></h3>";k+='<div class="due"><label>'+this.msg("label.due")+":</label><span>"+(o?Alfresco.util.formatDate(o,"longDate"):this.msg("label.none"))+"</span></div>";k+='<div class=started"><label>'+this.msg("label.started")+":</label><span>"+(p?Alfresco.util.formatDate(p,"longDate"):this.msg("label.none"))+"</span></div>";if(!m.isActive){var q=m.endDate?Alfresco.util.fromISO8601(m.endDate):null;k+='<div class=ended"><label>'+this.msg("label.ended")+":</label><span>"+(q?Alfresco.util.formatDate(q,"longDate"):this.msg("label.none"))+"</span></div>"}k+='<div class="type"><label>'+this.msg("label.type")+":</label><span>"+d(m.title)+"</span></div>";k+='<div class="description"><label>'+this.msg("label.description")+":</label><span>"+d(m.description)+"</span></div>";n.innerHTML=k},renderCellActions:function h(k,j,l,m){this.createAction(k,this.msg("link.viewWorkflow"),"workflow-view-link",f("workflow-details?workflowId="+j.getData("id")+"&referrer=workflows&myWorkflowsLinkBack=true"));if(j.getData("isActive")){this.createAction(k,this.msg("link.cancelWorkflow"),"workflow-cancel-link",function(o,n){this.cancelWorkflow(n.getData("id"),n.getData("message"));i.preventDefault(o)},j)}else{this.createAction(k,this.msg("link.deleteWorkflow"),"workflow-delete-link",function(o,n){this.deleteWorkflow(n.getData("id"),n.getData("message"));i.preventDefault(o)},j)}}},true)})();