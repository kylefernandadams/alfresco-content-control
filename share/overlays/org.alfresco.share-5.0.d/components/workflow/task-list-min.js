(function(){var e=YAHOO.util.Dom,g=YAHOO.util.Event;var c=Alfresco.util.encodeHTML,d=Alfresco.util.siteURL;Alfresco.component.TaskList=function(j){Alfresco.component.TaskList.superclass.constructor.call(this,"Alfresco.component.TaskList",j,["button","menu","container","datasource","datatable","paginator","json","history"]);YAHOO.Bubbling.on("filterChanged",this.onFilterChanged,this);return this};YAHOO.extend(Alfresco.component.TaskList,Alfresco.component.Base);YAHOO.lang.augmentProto(Alfresco.component.TaskList,Alfresco.action.WorkflowActions);YAHOO.lang.augmentObject(Alfresco.component.TaskList.prototype,{options:{hiddenTaskTypes:[],filterParameters:[],maxItems:50},onReady:function b(){var j=Alfresco.constants.PROXY_URI+"api/task-instances?authority="+encodeURIComponent(Alfresco.constants.USERNAME)+"&properties="+["bpm_priority","bpm_status","bpm_dueDate","bpm_description"].join(",")+"&exclude="+this.options.hiddenTaskTypes.join(",");this.widgets.pagingDataTable=new Alfresco.util.DataTable({dataTable:{container:this.id+"-tasks",columnDefinitions:[{key:"id",sortable:false,formatter:this.bind(this.renderCellIcons),width:40},{key:"title",sortable:false,formatter:this.bind(this.renderCellTaskInfo)},{key:"name",sortable:false,formatter:this.bind(this.renderCellActions),width:200}],config:{MSG_EMPTY:this.msg("message.noTasks")}},dataSource:{url:j,defaultFilter:{filterId:"workflows.active"},filterResolver:this.bind(function(k){return this.createFilterURLParameters(k,this.options.filterParameters)})},paginator:{config:{containers:[this.id+"-paginator"],rowsPerPage:this.options.maxItems}}})},onFilterChanged:function i(k,j){var l=Alfresco.util.cleanBubblingObject(j[1]);e.get(this.id+"-filterTitle").innerHTML=c(this.msg("filter."+l.filterId+(l.filterData?"."+l.filterData:""),l.filterData))},renderCellIcons:function a(q,r,n,j){var p=r.getData("properties")["bpm_priority"],o={"1":"high","2":"medium","3":"low"},k=o[p+""],l=r.getData("isPooled");var m='<img src="'+Alfresco.constants.URL_RESCONTEXT+"components/images/priority-"+k+'-16.png" title="'+this.msg("label.priority",this.msg("priority."+k))+'"/>';if(l){m+='<br/><img src="'+Alfresco.constants.URL_RESCONTEXT+'components/images/pooled-task-16.png" title="'+this.msg("label.pooledTask")+'"/>'}q.innerHTML=m},renderCellTaskInfo:function f(n,z,o,t){var j=z.getData("id"),p=c(z.getData("properties")["bpm_description"]),r=z.getData("properties")["bpm_dueDate"],A=r?Alfresco.util.fromISO8601(r):null,q=z.getData("workflowInstance"),u=q.startDate?Alfresco.util.fromISO8601(q.startDate):null,k=c(z.getData("title")),s=c(z.getData("properties")["bpm_status"]),y=z.getData("owner"),v=c(z.getData("description")),l;if(q.initiator){l=c(q.initiator.firstName)}var B=z.getData();if(B.propertyLabels&&Alfresco.util.isValueSet(B.propertyLabels.bpm_status,false)){s=B.propertyLabels.bpm_status}if(p==k){p=this.msg("workflow.no_message")}var w;if(z.getData("isEditable")){w=d("task-edit?taskId="+j+"&referrer=tasks&myTasksLinkBack=true")+'" class="theme-color-1" title="'+this.msg("link.editTask")}else{w=d("task-details?taskId="+j+"&referrer=tasks&myTasksLinkBack=true")+'" class="theme-color-1" title="'+this.msg("link.viewTask")}var x='<h3><a href="'+w+'">'+p+"</a></h3>";x+='<div class="due"><label>'+this.msg("label.due")+":</label><span>"+(A?Alfresco.util.formatDate(A,"longDate"):this.msg("label.none"))+"</span></div>";x+='<div class="started"><label>'+this.msg("label.started")+":</label><span>"+(u?Alfresco.util.formatDate(u,"longDate"):this.msg("label.none"))+"</span></div>";if(!q.isActive){var m=q.endDate?Alfresco.util.fromISO8601(q.endDate):null;x+='<div class=ended"><label>'+this.msg("label.ended")+":</label><span>"+(m?Alfresco.util.formatDate(m,"longDate"):this.msg("label.none"))+"</span></div>"}x+='<div class="status"><label>'+this.msg("label.status")+":</label><span>"+s+"</span></div>";x+='<div class="type"><label>'+this.msg("label.type",k)+":</label><span>"+k+"</span></div>";x+='<div class="description"><label>'+this.msg("label.description")+":</label><span>"+v+"</span></div>";if(l){x+='<div class="initiator"><label>'+this.msg("label.initiator")+":</label><span>"+l+"</span></div>"}if(!y||!y.userName){x+='<div class="unassigned"><span class="theme-bg-color-5 theme-color-5 unassigned-task">'+this.msg("label.unassignedTask")+"</span></div>"}n.innerHTML=x},renderCellActions:function h(k,j,l,m){if(j.getData("isEditable")){this.createAction(k,this.msg("link.editTask"),"task-edit-link",d("task-edit?taskId="+j.getData("id")+"&referrer=tasks&myTasksLinkBack=true"))}this.createAction(k,this.msg("link.viewTask"),"task-view-link",d("task-details?taskId="+j.getData("id")+"&referrer=tasks&myTasksLinkBack=true"));this.createAction(k,this.msg("link.viewWorkflow"),"workflow-view-link",d("workflow-details?workflowId="+j.getData("workflowInstance").id+"&taskId="+j.getData("id")+"&referrer=tasks&myTasksLinkBack=true"))}},true)})();