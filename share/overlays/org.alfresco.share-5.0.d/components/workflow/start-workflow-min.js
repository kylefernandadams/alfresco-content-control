(function(){var c=YAHOO.util.Dom,h=YAHOO.util.Event;Alfresco.component.StartWorkflow=function b(j){Alfresco.component.StartWorkflow.superclass.constructor.call(this,j,["button"]);this.name="Alfresco.component.StartWorkflow";Alfresco.util.ComponentManager.reregister(this);this.options=YAHOO.lang.merge(this.options,Alfresco.component.StartWorkflow.superclass.options);this.selectedItems="";this.destination="";this.workflowTypes=[];YAHOO.Bubbling.on("objectFinderReady",this.onObjectFinderReady,this);YAHOO.Bubbling.on("formContentReady",this.onStartWorkflowFormContentReady,this);return this};YAHOO.extend(Alfresco.component.StartWorkflow,Alfresco.component.ShareFormManager,{options:{selectedItems:"",destination:"",workflowDefinitions:[]},onReady:function d(){this.widgets.workflowDefinitionMenuButton=Alfresco.util.createYUIButton(this,"workflow-definition-button",this.onWorkflowSelectChange,{label:this.msg("label.selectWorkflowDefinition")+" "+Alfresco.constants.MENU_ARROW_SYMBOL,title:this.msg("title.selectWorkflowDefinition")+" "+Alfresco.constants.MENU_ARROW_SYMBOL,type:"menu",menu:"workflow-definition-menu"});return Alfresco.component.StartWorkflow.superclass.onReady.call(this)},onObjectFinderReady:function e(k,j){var l=j[1].eventGroup;if(l.options.field=="assoc_packageItems"&&l.eventGroup.indexOf(this.id)==0){l.selectItems(this.options.selectedItems)}},onWorkflowSelectChange:function i(l,k){var m=k[1].index;if(m>=0){var j=this.options.workflowDefinitions[m];this.widgets.workflowDefinitionMenuButton.set("label",j.title+" "+Alfresco.constants.MENU_ARROW_SYMBOL);this.widgets.workflowDefinitionMenuButton.set("title",j.description);Alfresco.util.Ajax.request({url:Alfresco.constants.URL_SERVICECONTEXT+"components/form",dataObj:{htmlid:this.id+"-startWorkflowForm-"+Alfresco.util.generateDomId(),itemKind:"workflow",itemId:j.name,mode:"create",submitType:"json",showCaption:true,formUI:true,showCancelButton:true,destination:this.options.destination},successCallback:{fn:this.onWorkflowFormLoaded,scope:this},failureMessage:this.msg("message.failure"),scope:this,execScripts:true})}},onWorkflowFormLoaded:function a(j){var k=c.get(this.id+"-workflowFormContainer");c.addClass(k,"hidden");k.innerHTML=j.serverResponse.responseText},onStartWorkflowFormContentReady:function g(l,j){var k=c.get(this.id+"-workflowFormContainer");c.removeClass(k,"hidden")},onFormSubmitFailure:function f(j){var k=(j.json&&j.json.message?j.json.message:this.msg(this.options.failureMessageKey));k=k.replace("org.alfresco.service.cmr.workflow.WorkflowException:","");Alfresco.util.PopupManager.displayPrompt({title:this.msg(this.options.failureMessageKey),text:(k)})}})})();