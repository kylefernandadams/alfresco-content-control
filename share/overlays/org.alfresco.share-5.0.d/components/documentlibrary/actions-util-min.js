(function(){var b=YAHOO.util.Event;var f=Alfresco.util.combinePaths,d=Alfresco.util.relativeTime;YAHOO.lang.augmentObject(Alfresco.util,{getSyncStatus:function h(m,k,j,i,o){Alfresco.util.Ajax.request({url:f(Alfresco.constants.URL_SERVICECONTEXT,"cloud/cloud-sync-status")+"?htmlid="+m.id+"&nodeRef="+k.nodeRef,dataObj:{nodeDetails:j},successCallback:{fn:function n(p){var L=new Alfresco.util.Node(p.config.dataObj.nodeDetails.item.node),v=L.properties,N=v.sync_syncTime,F=v.sync_syncOwner,H=(v.sync_syncRequested==="true"),T=i.showTitle?"<h2>"+m.msg("sync.status.title")+"</h2>":"",I=m.msg("sync.status.pending",null,null,G),u=m.msg("label.you"),B=L.hasAspect("sync:failed"),t=L.hasAspect("sync:transientError"),J=L.hasAspect("cm:workingcopy"),Q="sync.status.",G="";if(J){Q+="copy.";G="<a href='document-details?nodeRef="+k.workingCopy.sourceNodeRef+"'>"+m.msg("sync.original-document")+"</a>"}if(F!==Alfresco.constants.USERNAME){var s=p.serverResponse.responseText.match(/data-sync-owner-fullname="(.*?)"/),w=(s&&s[1])?s[1]:F;u=Alfresco.util.userProfileLink(F,w)}if(B&&!H){var S=d(v.sync_errorTime.iso8601);I=m.msg(Q+"failed",S,u,G)}if(N&&!H){var A=d(N.iso8601);if(B){I+="<br />"+m.msg(Q+"last-attempt",A,u,G)}else{I=m.msg(Q+"synced",A,u,G)}}var M="hidden",P="hidden",x="",q="",E="",D="";if(B){M="visible";x=m.msg(v["sync:errorCode"]);q=v["sync:errorDetails"]}if(t){P="visible";E=m.msg(v["sync:transientErrorCode"]);D=v["sync:transientErrorDetails"]||m.msg("sync.status.transient-error.default-details")}var z=k.actions;var O=false,R="hidden";if(i.showRequestSyncButton&&Alfresco.util.findInArray(z,"document-request-sync","id")){O=true;R="visible"}var r=false,K="hidden";if(i.showUnsyncButton&&Alfresco.util.findInArray(z,"document-cloud-unsync","id")){r=true;K="visible"}var y="";var C=YAHOO.lang.substitute(p.serverResponse.responseText,{title:T,status:I,syncFailed:M,errorCode:x,errorDetails:q,transientError:P,transientErrorCode:E,transientErrorDetails:D,requestSyncButtonClass:R,unsyncButtonClass:K,showMoreInfoLink:y});o({html:C,showRequestSyncButton:O,showUnsyncButton:r})},scope:m},failureCallback:{fn:function l(p){Alfresco.util.PopupManager.displayMessage({text:m.msg("sync.unable.diplay.status")});o(null)},scope:m}})},syncClickOnShowDetailsLinkEvent:function e(k,i){b.on(Dom.getElementsByClassName("cloud-sync-details-failed-show-link","a",i),"click",function j(l){b.preventDefault(l);if(!Dom.hasClass(Dom.getElementsByClassName("cloud-sync-error-detailed-transient"),"hidden")[0]){Dom.addClass(Dom.getElementsByClassName("cloud-sync-error-detailed-transient"),"hidden");Dom.removeClass(Dom.getElementsByClassName("cloud-sync-details-failed-show-link-transient"),"hidden");Dom.addClass(Dom.getElementsByClassName("cloud-sync-details-failed-hide-link-transient"),"hidden")}Dom.removeClass(Dom.getElementsByClassName("cloud-sync-error-detailed"),"hidden");Dom.addClass(Dom.getElementsByClassName("cloud-sync-details-info"),"hidden");Dom.addClass(Dom.getElementsByClassName("cloud-sync-details-failed-show-link"),"hidden");Dom.removeClass(Dom.getElementsByClassName("cloud-sync-details-failed-hide-link"),"hidden")},{},k)},syncClickOnTransientErrorShowDetailsLinkEvent:function g(k,i){b.on(Dom.getElementsByClassName("cloud-sync-details-failed-show-link-transient","a",i),"click",function j(l){b.preventDefault(l);if(!Dom.hasClass(Dom.getElementsByClassName("cloud-sync-error-detailed"),"hidden")[0]){Dom.addClass(Dom.getElementsByClassName("cloud-sync-error-detailed"),"hidden");Dom.removeClass(Dom.getElementsByClassName("cloud-sync-details-failed-show-link"),"hidden");Dom.addClass(Dom.getElementsByClassName("cloud-sync-details-failed-hide-link"),"hidden")}Dom.removeClass(Dom.getElementsByClassName("cloud-sync-error-detailed-transient"),"hidden");Dom.addClass(Dom.getElementsByClassName("cloud-sync-details-info"),"hidden");Dom.addClass(Dom.getElementsByClassName("cloud-sync-details-failed-show-link-transient"),"hidden");Dom.removeClass(Dom.getElementsByClassName("cloud-sync-details-failed-hide-link-transient"),"hidden")},{},k)},syncClickOnHideLinkEvent:function a(k,i){b.on(Dom.getElementsByClassName("cloud-sync-details-failed-hide-link","a",i),"click",function j(l){b.preventDefault(l);Dom.addClass(Dom.getElementsByClassName("cloud-sync-error-detailed"),"hidden");Dom.removeClass(Dom.getElementsByClassName("cloud-sync-details-info"),"hidden");Dom.removeClass(Dom.getElementsByClassName("cloud-sync-details-failed-show-link"),"hidden");Dom.addClass(Dom.getElementsByClassName("cloud-sync-details-failed-hide-link"),"hidden")},{},k)},syncClickOnTransientErrorHideLinkEvent:function c(k,i){b.on(Dom.getElementsByClassName("cloud-sync-details-failed-hide-link-transient","a",i),"click",function j(l){b.preventDefault(l);Dom.addClass(Dom.getElementsByClassName("cloud-sync-error-detailed-transient"),"hidden");Dom.removeClass(Dom.getElementsByClassName("cloud-sync-details-info"),"hidden");Dom.removeClass(Dom.getElementsByClassName("cloud-sync-details-failed-show-link-transient"),"hidden");Dom.addClass(Dom.getElementsByClassName("cloud-sync-details-failed-hide-link-transient"),"hidden")},{},k)}},true)})();