(function(){var K=YAHOO.util.Dom,I=YAHOO.util.Event,w=YAHOO.util.Anim;var E=Alfresco.util.encodeHTML;var x="ygddfdiv",H="377px",r=[-42,25],T=120,b=4,m=52,v=112,N=50,U=315,g=50,F=200,n=372,M,h,G="image/";Alfresco.DocumentListFilmstripViewRenderer=function(V,W){Alfresco.DocumentListFilmstripViewRenderer.superclass.constructor.call(this,V,W);this.parentElementIdSuffix="-filmstrip";this.windowResizeCheckTime=g;this.windowResizeMinTime=F;return this};YAHOO.extend(Alfresco.DocumentListFilmstripViewRenderer,Alfresco.DocumentListGalleryViewRenderer);Alfresco.DocumentListFilmstripViewRenderer.prototype.getFilmstripNavItemId=function u(V){if(this.documentList!=null&&V!=null){return this.documentList.id+"-filmstrip-nav-item-"+V.getId()}};Alfresco.DocumentListFilmstripViewRenderer.prototype.getFilmstripNavItem=function o(Y,Z){if(this.documentList!=null&&Y!=null){var aa=this.getFilmstripNavItemId(Y);var W=K.get(aa);if(W===null&&Z!=null){var X=K.getAncestorByTagName(Z,"tr");var V=this.documentList.id+"-filmstrip-nav-item-"+X.id;W=document.getElementById(V);if(W!==null){W.setAttribute("id",aa)}}return W}};Alfresco.DocumentListFilmstripViewRenderer.prototype.getFilmstripNavItemThumbnailElement=function O(V){if(V!=null){return K.getFirstChild(V)}};Alfresco.DocumentListFilmstripViewRenderer.prototype.getFilmstripNavItemLabelElement=function C(W){if(W!=null){var V=this.getFilmstripNavItemThumbnailElement(W);return K.getChildren(V)[0]}};Alfresco.DocumentListFilmstripViewRenderer.prototype.getFilmstripCarouselContainerId=function J(V){if(V!=null){return V.id+"-filmstrip-carousel"}};Alfresco.DocumentListFilmstripViewRenderer.prototype.getFilmstripNavElement=function e(V){if(V!=null){return K.get(V.id+"-filmstrip-nav")}};Alfresco.DocumentListFilmstripViewRenderer.prototype.getFilmstripNavCarouselContainerId=function L(V){if(V!=null){return V.id+"-filmstrip-nav-carousel"}};Alfresco.DocumentListFilmstripViewRenderer.prototype.getRowItemLabelElement=function R(W){if(W!=null){var V=this.getRowItemHeaderElement(W);return K.getChildren(V)[2]}};Alfresco.DocumentListFilmstripViewRenderer.prototype.getRowItemActionsElement=function z(V){if(V){var W=this.getRowItemDetailElement(V);return K.getChildren(K.getFirstChild(W))[1]}};Alfresco.DocumentListFilmstripViewRenderer.prototype.getRowItemStatusElement=function B(V){if(V!=null){var W=this.getRowItemDetailElement(V);return K.getChildren(K.getFirstChild(W))[0]}};Alfresco.DocumentListFilmstripViewRenderer.prototype.getRowItemInfoButtonElement=function c(W){if(W!=null){var V=this.getRowItemHeaderElement(W);return K.getChildren(V)[1]}};Alfresco.DocumentListFilmstripViewRenderer.prototype.onClickFilmstripContentNavItem=function y(W,V){if(W!=null&&V!=null){W.widgets.filmstripCarousel.scrollTo(V,false)}};Alfresco.DocumentListFilmstripViewRenderer.prototype.onFilmstripMainContentChanged=function D(X,V){if(X!=null){this.destroyWebPreview(X,V);this.renderWebPreview(X,V);var Y=X.widgets.filmstripNavCarousel.getPageForItem(V)-1;var W=X.widgets.filmstripNavCarousel.get("currentPage");if(Y!=W){var Z=X.widgets.filmstripNavCarousel.getFirstVisibleOnPage(Y+1);X.widgets.filmstripNavCarousel.scrollTo(Z,true)}}};Alfresco.DocumentListFilmstripViewRenderer.prototype.onToggleHeaderAndNav=function P(ad){if(ad!=null){var X=this;var W=K.get(ad.id+this.parentElementIdSuffix);var aa=ad.widgets.filmstripCarousel.get("currentPage");var V=K.getFirstChild(ad.widgets.filmstripCarousel.getElementForItem(aa));var Z=this.getRowItemHeaderElement(V);var Y=this.getFilmstripNavElement(ad);var ac,ab;if(!K.hasClass(W,"alf-filmstrip-content-only")){ab=new w(Y,{bottom:{to:-v}},0.2);ac=new w(Z,{top:{to:-N}},0.2);ac.onComplete.subscribe(function(){K.addClass(W,"alf-filmstrip-content-only")})}else{K.setStyle(Z,"top","-"+N+"px");K.removeClass(W,"alf-filmstrip-content-only");ab=new w(Y,{bottom:{to:0}},0.2);ac=new w(Z,{top:{to:0}},0.2);ac.onComplete.subscribe(function(){var ag,af,ae,ah=ad.widgets.filmstripCarousel.getElementForItems();for(ag=0,af=ah.length;ag<af;ag++){ae=X.getRowItemHeaderElement(K.getFirstChild(ah[ag]));K.setStyle(ae,"top","0px")}})}ac.animate();ab.animate()}};Alfresco.DocumentListFilmstripViewRenderer.prototype.setupRenderer=function a(Z){K.addClass(Z.id+this.buttonElementIdSuffix,this.buttonCssClass);this.documentList=Z;var X=K.get(Z.id+this.parentElementIdSuffix);var Y=this;I.delegate(X,"mouseover",function aa(ad,ac,ab){Y.onEventHighlightRow(Z,ad,ac)},"div."+this.rowClassName,this);I.delegate(X,"click",function W(ad,ac,ab){Y.onShowGalleryItemDetail(Z,Y,ad,ac,ab)},".alf-show-detail",this);I.addListener(K.get(Z.id+"-filmstrip-nav-handle"),"click",function(ab){Y.onToggleHeaderAndNav(Z)});I.delegate(X,"click",function V(ad,ac,ab){var ae=I.getTarget(ad);Z.selectedFiles[ae.value]=ae.checked;YAHOO.Bubbling.fire("selectedFilesChanged")},".alf-select input",this);YAHOO.Bubbling.on("selectedFilesChanged",function(ac,ab){this.onSelectedFilesChanged(Z)},this);YAHOO.Bubbling.on("webPreviewSetupComplete",function(af,ae){var ac=K.getElementsByClassName("alf-gallery-item","div");if(ac!=null&&ac.length>0){var ag=K.getElementsByClassName("WebPreviewer","div");if(ag!=null&&ag.length>0){var ab=parseInt(ac[0].style.height)-46;ag[0].style.height=ab+"px"}}var ad=p();t(ad)},this)};function t(V){var W=K.getElementsByClassName("previewer Image");if(W.length==0){W=K.getElementsByClassName("previewer WebPreviewer Image");if(W.length>0){W[0].getElementsByTagName("img")[0].style.marginTop=V+"px"}}else{W[0].style.marginTop=V+"px"}}function l(){var W=p();var V=K.getElementsByClassName("real","div");if(V.length!==0){n=M+W}t(W)}function p(){var X=K.getElementsByClassName("alf-header");var V;for(var W=0;W<X.length;W++){if(X[W].id.indexOf("-item-header-yui-")>0){V=X[W];break}}return V.offsetHeight}Alfresco.DocumentListFilmstripViewRenderer.prototype.destroyView=function Q(Y,W,X,aa){this.restoreDataTable(Y);var Z=K.get(this.getFilmstripCarouselContainerId(Y));if(Z!=null){K.get(this.getFilmstripCarouselContainerId(Y)).innerHTML="";K.get(this.getFilmstripNavCarouselContainerId(Y)).innerHTML=""}this.destroyWebPreview(Y);K.addClass(K.get(Y.id+this.parentElementIdSuffix),"hidden");K.addClass(K.get(Y.id+this.parentElementEmptytIdSuffix),"hidden");var V=K.get(x);K.removeClass(V,"alf-filmstrip-dragging");if(this.windowResizeCallback){I.removeListener(window,"resize",this.windowResizeCallback)}};Alfresco.DocumentListFilmstripViewRenderer.prototype.renderView=function d(aA,aO,aI,au){this.overrideDataTable(aA);var ag=this;aA.widgets.dataTable.onDataReturnInitializeTable.call(aA.widgets.dataTable,aO,aI,au);var ax=K.get(aA.id+this.parentElementIdSuffix);var an=aA.widgets.dataTable.getRecordSet();var ab=K.get(aA.id+this.parentElementEmptytIdSuffix);if(an.getLength()==0){K.removeClass(ab,"hidden");K.setStyle(ab,"height","auto");return}K.addClass(ab,"hidden");K.setStyle(ax,"opacity",0);var ad=K.get(aA.id+"-filmstrip-main-content");var ar=this.getFilmstripCarouselContainerId(aA);var am=K.get(ar);am.innerHTML="";var aM=document.createElement("ol");am.appendChild(aM);var X=K.get(aA.id+"-filmstrip-nav");var ah=this.getFilmstripNavCarouselContainerId(aA);var ay=K.get(ah);ay.innerHTML="";var al=document.createElement("ol");ay.appendChild(al);K.addClass(ax,"alf-gallery");K.addClass(ax,"alf-filmstrip");K.removeClass(ax,"hidden");var ac=parseInt(K.getComputedStyle(ax,"width"));var aK=Math.floor((2/3)*ac);var af=K.getViewportHeight()-U;if(K.hasClass(K.get(aA.id),"alf-fullscreen")){af=K.getViewportHeight()}if((af>=0)&&(aK>af)){aK=af}var ak=K.get(aA.id+"-filmstrip-item-template"),V=K.get(aA.id+"-filmstrip-nav-item-template"),Z=null,at=null,ap=null,aE=null;var ao,aD,aH,aG;for(aH=0,aG=an.getLength();aH<aG;aH++){ao=an.getRecord(aH);aD=ao.getData();ap=document.createElement("li");aM.appendChild(ap);aE=document.createElement("li");al.appendChild(aE);var az=this.getRowItemId(ao);Z=ak.cloneNode(true);K.removeClass(Z,"hidden");Z.setAttribute("id",az);Z.style.width=ac+"px";Z.style.height=aK+"px";ap.appendChild(Z);var aw=this.getFilmstripNavItemId(ao);at=V.cloneNode(true);K.removeClass(at,"hidden");at.setAttribute("id",aw);at.style.width=T+"px";I.addListener(at,"click",function(aP){return function(aQ){YAHOO.Bubbling.fire("filmstripNavItemClicked",{index:aP})}}(aH),this,true);aE.appendChild(at);var aJ=this.getRowItemThumbnailElement(Z);var av=this.getRowItemHeaderElement(Z);var aF=this.getRowItemDetailElement(Z);var ae=this.getRowItemActionsElement(Z);av.setAttribute("id",aA.id+"-item-header-"+ao.getId());ae.setAttribute("id",aA.id+"-actions-"+az);if(aH==0||(aD.node.mimetype!=null&&aD.node.mimetype.substring(0,G.length)==G)){this.destroyWebPreview(aA,aH);this.renderWebPreview(aA,aH)}var aN=this.getFilmstripNavItemThumbnailElement(at);this.renderCellThumbnail(aA,aN,ao,Z,null,"","doclib");var aa=aD.jsNode.nodeRef.nodeRef;var aj=new Alfresco.DnD(aa,aA);var aC=this.getRowItemInfoButtonElement(Z);aF.panel=new YAHOO.widget.Panel(aF,{visible:false,draggable:false,close:false,constraintoviewport:true,underlay:"none",width:H,context:[Z,"tr","tr",null,r]})}aA.widgets.filmstripCarousel=new YAHOO.widget.Carousel(this.getFilmstripCarouselContainerId(aA),{animation:{speed:0.2},numVisible:1,navigation:{prev:aA.id+"-filmstrip-nav-main-previous",next:aA.id+"-filmstrip-nav-main-next"}});aA.widgets.filmstripCarousel.render();aA.widgets.filmstripCarousel.show();aA.widgets.filmstripCarousel.focus();var W=Math.floor((ac-(m*2))/(T+b));aA.widgets.filmstripNavCarousel=new YAHOO.widget.Carousel(this.getFilmstripNavCarouselContainerId(aA),{animation:{speed:0.5},numVisible:W,navigation:{prev:aA.id+"-filmstrip-nav-previous",next:aA.id+"-filmstrip-nav-next"}});aA.widgets.filmstripNavCarousel.render();aA.widgets.filmstripNavCarousel.show();YAHOO.Bubbling.on("filmstripNavItemClicked",function(aQ,aP){this.onClickFilmstripContentNavItem(aA,aP[1].index)},this);aA.widgets.filmstripCarousel.on("pageChange",function(aP){ag.onFilmstripMainContentChanged(aA,aP)});var aB=K.get(x);K.addClass(aB,"alf-filmstrip-dragging");this.currentResizeCallback=function(aP){ag.resizeView(aA,aO,aI,au)};this.setupWindowResizeListener();l();var Y=K.getElementsByClassName("yui-carousel-element");Y[0].style.minHeight=n+"px";var aL=K.getElementsByClassName("alf-gallery-item");for(var aH=0;aH<aL.length;aH++){if(aL[aH].className.indexOf("hidden")<0){aL[aH].style.minHeight=n+"px"}}var aq=K.get(aA.id+"-filmstrip");aq.style.overflow="hidden";var ai=new YAHOO.util.Anim(ax,{opacity:{from:0,to:1}},0.4,YAHOO.util.Easing.easeOut);ai.animate()};Alfresco.DocumentListFilmstripViewRenderer.prototype.renderWebPreview=function s(ae,aa){var ad;var ac=ae.widgets.dataTable.getRecordSet();if(ac.getLength()>0){var af=ac.getRecord(aa);var Z=af.getData();var X=this.getRowItemId(af);var W=document.getElementById(X);var Y=this.getRowItemThumbnailElement(W);M=Y.offsetHeight;var V=this.getThumbnail(ae,Y,af,null,null,"-filmstrip-main-content");if(V.isContainer){if(!document.getElementById(V.id)){Y.innerHTML+='<span class="folder">'+(V.isLink?'<span class="link"></span>':"")+Alfresco.DocumentList.generateFileFolderLinkMarkup(ae,Z)+V.html+"</a>"}}else{var ab=K.getElementsByClassName("web-preview","div",Y);if(ab==null||ab.length==0){Alfresco.util.loadWebscript({url:Alfresco.constants.URL_SERVICECONTEXT+"/components/preview/web-preview",properties:{nodeRef:Z.nodeRef},target:Y})}}}};Alfresco.DocumentListFilmstripViewRenderer.prototype.destroyWebPreview=function A(X,W){var Y=K.getElementsByClassName("real","div");if(Y!=null){for(i=0,j=Y.length;i<j;i++){if(K.hasClass(Y[i],"web-preview")){Y[i].parentNode.removeChild(Y[i])}}}var V=K.getElementsByClassName("WebPreviewer","div");if(V!=null){for(i=0,j=V.length;i<j;i++){if(K.hasClass(V[i],"previewer")){V[i].parentNode.parentNode.parentNode.removeChild(V[i].parentNode.parentNode)}}}};Alfresco.DocumentListFilmstripViewRenderer.prototype.resizeView=function S(Z,W,Y,aa){var V=K.get(Z.id+this.parentElementIdSuffix);if(!K.hasClass(V,"alf-true-fullscreen")){var X=Z.widgets.filmstripCarousel.get("currentPage");this.renderView(Z,W,Y,aa);setTimeout(function(){Z.widgets.filmstripCarousel.scrollTo(X,false)},50)}};Alfresco.DocumentListFilmstripViewRenderer.prototype.onSelectedFilesChanged=function q(af){var ad=af.widgets.dataTable.getRecordSet(),ag,ac,W,ae,X,ab,aa;var Z=false;for(ab=0,aa=ad.getLength();ab<aa;ab++){ag=ad.getRecord(ab);W=ag.getData("jsNode");ae=W.nodeRef;X=this.getFilmstripNavItem(ag);var Y=af.selectedFiles[ae];if(Y){K.addClass(X,"alf-selected");Z=true}else{K.removeClass(X,"alf-selected")}}var V=K.get(af.id+this.parentElementIdSuffix);if(Z){if(!K.hasClass(V,"alf-selected")){K.addClass(V,"alf-selected")}}else{K.removeClass(V,"alf-selected")}};Alfresco.DocumentListFilmstripViewRenderer.prototype.renderCellThumbnail=function f(af,ae,ag,aa,W,X,Z){var ac;var V=this.getThumbnail(af,ae,ag,aa,W,X,Z);var Y=ag.getData();if(!document.getElementById(V.id)){if(V.isContainer){ae.innerHTML+='<span class="folder">'+(V.isLink?'<span class="link"></span>':"")+(af.dragAndDropEnabled?'<span class="droppable"></span>':"")+V.html;ac=new YAHOO.util.DDTarget(V.id)}else{ae.innerHTML+=(V.isLink?'<span class="link"></span>':"")+V.html}var ab=document.getElementById(V.id);if(ab){var ad=new Image();ad.onload=function(){if(ad.width>ad.height){K.addClass(ab,"alf-landscape")}};ad.src=ab.src}}};Alfresco.DocumentListFilmstripViewRenderer.prototype.renderCellDescription=function k(X,aa,Z,ab,ac){Alfresco.DocumentListGalleryViewRenderer.superclass.renderCellDescription.call(this,X,aa,Z,ab,ac);var Y=this.getRowItem(Z,aa);if(Y!==null){var V=this.getRowItemDetailDescriptionElement(Y).innerHTML=aa.innerHTML;aa.innerHTML="";this.getRowItemLabelElement(Y).innerHTML=E(Z.getData().displayName)}var W=this.getFilmstripNavItem(Z,aa);if(W!==null){this.getFilmstripNavItemLabelElement(W).innerHTML=E(Z.getData().displayName)}}})();