(function(){var D=YAHOO.util.Dom,B=YAHOO.util.Event,g=YAHOO.util.Element;var A=Alfresco.util.encodeHTML,v=Alfresco.util.combinePaths,u=Alfresco.util.siteURL;var a="org.alfresco.share.documentList",F=a+".hideNavBar";Alfresco.DocListToolbar=function(O,P){Alfresco.DocListToolbar.superclass.constructor.call(this,"Alfresco.DocListToolbar",O,["button","menu","container"]);this.selectedFiles=[];this.currentFilter={};this.dynamicControls=[];this.doclistMetadata={};this.actionsView="browse";YAHOO.Bubbling.on("filterChanged",this.onFilterChanged,this);YAHOO.Bubbling.on("deactivateAllControls",this.onDeactivateAllControls,this);YAHOO.Bubbling.on("deactivateDynamicControls",this.onDeactivateDynamicControls,this);YAHOO.Bubbling.on("selectedFilesChanged",this.onSelectedFilesChanged,this);YAHOO.Bubbling.on("userAccess",this.onUserAccess,this);YAHOO.Bubbling.on("doclistMetadata",this.onDoclistMetadata,this);YAHOO.Bubbling.on("showFileUploadDialog",this.onFileUpload,this);YAHOO.Bubbling.on("dropTargetOwnerRequest",this.onDropTargetOwnerRequest,this);YAHOO.Bubbling.on("documentDragOver",this.onDocumentDragOver,this);YAHOO.Bubbling.on("documentDragOut",this.onDocumentDragOut,this);YAHOO.Bubbling.on("registerAction",this.onRegisterAction,this);return this};YAHOO.extend(Alfresco.DocListToolbar,Alfresco.component.Base);YAHOO.lang.augmentProto(Alfresco.DocListToolbar,Alfresco.doclib.Actions);YAHOO.lang.augmentObject(Alfresco.DocListToolbar.prototype,{options:{siteId:null,containerId:"documentLibrary",groupActivitiesAt:5,hideNavBar:false,repositoryBrowsing:true,useTitle:true},currentPath:"",currentFilter:null,fileUpload:null,selectedFiles:null,folderDetailsUrl:null,dynamicControls:null,doclistMetadata:null,onReady:function C(){if(D.get(this.id+"-tb-body")!=null){if(D.get(this.id+"-createContent-button")){this.widgets.createContent=Alfresco.util.createYUIButton(this,"createContent-button",this.onCreateContent,{type:"menu",menu:"createContent-menu",lazyloadmenu:false,disabled:true,value:"CreateChildren"});var R=this.widgets.createContent.getMenu(),P=0;R.cfg.config.clicktohide.value=true;if(this.options.createContentActions.length!==0){var af=[],Q,ab,S,ae,X,Y;for(var ac=0;ac<this.options.createContentActions.length;ac++){ab=this.options.createContentActions[ac];ae={parent:R};S=null;if(ab.type=="javascript"){ae.onclick={fn:function(ah,ag,ak){var aj=Alfresco.util.deepCopy(this.doclistMetadata.parent);var ai={nodeRef:aj.nodeRef,node:aj,jsNode:new Alfresco.util.Node(aj)};this[ak.params["function"]].call(this,ai)},obj:ab,scope:this};S="#"}else{if(ab.type=="pagelink"){S=u(ab.params.page)}else{if(ab.type=="link"){S=ab.params.href}}}X='<a href="'+S+'" rel="'+ab.permission+'"><span style="background-image:url('+Alfresco.constants.URL_RESCONTEXT+"components/images/filetypes/"+ab.icon+'-file-16.png)" class="'+ab.icon+'-file">'+this.msg(ab.label)+"</span></a>";Y=document.createElement("li");Y.innerHTML=X;Q=new YAHOO.widget.MenuItem(Y,ae);af.push(Q)}R.addItems(af,P);P++}if(this.options.createContentByTemplateEnabled){var Y=document.createElement("li");Y.innerHTML='<a href="#"><span>'+this.msg("menu.create-content.by-template-node")+"</span></a>";YAHOO.util.Event.addListener(Selector.query("a",Y,true),"click",function(ag){B.preventDefault(ag);B.stopEvent(ag)});var aa=document.createElement("div");aa.innerHTML='<div class="bd"><ul></ul></div>';var V=document.createElement("li");V.innerHTML='<a href="#"><span>'+this.msg("menu.create-content.by-template-folder")+"</span></a>";YAHOO.util.Event.addListener(Selector.query("a",V,true),"click",function(ag){B.preventDefault(ag);B.stopEvent(ag)});var O=document.createElement("div");O.innerHTML='<div class="bd"><ul></ul></div>';var U=new YAHOO.widget.MenuItem(Y,{parent:R,submenu:aa});var ad=new YAHOO.widget.MenuItem(V,{parent:R,submenu:O});R.addItems([U,ad],P);P++;var T=this.widgets.createContent.getMenu().getSubmenus(),Z=T.length>0?T[0]:null;if(Z){Z.subscribe("beforeShow",this.onCreateByTemplateNodeBeforeShow,this,true);Z.subscribe("click",this.onCreateByTemplateNodeClick,this,true)}var W=T.length>1?T[1]:null;if(W){W.subscribe("beforeShow",this.onCreateByTemplateFolderBeforeShow,this,true);W.subscribe("click",this.onCreateByTemplateFolderClick,this,true)}}R.render();this.dynamicControls.push(this.widgets.createContent)}this.widgets.newFolder=Alfresco.util.createYUIButton(this,"newFolder-button",this.onNewFolder,{disabled:true,value:"CreateChildren"});this.dynamicControls.push(this.widgets.newFolder);this.widgets.fileUpload=Alfresco.util.createYUIButton(this,"fileUpload-button",this.onFileUpload,{disabled:true,value:"CreateChildren"});this.dynamicControls.push(this.widgets.fileUpload);this.widgets.syncToCloud=Alfresco.util.createYUIButton(this,"syncToCloud-button",this.onSyncToCloud,{disabled:true,value:"CreateChildren"});this.dynamicControls.push(this.widgets.syncToCloud);this.widgets.unsyncFromCloud=Alfresco.util.createYUIButton(this,"unsyncFromCloud-button",this.onUnsyncFromCloud,{disabled:true,value:"CreateChildren"});this.dynamicControls.push(this.widgets.unsyncFromCloud);this.widgets.selectedItems=Alfresco.util.createYUIButton(this,"selectedItems-button",this.onSelectedItems,{type:"menu",menu:"selectedItems-menu",lazyloadmenu:false,disabled:true});this.dynamicControls.push(this.widgets.selectedItems);if(D.get(this.id+"hideNavBar-button")){this.widgets.hideNavBar=Alfresco.util.createYUIButton(this,"hideNavBar-button",this.onHideNavBar,{type:"checkbox",checked:!this.options.hideNavBar});if(this.widgets.hideNavBar!==null){this.widgets.hideNavBar.set("title",this.msg(this.options.hideNavBar?"button.navbar.show":"button.navbar.hide"));this.dynamicControls.push(this.widgets.hideNavBar)}}D.setStyle(this.id+"-navBar","display",this.options.hideNavBar?"none":"block");this.widgets.rssFeed=Alfresco.util.createYUIButton(this,"rssFeed-button",null,{type:"link"});this.dynamicControls.push(this.widgets.rssFeed);this.widgets.folderUp=Alfresco.util.createYUIButton(this,"folderUp-button",this.onFolderUp,{disabled:true,title:this.msg("button.up")});this.dynamicControls.push(this.widgets.folderUp);D.setStyle(this.id+"-tb-body","visibility","visible")}this.modules.actions=new Alfresco.module.DoclibActions();this.modules.docList=Alfresco.util.ComponentManager.findFirst("Alfresco.DocumentList");this.services.preferences=new Alfresco.service.Preferences()},onCreateContent:function y(S,R,Q){var P=R[1],O=P.element.getElementsByTagName("a")[0];if(P.parent===this.widgets.createContent.getMenu()&&O&&O.nodeName=="A"){O.href=YAHOO.lang.substitute(O.href,{nodeRef:this.doclistMetadata.parent.nodeRef})}},onCreateByTemplateNodeBeforeShow:function E(){var O=this.widgets.createContent.getMenu().getSubmenus()[0];if(O.getItems().length==0){O.clearContent();O.addItem(this.msg("label.loading"));O.render();Alfresco.util.Ajax.jsonGet({url:Alfresco.constants.PROXY_URI+"slingshot/doclib/node-templates",successCallback:{fn:function(R,V){var Q=R.json.data,U=[],S;for(var T=0,P=Q.length;T<P;T++){node=Q[T];S=A(node.name);if(node.title&&node.title!==node.name&&this.options.useTitle){S+='<span class="title">('+A(node.title)+")</span>"}U.push({text:'<span title="'+A(node.description)+'">'+S+"</span>",value:node})}if(U.length==0){U.push(this.msg("label.empty"))}O.clearContent();O.addItems(U);O.render()},scope:this}})}},onCreateByTemplateNodeClick:function I(T,S,R){var P=S[1].value,O=this.doclistMetadata.parent.nodeRef,Q=this.options.siteId;if(P){Alfresco.util.Ajax.jsonPost({url:Alfresco.constants.PROXY_URI+"slingshot/doclib/node-templates",dataObj:{sourceNodeRef:P.nodeRef,parentNodeRef:O},successCallback:{fn:function(U){Alfresco.Share.postActivity(Q,"org.alfresco.documentlibrary.file-created","{cm:name}","document-details?nodeRef="+U.json.nodeRef,{appTool:"documentlibrary",nodeRef:U.json.nodeRef});YAHOO.Bubbling.fire("nodeCreated",{name:P.name,parentNodeRef:O,highlightFile:U.json.name})}},successMessage:this.msg("message.create-content-by-template-node.success",P.name),failureMessage:this.msg("message.create-content-by-template-node.failure",P.name)})}},onCreateByTemplateFolderBeforeShow:function e(){var O=this.widgets.createContent.getMenu().getSubmenus()[1];if(O.getItems().length==0){O.clearContent();O.addItem(this.msg("label.loading"));O.render();Alfresco.util.Ajax.jsonGet({url:Alfresco.constants.PROXY_URI+"slingshot/doclib/folder-templates",successCallback:{fn:function(R,V){var Q=R.json.data,U=[],S;for(var T=0,P=Q.length;T<P;T++){node=Q[T];S=A(node.name);if(node.title&&node.title!==node.name&&this.options.useTitle){S+='<span class="title">('+A(node.title)+")</span>"}U.push({text:'<span title="'+A(node.description)+'">'+S+"</span>",value:node})}if(U.length==0){U.push(this.msg("label.empty"))}O.clearContent();O.addItems(U);O.render()},scope:this}})}},onCreateByTemplateFolderClick:function J(U,T,S){var R=this.onNewFolder(null,S);R.options.doBeforeDialogShow={fn:function Q(V,W){D.get(W.id+"-dialogTitle").innerHTML=this.title;D.get(W.id+"-dialogHeader").innerHTML=this.header;D.get(W.id+"_prop_cm_name").value=this.node.name;D.get(W.id+"_prop_cm_title").value=this.node.title;D.get(W.id+"_prop_cm_description").value=this.node.description},scope:{node:T[1].value,title:this.msg("label.new-folder-from-template.title"),header:this.msg("label.new-folder-from-template.header")}};R.options.successCallback={fn:function(V){YAHOO.Bubbling.fire("nodeCreated",{name:node.name,parentNodeRef:destination,highlightFile:V.json.name})}};R.options.successMessage=this.msg("message.create-content-by-template-node.success",node.name);R.options.failureMessage=this.msg("message.create-content-by-template-node.failure",node.name);R.options.doBeforeFormSubmit={fn:function O(V,W){V.attributes.action.nodeValue=Alfresco.constants.PROXY_URI+"slingshot/doclib/folder-templates"},scope:this};R.options.doBeforeAjaxRequest={fn:function P(V,W){V.dataObj.sourceNodeRef=this.node.nodeRef;V.dataObj.parentNodeRef=this.destination;return true},scope:{node:T[1].value,destination:this.doclistMetadata.parent.nodeRef}}},onNewFolder:function w(S,V){var U=this.doclistMetadata.parent.nodeRef;var W=function Q(X,Y){D.get(Y.id+"-dialogTitle").innerHTML=this.msg("label.new-folder.title");D.get(Y.id+"-dialogHeader").innerHTML=this.msg("label.new-folder.header")};var O=YAHOO.lang.substitute(Alfresco.constants.URL_SERVICECONTEXT+"components/form?itemKind={itemKind}&itemId={itemId}&destination={destination}&mode={mode}&submitType={submitType}&formId={formId}&showCancelButton=true",{itemKind:"type",itemId:"cm:folder",destination:U,mode:"create",submitType:"json",formId:"doclib-common"});var R=new Alfresco.module.SimpleDialog(this.id+"-createFolder");R.setOptions({width:"33em",templateUrl:O,actionUrl:null,destroyOnHide:true,doBeforeDialogShow:{fn:W,scope:this},onSuccess:{fn:function T(Y){var Z;var aa=Y.config.dataObj.prop_cm_name;var X=Y.json.persistedObject;Z={fileName:aa,nodeRef:X,path:this.currentPath+(this.currentPath!=="/"?"/":"")+aa};this.modules.actions.postActivity(this.options.siteId,"folder-added","documentlibrary",Z);YAHOO.Bubbling.fire("folderCreated",{name:aa,parentNodeRef:U});Alfresco.util.PopupManager.displayMessage({text:this.msg("message.new-folder.success",aa)})},scope:this},onFailure:{fn:function P(X){if(X){var Y=X.config.dataObj.prop_cm_name;Alfresco.util.PopupManager.displayMessage({text:this.msg("message.new-folder.failure",Y)})}else{Alfresco.util.PopupManager.displayMessage({text:this.msg("message.failure")})}R.widgets.cancelButton.set("disabled",false)},scope:this}});R.show();return R},onSyncToCloud:function p(R,S){var O=new Object();var P=this.doclistMetadata.parent;O.displayName=P.properties["cm:name"];O.nodeRef=P.nodeRef;var Q=new Object();Q.isContainer=P.isContainer;O.jsNode=Q;this.onActionCloudSync(O)},onUnsyncFromCloud:function t(S,T){var O=new Object();var Q=this.doclistMetadata.parent;var R=new Object();R.isContainer=Q.isContainer;O.jsNode=R;var P=new Object();P.uri=Q.nodeRef.replace(":/","");R.nodeRef=P;O.displayName=Q.properties["cm:name"];this.onActionCloudUnsync(O)},onFileUpload:function q(Q,R){if(this.fileUpload===null){this.fileUpload=Alfresco.getFileUploadInstance()}var O={siteId:this.options.siteId,containerId:this.options.containerId,uploadDirectory:this.currentPath,filter:[],mode:this.fileUpload.MODE_MULTI_UPLOAD,thumbnails:"doclib",onFileUploadComplete:{fn:this.onFileUploadComplete,scope:this}};this.fileUpload.show(O);if(YAHOO.lang.isArray(R)&&R[1].tooltip){var P=Alfresco.util.createBalloon(this.fileUpload.uploader.id+"-dialog",{html:R[1].tooltip,width:"30em"});P.show();this.fileUpload.uploader.widgets.panel.hideEvent.subscribe(function(){P.hide()})}},onFileUploadWithTooltip:function L(O,P){this.onFileUpload(O,P)},onFileUploadComplete:function z(O){var S=O.successful.length,P,R;if(S>0){if(S<(this.options.groupActivitiesAt||5)){for(var Q=0;Q<S;Q++){R=O.successful[Q];P={fileName:R.fileName,nodeRef:R.nodeRef};this.modules.actions.postActivity(this.options.siteId,"file-added","document-details",P)}}else{P={fileCount:S,path:this.currentPath,parentNodeRef:this.doclistMetadata.parent.nodeRef};this.modules.actions.postActivity(this.options.siteId,"files-added","documentlibrary",P)}}},onSelectedItems:function r(T,S,R){var P=S[0],Q=S[1];if(this.modules.docList){var O=Alfresco.util.findEventClass(Q);if(O&&(typeof this[O]=="function")){this[O].call(this,this.modules.docList.getSelectedFiles())}}B.preventDefault(P)},onActionDelete:function s(O){var T=this,P=[];if(typeof O.length==="undefined"){O=[O]}for(var S=0,Q=O.length;S<Q;S++){P.push('<span class="'+(O[S].jsNode.isContainer?"folder":"document")+'">'+A(O[S].displayName)+"</span>")}var W=this.msg("title.multiple-delete.confirm"),R=this.msg("message.multiple-delete.confirm",O.length);R+='<div class="toolbar-file-list">'+P.join("")+"</div>";Alfresco.util.PopupManager.displayPrompt({title:W,text:R,noEscape:true,modal:true,buttons:[{text:this.msg("button.delete"),handler:function V(){this.destroy();T._onActionDeleteConfirm.call(T,O)}},{text:this.msg("button.cancel"),handler:function U(){this.destroy()},isDefault:true}]})},_onActionDeleteConfirm:function l(O){var T=[],P,S;for(P=0,S=O.length;P<S;P++){T.push(O[P].jsNode.nodeRef.nodeRef)}var R=function Q(aa,V){var U;var Z=0;var X=0;if(!aa.json.overallSuccess){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.multiple-delete.failure")});return}this.modules.docList.totalRecords-=aa.json.totalResults;YAHOO.Bubbling.fire("filesDeleted");for(P=0,S=aa.json.totalResults;P<S;P++){U=aa.json.results[P];if(U.success){if(U.type=="folder"){X++}else{Z++}YAHOO.Bubbling.fire(U.type=="folder"?"folderDeleted":"fileDeleted",{multiple:true,nodeRef:U.nodeRef})}}var Y=X+Z;if(Alfresco.util.isValueSet(this.options.siteId)){var W;if(Y>0){if(Y<this.options.groupActivitiesAt){for(P=0;P<Y;P++){W={fileName:aa.json.results[P].id,nodeRef:aa.json.results[P].nodeRef,path:this.currentPath,parentNodeRef:this.doclistMetadata.parent.nodeRef};if(aa.json.results[P].type=="folder"){this.modules.actions.postActivity(this.options.siteId,"folder-deleted","documentlibrary",W)}else{this.modules.actions.postActivity(this.options.siteId,"file-deleted","documentlibrary",W)}}}else{if(Z>0){W={fileCount:Z,path:this.currentPath,parentNodeRef:this.doclistMetadata.parent.nodeRef};this.modules.actions.postActivity(this.options.siteId,"files-deleted","documentlibrary",W)}if(X>0){W={fileCount:X,path:this.currentPath,parentNodeRef:this.doclistMetadata.parent.nodeRef};this.modules.actions.postActivity(this.options.siteId,"folders-deleted","documentlibrary",W)}}}}Alfresco.util.PopupManager.displayMessage({text:this.msg("message.multiple-delete.success",Y)})};this.modules.actions.genericAction({success:{callback:{fn:R,scope:this,obj:O}},failure:{message:this.msg("message.multiple-delete.failure")},webscript:{method:Alfresco.util.Ajax.DELETE,name:"files"},wait:{message:this.msg("message.multiple-delete.please-wait")},config:{requestContentType:Alfresco.util.Ajax.JSON,dataObj:{nodeRefs:T}}})},onActionDeselectAll:function M(){if(this.modules.docList){this.modules.docList.selectFiles("selectNone")}},onHideNavBar:function N(O,P){this.options.hideNavBar=!this.widgets.hideNavBar.get("checked");this.widgets.hideNavBar.set("title",this.msg(this.options.hideNavBar?"button.navbar.show":"button.navbar.hide"));D.setStyle(this.id+"-navBar","display",this.options.hideNavBar?"none":"block");this.services.preferences.set(F,this.options.hideNavBar);if(O){B.preventDefault(O)}},onFolderUp:function i(Q,R){var P=this.currentPath.substring(0,this.currentPath.lastIndexOf("/")),O=this.currentFilter;O.filterData=P;YAHOO.Bubbling.fire("changeFilter",O);B.preventDefault(Q)},onFilterChanged:function G(S,T){this._handleSyncButtons();var Q=T[1];if(Q&&(typeof Q.filterId!=="undefined")){Q.filterOwner=Q.filterOwner||Alfresco.util.FilterManager.getOwner(Q.filterId);if(Q.filterOwner){if(this.currentFilter.filterOwner!=Q.filterOwner||this.currentFilter.filterId!=Q.filterId){var X=Q.filterOwner.split(".")[1],W=X+"_"+Q.filterId;var U=YAHOO.util.Selector.query("div.hideable",D.get(this.id)),O;for(var R=0,P=U.length;R<P;R++){O=U[R];if(D.hasClass(O,X)||D.hasClass(O,W)){D.removeClass(O,"toolbar-hidden")}else{D.addClass(O,"toolbar-hidden")}}}}Alfresco.logger.debug("DLTB_onFilterChanged","Old Filter",this.currentFilter);this.currentFilter=Alfresco.util.cleanBubblingObject(Q);Alfresco.logger.debug("DLTB_onFilterChanged","New Filter",this.currentFilter);if(this.currentFilter.filterId=="path"||this.currentFilter.filterId=="category"){this.currentPath=v("/",this.currentFilter.filterData);this._generateBreadcrumb();var V=this.currentPath.split("/");if(this.currentPath==="/"){V=["/"]}if(this.widgets.folderUp){this.widgets.folderUp.set("disabled",V.length<2)}}else{this._generateDescription()}this._generateRSSFeedUrl()}},_handleSyncButtons:function h(){var O=D.get(this.id+"-syncToCloud-button");var S=D.get(this.id+"-unsyncFromCloud-button");var Q=this.doclistMetadata.parent;if(Q){var R=Q.aspects;if(R){if(Alfresco.util.arrayContains(R,"sync:syncSetMemberNode")){D.removeClass(S,"hidden");D.addClass(O,"hidden")}else{D.removeClass(O,"hidden");D.addClass(S,"hidden")}}var P=Q.properties;if(P&&(P["cm:name"]==="documentLibrary"||P["sync:directSync"]==="false")||this.options.syncMode!=="ON_PREMISE"){D.addClass(S,"hidden");D.addClass(O,"hidden")}}},onDeactivateAllControls:function m(Q,P){var O,R=Alfresco.util.disableYUIButton;for(O in this.widgets){if(this.widgets.hasOwnProperty(O)){R(this.widgets[O])}}},onDeactivateDynamicControls:function K(Q,P){var O,R=Alfresco.util.disableYUIButton;for(O in this.dynamicControls){if(this.dynamicControls.hasOwnProperty(O)){R(this.dynamicControls[O])}}},onUserAccess:function b(U,W){var P=function X(aj,Z){var ai,an,al,aa,am,ae,ah=false,Y,ac,ag;if(aj instanceof YAHOO.widget.MenuItem&&aj.element.firstChild){ah=true;ai=aj.element.firstChild.rel;Y=Alfresco.util.bind(aj.cfg.setProperty,aj.cfg,"className","");ac=Alfresco.util.bind(aj.cfg.setProperty,aj.cfg,"className","hidden")}else{ai=aj.get("value");Y=Alfresco.util.bind(aj.set,aj,"disabled",false);ac=Alfresco.util.bind(aj.set,aj,"disabled",true)}Y();if(typeof ai=="string"&&ai!==""){an=ai.split(",");for(var ad=0,ak=an.length;ad<ak;ad++){if(an[ad].indexOf("|")!==-1){ae=false;al=an[ad].split("|");for(var ab=0,af=al.length;ab<af;ab++){aa=al[ab].split(":");am=aa[0];ag=aa.length==2?aa[1]=="true":true;if((Z[am]&&ag)||(!Z[am]&&!ag)){ae=true;if(!ah){aj.set("activePermission",al[ab],true)}break}}if(!ae){ac();break}}else{aa=an[ad].split(":");am=aa[0];ag=aa.length==2?aa[1]=="true":true;if((Z[am]&&!ag)||(!Z[am]&&ag)){ac();break}}}}};var R=W[1];if(R&&R.userAccess){var S,V,O;for(V in this.widgets){if(this.widgets.hasOwnProperty(V)){S=this.widgets[V];if(S&&S.get("srcelement").className!="no-access-check"&&(!(S._button!=null&&S._button.className=="no-access-check"))){P(S,R.userAccess);if(S.getMenu()!==null){O=S.getMenu().getItems();for(var Q=0,T=O.length;Q<T;Q++){P(O[Q],R.userAccess)}}}}}}},onSelectedFilesChanged:function H(ak,R){if(this.modules.docList){var V=this.modules.docList.getSelectedFiles(),Q=[],ah,S,ai={},ag,W,al=this.widgets.selectedItems==null?null:this.widgets.selectedItems.getMenu().getItems(),U,P,Y,ab,T,X=[],aj=[],ad,Z,ac,af;var ae=function ae(am){return(am.node.isContainer?"folder":"document")};for(ad=0,Z=V.length;ad<Z;ad++){ah=V[ad];ag=ah.node.permissions.user;for(W in ag){if(ag.hasOwnProperty(W)){ai[W]=(ai[W]===undefined?ag[W]:ai[W]&&ag[W])}}S=ae(ah);if(!(S in Q)){Q[S]=true;Q.push(S)}if(ad===0){X=Alfresco.util.deepCopy(ah.node.aspects)}else{for(ac=0,af=X.length;ac<af;ac++){if(!Alfresco.util.arrayContains(ah.node.aspects,X[ac])){Alfresco.util.arrayRemove(X,X[ac])}}}for(ac=0,af=ah.node.aspects.length;ac<af;ac++){if(!Alfresco.util.arrayContains(aj,ah.node.aspects[ac])){aj.push(ah.node.aspects[ac])}}}for(W in al){if(al.hasOwnProperty(W)){U=al[W];T=false;if(U.element.firstChild){if(U.element.firstChild.rel&&U.element.firstChild.rel!==""){P=U.element.firstChild.rel.split(",");for(ad=0,Z=P.length;ad<Z;ad++){if(!ai[P[ad]]){T=true;break}}}var O=D.getAttribute(U.element.firstChild,"data-has-aspects");if(O&&O!==""){O=O.split(",");for(ad=0,Z=O.length;ad<Z;ad++){if(!Alfresco.util.arrayContains(X,O[ad])){T=true;break}}}var aa=D.getAttribute(U.element.firstChild,"data-not-aspects");if(aa&&aa!==""){aa=aa.split(",");for(ad=0,Z=aa.length;ad<Z;ad++){if(Alfresco.util.arrayContains(aj,aa[ad])){T=true;break}}}if(!T){if(U.element.firstChild.type&&U.element.firstChild.type!==""){Y=U.element.firstChild.type.split("|");for(ad=0;ad<Y.length;ad++){ab=Alfresco.util.arrayToObject(Y[ad].split(","));for(ac=0,af=Q.length;ac<af;ac++){if(!(Q[ac] in ab)){Y.splice(ad,1);--ad;break}}}T=(Y.length===0)}}U.cfg.setProperty("disabled",T)}}}if(this.widgets.selectedItems!=null){this.widgets.selectedItems.set("disabled",(V.length===0))}}},onDoclistMetadata:function x(P,O){var Q=O[1];this.folderDetailsUrl=null;if(Q&&Q.metadata){this.doclistMetadata=Alfresco.util.deepCopy(Q.metadata);if(Q.metadata.parent&&Q.metadata.parent.nodeRef){this.folderDetailsUrl=u("folder-details?nodeRef="+Q.metadata.parent.nodeRef)}}},onDropTargetOwnerRequest:function d(S,T){if(T&&T[1]&&T[1].elementId){var V=D.get(T[1].elementId);var O=D.get(this.id+"-breadcrumb");if(D.isAncestor(O,V)){var P="";var W=this.currentPath.split("/");for(var R=0,Q=O.children.length;R<Q;R++){if(R%2==0){P=P+"/"+W[R/2]}if(V==O.children[R]){break}}var U=this.doclistMetadata.container+P;T[1].callback.call(T[1].scope,U,P)}}},onDocumentDragOver:function c(R,Q){if(Q&&Q[1]&&Q[1].elementId){var P=D.get(Q[1].elementId);var O=D.get(this.id+"-breadcrumb");if(D.isAncestor(O,P)){D.addClass(P,"documentDragOverHighlight");var T=D.getFirstChild(P);if(T!=null&&T.tagName!="SPAN"){var S=document.createElement("span");D.addClass(S,"documentDragOverArrow");D.insertBefore(S,T)}}}},onDocumentDragOut:function n(R,Q){if(Q&&Q[1]&&Q[1].elementId){var P=D.get(Q[1].elementId);var O=D.get(this.id+"-breadcrumb");if(D.isAncestor(O,P)){D.removeClass(P,"documentDragOverHighlight");var S=D.getFirstChild(P);if(S!=null&&S.tagName=="SPAN"){P.removeChild(S)}}}},_generateBreadcrumb:function o(){var V=D.get(this.id+"-breadcrumb");if(V===null){return}V.innerHTML="";var ad=this.currentPath.split("/");if(this.currentPath==="/"){ad=["/"]}var W=this,Y=ad.concat();Y[0]=Alfresco.util.message("node.root",this.currentFilter.filterOwner);var X=function P(ag,af){D.addClass(ag.target.parentNode,"highlighted");B.stopEvent(ag)};var ae=function S(ah,ag){var af=W.currentFilter;af.filterData=ag;YAHOO.Bubbling.fire("changeFilter",af);B.stopEvent(ah)};var ab=new g(V),T,U,O,ac;for(var R=0,Q=ad.length;R<Q;++R){T=ad.slice(0,R+1).join("/");U=new g(document.createElement("div"));U.addClass("crumb");U.addClass("documentDroppable");U.addClass("documentDroppableHighlights");if(R>0){O=new g(document.createElement("a"),{href:"#",innerHTML:"&nbsp;"});O.on("click",ae,T);O.addClass("icon");O.addClass("filter-"+A(this.currentFilter.filterId));U.appendChild(O)}if(Q-R<2){ac=new g(document.createElement("span"),{innerHTML:(this.folderDetailsUrl)?'<a href="'+this.folderDetailsUrl+'">'+A(Y[R])+"</a>":A(Y[R])});ac.addClass("label");U.appendChild(ac);ab.appendChild(U)}else{ac=new g(document.createElement("a"),{href:"",innerHTML:A(Y[R])});ac.addClass("folder");ac.on("click",ae,T);U.appendChild(ac);ab.appendChild(U);ab.appendChild(new g(document.createElement("div"),{innerHTML:"&gt;",className:"separator"}))}}var aa=D.get(this.id+"-breadcrumb");var Z=D.getElementsByClassName("crumb","div",aa);for(var R=0,Q=Z.length;R<Q;R++){new YAHOO.util.DDTarget(Z[R])}},_generateDescription:function f(){var Q,T,P,O,R;Q=D.get(this.id+"-description");if(Q===null){return}while(Q.hasChildNodes()){Q.removeChild(Q.lastChild)}R=typeof this.currentFilter.filterDisplay!=="undefined"?this.currentFilter.filterDisplay:(this.currentFilter.filterData||"");P=new g(document.createElement("div"),{innerHTML:this.msg("description."+this.currentFilter.filterId,R)});P.addClass("message");var U="description."+this.currentFilter.filterId+".more",S=U+".filterDisplay";if(R!==""&&this.msg(S)!==S){U=S}O=new g(document.createElement("span"),{innerHTML:this.msg(U,A(R))});O.addClass("more");P.appendChild(O);T=new g(Q);T.appendChild(P)},_getRssFeedUrl:function k(){var O=YAHOO.lang.substitute("{type}/site/{site}/{container}"+(this.currentPath!=="/"?"{path}":""),{type:this.modules.docList.options.showFolders?"all":"documents",site:encodeURIComponent(this.options.siteId),container:encodeURIComponent(this.options.containerId),path:Alfresco.util.encodeURIPath(this.currentPath)});O+="?filter="+encodeURIComponent(this.currentFilter.filterId);if(this.currentFilter.filterData){O+="&filterData="+encodeURIComponent(this.currentFilter.filterData)}O+="&format=rss";return Alfresco.constants.URL_FEEDSERVICECONTEXT+"components/documentlibrary/feed/"+O},_generateRSSFeedUrl:function j(){if(this.widgets.rssFeed&&this.modules.docList){var O=this._getRssFeedUrl();this.widgets.rssFeed.set("href",O);Alfresco.util.enableYUIButton(this.widgets.rssFeed)}}},true)})();