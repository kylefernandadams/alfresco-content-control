(function(){var c=YAHOO.util.Dom;var a=Alfresco.util.encodeHTML,e=Alfresco.util.combinePaths,f=Alfresco.util.siteURL;Alfresco.FolderActions=function(h){Alfresco.FolderActions.superclass.constructor.call(this,"Alfresco.FolderActions",h,["button"]);this.actionsView="details";YAHOO.Bubbling.on("filesPermissionsUpdated",this.doRefresh,this);YAHOO.Bubbling.on("metadataRefresh",this.doRefresh,this);YAHOO.Bubbling.on("registerAction",this.onRegisterAction,this);return this};YAHOO.extend(Alfresco.FolderActions,Alfresco.component.Base);YAHOO.lang.augmentProto(Alfresco.FolderActions,Alfresco.doclib.Actions);YAHOO.lang.augmentObject(Alfresco.FolderActions.prototype,{options:{nodeRef:null,siteId:null,containerId:"documentLibrary",rootNode:"alfresco://company/home",replicationUrlMapping:{},folderDetails:null,repositoryBrowsing:true},recordData:null,doclistMetadata:null,currentPath:null,onReady:function g(){var q=this.id;this.recordData=this.options.folderDetails.item;this.doclistMetadata=this.options.folderDetails.metadata;this.currentPath=this.recordData.location.path;this.recordData.jsNode=new Alfresco.util.Node(this.recordData.node);var n=this.recordData,h=n.node,j=n.actions,k=c.get(this.id+"-actionSet"),o="",m;n.actionParams={};for(var l=0,s=j.length;l<s;l++){o+=this.renderAction(j[l],n)}k.innerHTML=YAHOO.lang.substitute(o,this.getActionUrls(n));c.addClass(k,"action-set");c.setStyle(k,"visibility","visible");var r=function p(u,t){var i=YAHOO.Bubbling.getOwnerByTagName(t[1].anchor,"div");if(i!==null){var v=Alfresco.util.ComponentManager.get(q),w=i.id;if(typeof v[w]=="function"){t[1].stop=true;v[w].call(v,v.recordData,i)}}return true};YAHOO.Bubbling.addDefaultAction("action-link",r);this.modules.actions=new Alfresco.module.DoclibActions()},_onActionDeleteConfirm:function d(k){var q=k.location.path;if(Alfresco.constants.PAGECONTEXT=="mine"||Alfresco.constants.PAGECONTEXT=="shared"){var r=q.substring(1);if(Alfresco.constants.PAGECONTEXT=="mine"){r=r.substring(r.indexOf("/")+1)}var i=r.indexOf("/");if(i!=-1){q=r.substring(i)}else{q=""}}var j=k.fileName,o=k.displayName,p=new Alfresco.util.NodeRef(k.nodeRef),m=new Alfresco.util.NodeRef(k.parent.nodeRef),n="",l=q.length>1?"?path="+encodeURIComponent(q):"";if(Alfresco.constants.PAGECONTEXT=="mine"){n="myfiles"}else{if(Alfresco.constants.PAGECONTEXT=="shared"){n="sharedfiles"}else{n=Alfresco.util.isValueSet(this.options.siteId)?"documentlibrary":"repository"}}this.modules.actions.genericAction({success:{activity:{siteId:this.options.siteId,activityType:"folder-deleted",page:"documentlibrary",activityData:{fileName:j,path:q,nodeRef:p.toString(),parentNodeRef:m.toString()}},callback:{fn:function h(s){window.location=f(n+l)}}},failure:{message:this.msg("message.delete.failure",o)},webscript:{method:Alfresco.util.Ajax.DELETE,name:"file/node/{nodeRef}",params:{nodeRef:p.uri}}})},doRefresh:function b(){YAHOO.Bubbling.unsubscribe("filesPermissionsUpdated",this.doRefresh,this);YAHOO.Bubbling.unsubscribe("metadataRefresh",this.doRefresh,this);this.refresh("components/folder-details/folder-actions?nodeRef={nodeRef}"+(this.options.siteId?"&site={siteId}":""))}},true)})();