(function(){var g=YAHOO.util.Dom,b=YAHOO.util.Event;Alfresco.component.DataListToolbar=function(i){Alfresco.component.DataListToolbar.superclass.constructor.call(this,"Alfresco.component.DataListToolbar",i,["button","container"]);YAHOO.Bubbling.on("selectedItemsChanged",this.onSelectedItemsChanged,this);YAHOO.Bubbling.on("userAccess",this.onUserAccess,this);return this};YAHOO.extend(Alfresco.component.DataListToolbar,Alfresco.component.Base);YAHOO.lang.augmentProto(Alfresco.component.DataListToolbar,Alfresco.service.DataListActions);YAHOO.lang.augmentObject(Alfresco.component.DataListToolbar.prototype,{options:{siteId:"",newItemDialogWidth:"33em"},onReady:function e(){this.widgets.newRowButton=Alfresco.util.createYUIButton(this,"newRowButton",this.onNewRow,{disabled:true,value:"create"});this.widgets.selectedItems=Alfresco.util.createYUIButton(this,"selectedItems-button",this.onSelectedItems,{type:"menu",menu:"selectedItems-menu",lazyloadmenu:false,disabled:true});this.widgets.printButton=Alfresco.util.createYUIButton(this,"printButton",{disabled:true});this.widgets.rssFeedButton=Alfresco.util.createYUIButton(this,"rssFeedButton",{disabled:true});this.modules.actions=new Alfresco.module.DataListActions();this.modules.dataGrid=Alfresco.util.ComponentManager.findFirst("Alfresco.component.DataGrid");g.setStyle(this.id+"-body","visibility","visible")},onNewRow:function d(n,q){var r=this.modules.dataGrid.datalistMeta,o=r.nodeRef,m=r.itemType;var s=function i(t,u){Alfresco.util.populateHTML([u.id+"-dialogTitle",this.msg("label.new-row.title")],[u.id+"-dialogHeader",this.msg("label.new-row.header")])};var j=YAHOO.lang.substitute(Alfresco.constants.URL_SERVICECONTEXT+"components/form?itemKind={itemKind}&itemId={itemId}&destination={destination}&mode={mode}&submitType={submitType}&showCancelButton=true",{itemKind:"type",itemId:m,destination:o,mode:"create",submitType:"json"});var l=new Alfresco.module.SimpleDialog(this.id+"-createRow");l.setOptions({width:this.options.newItemDialogWidth,templateUrl:j,actionUrl:null,destroyOnHide:true,doBeforeDialogShow:{fn:s,scope:this},onSuccess:{fn:function k(t){YAHOO.Bubbling.fire("dataItemCreated",{nodeRef:t.json.persistedObject});Alfresco.util.PopupManager.displayMessage({text:this.msg("message.new-row.success")})},scope:this},onFailure:{fn:function p(t){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.new-row.failure")})},scope:this}}).show()},onSelectedItems:function c(n,m,l){var j=m[0],k=m[1];if(this.modules.dataGrid){var i=Alfresco.util.findEventClass(k);if(i&&(typeof this[i]=="function")){this[i].call(this,this.modules.dataGrid.getSelectedItems())}}b.preventDefault(j)},onActionDeselectAll:function f(){this.modules.dataGrid.selectItems("selectNone")},onUserAccess:function h(q,s){var m=s[1];if(m&&m.userAccess){var n,v,r,u,o;for(r in this.widgets){if(this.widgets.hasOwnProperty(r)){n=this.widgets[r];if(n.get("srcelement").className!="no-access-check"&&(!(n._button!=null&&n._button.className=="no-access-check"))){n.set("disabled",false);if(typeof n.get("value")=="string"){v=n.get("value").split(",");for(var l=0,t=v.length;l<t;l++){if(v[l].indexOf("|")!==-1){o=false;u=v[l].split("|");for(var k=0,p=u.length;k<p;k++){if(m.userAccess[u[k]]){o=true;n.set("activePermission",u[k],true);break}}if(!o){n.set("disabled",true);break}}else{if(!m.userAccess[v[l]]){n.set("disabled",true);break}}}}}}}}},onSelectedItemsChanged:function a(o,q){if(this.modules.dataGrid){var r=this.modules.dataGrid.getSelectedItems(),u,v={},s,p,k=this.widgets.selectedItems.getMenu().getItems(),j,l,m,n,t;for(n=0,t=r.length;n<t;n++){u=r[n];s=u.permissions.userAccess;for(p in s){if(s.hasOwnProperty(p)){v[p]=(v[p]===undefined?s[p]:v[p]&&s[p])}}}for(p in k){if(k.hasOwnProperty(p)){j=k[p];m=false;if(j.element.firstChild){if(j.element.firstChild.rel&&j.element.firstChild.rel!==""){l=j.element.firstChild.rel.split(",");for(n=0,t=l.length;n<t;n++){if(!v[l[n]]){m=true;break}}}j.cfg.setProperty("disabled",m)}}}this.widgets.selectedItems.set("disabled",(r.length===0))}}},true)})();