(function(){var y=YAHOO.util.Dom,x=YAHOO.util.Event,s=YAHOO.util.Selector,k=YAHOO.Bubbling;var u=Alfresco.util.encodeHTML,f=Alfresco.util.activateLinks,t=Alfresco.util.combinePaths,i=Alfresco.util.userProfileLink;Alfresco.component.DataGrid=function(P){Alfresco.component.DataGrid.superclass.constructor.call(this,"Alfresco.component.DataGrid",P,["button","container","datasource","datatable","paginator","animation","history"]);this.datalistMeta={};this.datalistColumns={};this.dataRequestFields=[];this.dataResponseFields=[];this.currentPage=1;this.totalRecords=0;this.showingMoreActions=false;this.hideMoreActionsFn=null;this.currentFilter={filterId:"all",filterData:""};this.selectedItems={};this.afterDataGridUpdate=[];k.on("activeDataListChanged",this.onActiveDataListChanged,this);k.on("changeFilter",this.onChangeFilter,this);k.on("filterChanged",this.onFilterChanged,this);k.on("dataListDetailsUpdated",this.onDataListDetailsUpdated,this);k.on("dataItemCreated",this.onDataItemCreated,this);k.on("dataItemUpdated",this.onDataItemUpdated,this);k.on("dataItemsDeleted",this.onDataItemsDeleted,this);k.on("dataItemsDuplicated",this.onDataGridRefresh,this);this.deferredListPopulation=new Alfresco.util.Deferred(["onReady","onActiveDataListChanged"],{fn:this.populateDataGrid,scope:this});return this};YAHOO.extend(Alfresco.component.DataGrid,Alfresco.component.Base);YAHOO.lang.augmentProto(Alfresco.component.DataGrid,Alfresco.service.DataListActions);YAHOO.lang.augmentObject(Alfresco.component.DataGrid.prototype,{options:{siteId:"",containerId:"dataLists",usePagination:false,initialPage:1,pageSize:50,initialFilter:{},actionsPopupTimeout:500,loadingMessageDelay:1000,splitActionsAt:3,editDialogWidth:"34em",actionsColumnWidth:80},currentPage:null,totalRecords:null,currentFilter:null,selectedItems:null,currentActionsMenu:null,hideMoreActionsFn:null,showingMoreActions:null,deferredActionsMenu:null,afterDataGridUpdate:null,datalistMeta:null,datalistColumns:null,dataRequestFields:null,dataResponseFields:null,fnRenderCellSelected:function v(){var P=this;return function Q(S,R,T,U){y.setStyle(S,"width",T.width+"px");y.setStyle(S.parentNode,"width",T.width+"px");S.innerHTML='<input id="checkbox-'+R.getId()+'" type="checkbox" name="fileChecked" value="'+U+'"'+(P.selectedItems[U]?' checked="checked">':">")}},fnRenderCellActions:function L(){var Q=this;return function P(S,R,T,U){y.setStyle(S,"width",T.width+"px");y.setStyle(S.parentNode,"width",T.width+"px");S.innerHTML='<div id="'+Q.id+"-actions-"+R.getId()+'" class="hidden"></div>'}},getCellFormatter:function j(){var Q=this;return function P(X,Z,V,R){var U="";if(!Z){Z=this.getRecord(X)}if(!V){V=this.getColumn(X.parentNode.cellIndex)}if(Z&&V){if(!R){R=Z.getData("itemData")[V.field]}if(R){var W=Q.datalistColumns[V.key];if(W){R=YAHOO.lang.isArray(R)?R:[R];for(var T=0,Y=R.length,S;T<Y;T++){S=R[T];switch(W.dataType.toLowerCase()){case"cm:person":U+='<span class="person">'+i(S.metadata,S.displayValue)+"</span>";break;case"datetime":U+=Alfresco.util.formatDate(Alfresco.util.fromISO8601(S.value),Q.msg("date-format.default"));break;case"date":U+=Alfresco.util.formatDate(Alfresco.util.fromISO8601(S.value),Q.msg("date-format.defaultDateOnly"));break;case"text":U+=f(u(S.displayValue));break;default:if(W.type=="association"){U+='<a href="'+Alfresco.util.siteURL((S.metadata=="container"?"folder":"document")+"-details?nodeRef="+S.value)+'">';U+='<img src="'+Alfresco.constants.URL_RESCONTEXT+"components/images/filetypes/"+Alfresco.util.getFileIcon(S.displayValue,(S.metadata=="container"?"cm:folder":null),16)+'" width="16" alt="'+u(S.displayValue)+'" title="'+u(S.displayValue)+'" />';U+=" "+u(S.displayValue)+"</a>"}else{U+=f(u(S.displayValue))}break}if(T<Y-1){U+="<br />"}}}}}X.innerHTML=U}},getSortFunction:function F(){return function P(S,Q,X,W){var V=S.getData().itemData[W],U=Q.getData().itemData[W];if(YAHOO.lang.isArray(V)){V=V[0]}if(YAHOO.lang.isArray(U)){U=U[0]}if(!YAHOO.lang.isValue(V)){return(!YAHOO.lang.isValue(U))?0:1}else{if(!YAHOO.lang.isValue(U)){return -1}}var T=V.value,R=U.value;if(T.indexOf&&T.indexOf("workspace://SpacesStore")==0){T=V.displayValue;R=U.displayValue}return YAHOO.util.Sort.compare(T,R,X)}},onReady:function b(){var S=this;this.widgets.itemSelect=Alfresco.util.createYUIButton(this,"itemSelect-button",this.onItemSelect,{type:"menu",menu:"itemSelect-menu",disabled:true});var Q=function R(W,V){var U=k.getOwnerByTagName(V[1].anchor,"div");if(U!==null){if(typeof S[U.className]=="function"){V[1].stop=true;var X=S.widgets.dataTable.getRecord(V[1].target.offsetParent).getData();S[U.className].call(S,X,U)}}return true};k.addDefaultAction("action-link",Q);k.addDefaultAction("show-more",Q);var T=function P(W,V){var U=V[1].anchor;if(U!==null){var X=U.rel,Y,Z={};if(X&&X!==""){V[1].stop=true;Y=X.split("|");Z={filterOwner:window.unescape(Y[0]||""),filterId:window.unescape(Y[1]||""),filterData:window.unescape(Y[2]||""),filterDisplay:window.unescape(Y[3]||"")};Alfresco.logger.debug("DL_fnChangeFilterHandler","changeFilter =>",Z);k.fire("changeFilter",Z)}}return true};k.addDefaultAction("filter-change",T);this.modules.actions=new Alfresco.module.DataListActions();this.modules.dataGrid=this;y.removeClass(this.id+"-selectListMessage","hidden");this.deferredListPopulation.fulfil("onReady");y.setStyle(this.id+"-body","visibility","visible")},onHistoryManagerReady:function h(){Alfresco.logger.debug("DataGrid_onHistoryManagerReady","changeFilter =>",this.options.initialFilter);k.fire("changeFilter",YAHOO.lang.merge({datagridFirstTimeNav:true},this.options.initialFilter))},_onDataListFailure:function a(R,Q){Alfresco.util.PopupManager.displayPrompt({title:Q.title,text:Q.text,modal:true,buttons:[{text:this.msg("button.ok"),handler:function P(){this.destroy()},isDefault:true}]})},renderDataListMeta:function m(){if(!YAHOO.lang.isObject(this.datalistMeta)){return}Alfresco.util.populateHTML([this.id+"-title",u(this.datalistMeta.title)],[this.id+"-description",f(u(this.datalistMeta.description,true))])},populateDataGrid:function M(){if(!YAHOO.lang.isObject(this.datalistMeta)){return}this.renderDataListMeta();Alfresco.util.Ajax.jsonGet({url:t(Alfresco.constants.URL_SERVICECONTEXT,"components/data-lists/config/columns?itemType="+encodeURIComponent(this.datalistMeta.itemType)),successCallback:{fn:this.onDatalistColumns,scope:this},failureCallback:{fn:this._onDataListFailure,obj:{title:this.msg("message.error.columns.title"),text:this.msg("message.error.columns.description")},scope:this}})},onDatalistColumns:function D(P){this.datalistColumns=P.json.columns;this._setupHistoryManagers();this._setupDataSource();this._setupDataTable();y.addClass(this.id+"-selectListMessage","hidden");this.widgets.itemSelect.set("disabled",false);YAHOO.util.History.onReady(this.onHistoryManagerReady,this,true)},_setupHistoryManagers:function l(){var S=YAHOO.util.History.getBookmarkedState("filter");S=S===null?"all":(YAHOO.env.ua.gecko>0)?S:window.escape(S);try{while(S!=(S=decodeURIComponent(S))){}}catch(X){}var Q=function Y(aa){var ab=aa.split("|"),ac={filterId:window.unescape(ab[0]||""),filterData:window.unescape(ab[1]||"")};ac.filterOwner=Alfresco.util.FilterManager.getOwner(ac.filterId);return ac};this.options.initialFilter=Q(S);YAHOO.util.History.register("filter",S,function P(aa){Alfresco.logger.debug("HistoryManager: filter changed:"+aa);if(YAHOO.env.ua.gecko>0){aa=window.unescape(aa);Alfresco.logger.debug("HistoryManager: filter (after Firefox fix):"+aa)}this._updateDataGrid.call(this,{filter:Q(aa)})},null,this);var W=this;var R=function Z(ab,aa){aa.widgets.paginator.setState(ab);YAHOO.util.History.navigate("page",String(ab.page))};if(this.options.usePagination){var V=YAHOO.util.History.getBookmarkedState("page")||"1";while(V!=(V=decodeURIComponent(V))){}this.currentPage=parseInt(V||this.options.initialPage,10);YAHOO.util.History.register("page",V,function T(aa){Alfresco.logger.debug("HistoryManager: page changed:"+aa);W.widgets.paginator.setPage(parseInt(aa,10));this.currentPage=parseInt(aa,10)},null,this);this.widgets.paginator=new YAHOO.widget.Paginator({containers:[this.id+"-paginator",this.id+"-paginatorBottom"],rowsPerPage:this.options.pageSize,initialPage:this.currentPage,template:this.msg("pagination.template"),pageReportTemplate:this.msg("pagination.template.page-report"),previousPageLinkLabel:this.msg("pagination.previousPageLinkLabel"),nextPageLinkLabel:this.msg("pagination.nextPageLinkLabel")});this.widgets.paginator.subscribe("changeRequest",R,this);y.setStyle(this.id+"-datagridBarBottom","display","block")}try{YAHOO.util.History.initialize("yui-history-field","yui-history-iframe")}catch(U){Alfresco.logger.error(this.name+": Couldn't initialize HistoryManager.",U);this.onHistoryManagerReady()}},_setupDataSource:function A(){var V=new Alfresco.util.NodeRef(this.datalistMeta.nodeRef);for(var S=0,U=this.datalistColumns.length;S<U;S++){var T=this.datalistColumns[S],R=T.name.replace(":","_"),Q=(T.type=="property"?"prop":"assoc")+"_"+R;this.dataRequestFields.push(R);this.dataResponseFields.push(Q);this.datalistColumns[Q]=T}this.widgets.dataSource=new YAHOO.util.DataSource(Alfresco.constants.PROXY_URI+"slingshot/datalists/data/node/"+V.uri,{connMethodPost:true,responseType:YAHOO.util.DataSource.TYPE_JSON,responseSchema:{resultsList:"items",metaFields:{paginationRecordOffset:"startIndex",totalRecords:"totalRecords"}}});this.widgets.dataSource.connMgr.setDefaultPostHeader(Alfresco.util.Ajax.JSON);this.widgets.dataSource.doBeforeCallback=function P(Y,W,Z){var X=W.metadata.parent.permissions;if(X&&X.userAccess){k.fire("userAccess",{userAccess:X.userAccess})}return Z}},_setupDataTable:function B(R){var T=[{key:"nodeRef",label:"",sortable:false,formatter:this.fnRenderCellSelected(),width:16}];var Q;for(var S=0,X=this.datalistColumns.length;S<X;S++){Q=this.datalistColumns[S];T.push({key:this.dataResponseFields[S],label:Q.label,sortable:true,sortOptions:{field:Q.formsName,sortFunction:this.getSortFunction()},formatter:this.getCellFormatter(Q.dataType)})}T.push({key:"actions",label:this.msg("label.column.actions"),sortable:false,formatter:this.fnRenderCellActions(),width:parseInt(this.options.actionsColumnWidth,10)});var W=this;this.widgets.dataTable=new YAHOO.widget.DataTable(this.id+"-grid",T,this.widgets.dataSource,{renderLoopSize:this.options.usePagination?16:32,initialLoad:false,dynamicData:false,MSG_EMPTY:this.msg("message.empty"),MSG_ERROR:this.msg("message.error"),MSG_SORTASC:this.msg("message.sortasc"),MSG_SORTDESC:this.msg("message.sortdesc"),paginator:this.widgets.paginator});this.widgets.dataTable.handleDataReturnPayload=function P(Z,Y,aa){W.totalRecords=Y.meta.totalRecords;Y.meta.pagination={rowsPerPage:W.options.pageSize,recordOffset:(W.currentPage-1)*W.options.pageSize};return Y.meta};this.widgets.dataTable.doBeforeLoadData=function V(Z,aa,ac){if(aa.error){try{var Y=YAHOO.lang.JSON.parse(aa.responseText);W.widgets.dataTable.set("MSG_ERROR",Y.message)}catch(ab){W._setDefaultDataTableErrors(W.widgets.dataTable)}}if(aa.results.length===0){this.fireEvent("renderEvent",{type:"renderEvent"})}return true};this.widgets.dataTable.doBeforeSortColumn=function U(Z,Y){W.currentSort={oColumn:Z,sSortDir:Y};return true};this.widgets.dataTable.subscribe("checkboxClickEvent",function(Y){var Z=Y.target.value;this.selectedItems[Z]=Y.target.checked;k.fire("selectedItemsChanged")},this,true);this.widgets.dataTable.subscribe("beforeRenderEvent",function(){if(W.currentSort){var ab=W.currentSort.oColumn,Z=W.currentSort.sSortDir,aa=(ab.sortOptions&&YAHOO.lang.isFunction(ab.sortOptions.sortFunction))?ab.sortOptions.sortFunction:null;if(Z||aa){aa=aa||this.get("sortFunction");var Y=(ab.sortOptions&&ab.sortOptions.field)?ab.sortOptions.field:ab.field;this._oRecordSet.sortRecords(aa,((Z==YAHOO.widget.DataTable.CLASS_DESC)?true:false),Y)}}},this.widgets.dataTable,true);this.widgets.dataTable.subscribe("postRenderEvent",function(){if(W.currentSort){if(W.currentSort.oColumn._elTh.getElementsByTagName("a").length==1){W.currentSort.oColumn._elTh.getElementsByTagName("a")[0].focus()}}},this.widgets.dataTable,true);this.widgets.dataTable.subscribe("renderEvent",function(){Alfresco.logger.debug("DataTable renderEvent");if(YAHOO.env.ua.ie<7){var Y=this.widgets.dataTable.getTableEl().parentNode;Y.className=Y.className}for(var aa=0,Z=this.afterDataGridUpdate.length;aa<Z;aa++){this.afterDataGridUpdate[aa].call(this)}this.afterDataGridUpdate=[]},this,true);this.widgets.dataTable.subscribe("rowMouseoverEvent",this.onEventHighlightRow,this,true);this.widgets.dataTable.subscribe("rowMouseoutEvent",this.onEventUnhighlightRow,this,true)},onItemSelect:function e(T,S,R){var P=S[0],Q=S[1];this.selectItems(Alfresco.util.findEventClass(Q));x.preventDefault(P)},onEventHighlightRow:function d(ah){var Q=y.get(this.id+"-actions-"+ah.target.id);if(Q&&Q.firstChild===null){this.widgets.dataTable.onEventHighlightRow.call(this.widgets.dataTable,ah);var R=this.widgets.dataTable.getRecord(ah.target.id),ai=y.get(this.id+"-actionSet").cloneNode(true);ai.innerHTML=YAHOO.lang.substitute(window.unescape(ai.innerHTML),this.getActionUrls(R));ai.id=Q.id+"_a";y.addClass(ai,"simple");var aj=R.getData("permissions").userAccess,W=R.getData("actionLabels")||{};aj["filter-"+this.currentFilter.filterId]=true;var X=YAHOO.util.Selector.query("div",ai),aa,ab,af,P,U,ad,Y,ac,ag;for(ad=0,Y=X.length;ad<Y;ad++){aa=X[ad];ab=aa.firstChild;af=ab.firstChild;if(af&&W[aa.className]){af.innerHTML=u(W[aa.className])}if(ab.rel!==""){P=ab.rel.split(",");for(ac=0,ag=P.length;ac<ag;ac++){U=P[ac];if((U.charAt(0)=="~")?!!aj[U.substring(1)]:!aj[U]){ai.removeChild(aa);break}}}}var V=this.options.splitActionsAt;X=YAHOO.util.Selector.query("div",ai);if(X.length>V){var S=y.get(this.id+"-moreActions").cloneNode(true);var ae=YAHOO.util.Selector.query("div",S);y.insertBefore(ae[0],X[V]);y.insertBefore(ae[1],X[V]);var T,Z=X.slice(V);for(T in Z){if(Z.hasOwnProperty(T)){ae[1].appendChild(Z[T])}}}Q.appendChild(ai)}if(this.showingMoreActions){this.deferredActionsMenu=Q}else{if(!y.hasClass(document.body,"masked")){this.currentActionsMenu=Q;y.removeClass(Q,"hidden");this.deferredActionsMenu=null}}},onEventUnhighlightRow:function g(Q){this.widgets.dataTable.onEventUnhighlightRow.call(this.widgets.dataTable,Q);var P=y.get(this.id+"-actions-"+(Q.target.id));if(!this.showingMoreActions||y.hasClass(document.body,"masked")){if(this.hideMoreActionsFn){this.hideMoreActionsFn.call(this)}y.addClass(P,"hidden");this.deferredActionsMenu=null}},onActionShowMore:function n(Q,P){y.addClass(P.firstChild,"highlighted");var R=y.getNextSibling(P);y.removeClass(R,"hidden");this.hideMoreActionsFn=function S(){this.hideMoreActionsFn=null;y.removeClass(P.firstChild,"highlighted");y.addClass(R,"hidden")}},getActionUrls:function J(Q){var P=YAHOO.lang.isFunction(Q.getData)?Q.getData():Q,R=P.nodeRef;return({editMetadataUrl:"edit-dataitem?nodeRef="+R})},getSelectedItems:function I(){var Q=[],T=this.widgets.dataTable.getRecordSet(),V=this.widgets.paginator.getPageRecords();if(!V){return}var R=V[0],U=V[1],P;for(var S=R;S<=U;S++){P=T.getRecord(S);if(this.selectedItems[P.getData("nodeRef")]){Q.push(P.getData())}}return Q},selectItems:function H(X){var V=this.widgets.dataTable.getRecordSet(),Q=s.query('input[type="checkbox"]',this.widgets.dataTable.getTbodyEl()),P=this.widgets.paginator.getPageRecords(),U,T=Q.length,S,R,W;if(P){U=P[0];switch(X){case"selectAll":W=function(Y,Z){return true};break;case"selectNone":W=function(Y,Z){return false};break;case"selectInvert":W=function(Y,Z){return !Z};break;default:W=function(Y,Z){return Z}}for(R=0;R<T;R++){S=V.getRecord(R+U);this.selectedItems[S.getData("nodeRef")]=Q[R].checked=W(S.getData("type"),Q[R].checked)}k.fire("selectedItemsChanged")}},onActionEdit:function q(T){var S=this;var R=function P(X,Y){Alfresco.util.populateHTML([Y.id+"-dialogTitle",this.msg("label.edit-row.title")])};var V=YAHOO.lang.substitute(Alfresco.constants.URL_SERVICECONTEXT+"components/form?itemKind={itemKind}&itemId={itemId}&mode={mode}&submitType={submitType}&showCancelButton=true",{itemKind:"node",itemId:T.nodeRef,mode:"edit",submitType:"json"});var U=new Alfresco.module.SimpleDialog(this.id+"-editDetails");U.setOptions({width:this.options.editDialogWidth,templateUrl:V,actionUrl:null,destroyOnHide:true,doBeforeDialogShow:{fn:R,scope:this},onSuccess:{fn:function W(X){Alfresco.util.Ajax.jsonPost({url:Alfresco.constants.PROXY_URI+"slingshot/datalists/item/node/"+new Alfresco.util.NodeRef(T.nodeRef).uri,dataObj:this._buildDataGridParams(),successCallback:{fn:function Y(aa){k.fire("dataItemUpdated",{item:aa.json.item});Alfresco.util.PopupManager.displayMessage({text:this.msg("message.details.success")})},scope:this},failureCallback:{fn:function Z(aa){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.details.failure")})},scope:this}})},scope:this},onFailure:{fn:function Q(X){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.details.failure")})},scope:this}}).show()},onActiveDataListChanged:function N(Q,P){var R=P[1];if((R!==null)&&(R.dataList!==null)){this.datalistMeta=R.dataList;if(!this.deferredListPopulation.fulfil("onActiveDataListChanged")){this.populateDataGrid()}}},onDataListDetailsUpdated:function p(Q,P){var R=P[1];if((R!==null)&&(R.dataList!==null)){this.dataListMeta=R.dataList;this.renderDataListMeta()}},onDataGridRefresh:function w(Q,P){this._updateDataGrid.call(this,{page:this.currentPage})},onChangeFilter:function C(S,R){var V=R[1];if((V!==null)&&(V.filterId!==null)){var U=Alfresco.util.cleanBubblingObject(V),T=YAHOO.lang.substitute("{filterId}|{filterData}",U,function(X,Y,W){return typeof Y=="undefined"?"":window.escape(Y)}),Q=T.split("|");if(Q[1].length===0){T=Q[0]}Alfresco.logger.debug("DataGrid_onChangeFilter: ",U);var P={filter:T};if(V.datagridFirstTimeNav){this._updateDataGrid.call(this,{filter:U,page:this.currentPage})}else{if(this.options.usePagination){this.currentPage=1;P.page="1"}Alfresco.logger.debug("DataGrid_onChangeFilter: objNav = ",P);YAHOO.util.History.multiNavigate(P)}}},onFilterChanged:function o(Q,P){var R=P[1];if((R!==null)&&(R.filterId!==null)){R.filterOwner=R.filterOwner||Alfresco.util.FilterManager.getOwner(R.filterId);this.currentFilter=Alfresco.util.cleanBubblingObject(R);Alfresco.logger.debug("DL_onFilterChanged: ",this.currentFilter)}},onDataItemCreated:function E(R,P){var T=P[1];if(T&&(T.nodeRef!==null)){var S=new Alfresco.util.NodeRef(T.nodeRef);Alfresco.util.Ajax.jsonPost({url:Alfresco.constants.PROXY_URI+"slingshot/datalists/item/node/"+S.uri,dataObj:this._buildDataGridParams(),successCallback:{fn:function Q(W){var X=W.json.item;var V=function Y(){var aa=this._findRecordByParameter(X.nodeRef,"nodeRef");if(aa!==null){var Z=this.widgets.dataTable.getTrEl(aa);Alfresco.util.Anim.pulse(Z)}};this.afterDataGridUpdate.push(V);this.widgets.dataTable.addRow(X)},scope:this},failureCallback:{fn:function U(V){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.create.refresh.failure")})},scope:this}})}},onDataItemUpdated:function c(Q,P){var T=P[1];if(T&&(T.item!==null)){var S=this._findRecordByParameter(T.item.nodeRef,"nodeRef");if(S!==null){this.widgets.dataTable.updateRow(S,T.item);var R=this.widgets.dataTable.getTrEl(S);Alfresco.util.Anim.pulse(R)}}},onDataItemsDeleted:function O(R,P){var V=P[1];if(V&&(V.items!==null)){var U,T,W=function(Y){return function X(){this.widgets.dataTable.deleteRow(Y)}};for(var Q=0,S=V.items.length;Q<S;Q++){U=this._findRecordByParameter(V.items[Q].nodeRef,"nodeRef");if(U!==null){T=this.widgets.dataTable.getTrEl(U);Alfresco.util.Anim.fadeOut(T,{callback:W(U),scope:this})}}}},_setDefaultDataTableErrors:function z(P){var Q=Alfresco.util.message;P.set("MSG_EMPTY",Q("message.empty","Alfresco.component.DataGrid"));P.set("MSG_ERROR",Q("message.error","Alfresco.component.DataGrid"))},_updateDataGrid:function G(ab){ab=ab||{};Alfresco.logger.debug("DataGrid__updateDataGrid: ",ab.filter);var ad=YAHOO.lang.merge({},ab.filter!==undefined?ab.filter:this.currentFilter),W=null,S=null,Y=this,R={filter:ad};var T=function aa(){Alfresco.logger.debug("DataGrid__uDG_fnShowLoadingMessage: slow data webscript detected.");if(S){W=Alfresco.util.PopupManager.displayMessage({displayTime:0,text:'<span class="wait">'+u(this.msg("message.loading"))+"</span>",noEscape:true});if(YAHOO.env.ua.ie>0){this.loadingMessageShowing=true}else{W.showEvent.subscribe(function(){this.loadingMessageShowing=true},this,true)}}};this._setDefaultDataTableErrors(this.widgets.dataTable);this.showingMoreActions=false;this.loadingMessageShowing=false;S=YAHOO.lang.later(this.options.loadingMessageDelay,this,T);var ac=function V(){if(S){S.cancel();S=null}if(W){if(this.loadingMessageShowing){W.destroy();W=null}else{YAHOO.lang.later(100,Y,ac)}}};var U=function X(af,ag,ai){ac();var ae=function ah(){k.fire("selectedFilesChanged")};this.afterDataGridUpdate.push(ae);Alfresco.logger.debug("currentFilter was:",this.currentFilter,"now:",ad);this.currentFilter=ad;this.currentPage=ab.page||1;k.fire("filterChanged",ad);this.widgets.dataTable.onDataReturnReplaceRows.call(this.widgets.dataTable,af,ag,ai)};var P=function Q(af,ag){ac();this.afterDataGridUpdate=[];if(ag.status==401){window.location.reload(true)}else{try{var ae=YAHOO.lang.JSON.parse(ag.responseText);this.widgets.dataTable.set("MSG_ERROR",ae.message);this.widgets.dataTable.showTableMessage(ae.message,YAHOO.widget.DataTable.CLASS_ERROR);if(ag.status==404){k.fire("deactivateAllControls")}}catch(ah){this._setDefaultDataTableErrors(this.widgets.dataTable)}}};var Z=this._buildDataGridParams(R);Alfresco.logger.debug("DataSource requestParams: ",Z);if(Alfresco.util.CSRFPolicy.isFilterEnabled()){this.widgets.dataSource.connMgr.initHeader(Alfresco.util.CSRFPolicy.getHeader(),Alfresco.util.CSRFPolicy.getToken(),false)}this.widgets.dataSource.sendRequest(YAHOO.lang.JSON.stringify(Z),{success:U,failure:P,scope:this})},_buildDataGridParams:function r(Q){var P={fields:this.dataRequestFields};if(Q&&Q.filter){P.filter={filterId:Q.filter.filterId,filterData:Q.filter.filterData}}return P},_findRecordByParameter:function K(T,S){var R=this.widgets.dataTable.getRecordSet();for(var Q=0,P=R.getLength();Q<P;Q++){if(R.getRecord(Q).getData(S)==T){return R.getRecord(Q)}}return null}},true)})();