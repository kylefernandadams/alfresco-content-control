(function(){var m=$.fullCalendar,l=m.formatDate,s=m.parseISO8601,f=m.addDays,b=m.applyAll,o=Alfresco.util.encodeHTML,g=Alfresco.util.fromISO8601,i=Alfresco.util.toISO8601,p=Alfresco.thirdparty.dateFormat,c=YAHOO.util.History,h="";document.jquery=$;YAHOO.lang.augmentObject(Alfresco.CalendarView.prototype,{getFullCalendarViewType:function n(t){switch(t){case Alfresco.CalendarView.VIEWTYPE_DAY:return this.options.fcOpts.dayView;case Alfresco.CalendarView.VIEWTYPE_WEEK:return this.options.fcOpts.weekView;case Alfresco.CalendarView.VIEWTYPE_MONTH:return this.options.fcOpts.monthView}},renderEvents:function q(){var C=c.getBookmarkedState("view")||this.options.view,y=c.getBookmarkedState("date")||p(this.options.startDate,"yyyy-mm-dd");c.register("view",C,function z(F){this.onViewNav(F)},{},this);c.register("date",y,function x(F){this.onDateNav(F)},{},this);try{c.initialize("yui-history-field","yui-history-iframe")}catch(A){Alfresco.logger.error("Alfresco.CalendarView: Couldn't initialize HistoryManager.",A)}h=document.jquery("#"+this.options.id);this.initFullCalendar();YAHOO.Bubbling.on("eventEdited",this.onEventEdited,this);YAHOO.Bubbling.on("eventSaved",this.onEventSaved,this);YAHOO.Bubbling.on("eventDeleted",this.onEventDeleted,this);YAHOO.Bubbling.on("tagSelected",this.onTagSelected,this);YAHOO.Bubbling.on("todayNav",function u(){h.fullCalendar("today")},this);YAHOO.Bubbling.on("nextNav",function B(){h.fullCalendar("next")},this);YAHOO.Bubbling.on("prevNav",function E(){h.fullCalendar("prev")},this);YAHOO.Bubbling.on("toggleWorkHours",this.onToggleWorkHours,this);YAHOO.Bubbling.on("viewChanged",function w(H,G){var F=Alfresco.util.ComponentManager.findFirst("Alfresco.CalendarToolbar").enabledViews[G[1].activeView];if(F===Alfresco.CalendarView.VIEWTYPE_AGENDA){this.onViewChanged.apply(this,arguments)}else{c.navigate("view",F)}},this);YAHOO.Bubbling.on("dateChanged",function v(G,F){c.navigate("date",p(F[1].date,"yyyy-mm-dd"))},this);var D=Alfresco.widget.Resizer.prototype.onResizeNotification;Alfresco.widget.Resizer.prototype.onResizeNotification=function t(){D();h.fullCalendar("render")}},initFullCalendar:function d(){var u=g(c.getBookmarkedState("date"))||this.options.startDate,t=c.getBookmarkedState("view")||this.options.view;var v=this;$(document).ready(function(){if(v.options.permitToCreateEvents){h.addClass("calendar-editable")}h.fullCalendar({defaultView:v.getFullCalendarViewType(t),date:u.getDate(),month:u.getMonth(),year:u.getFullYear(),weekMode:v.options.fcOpts.weekMode,weekends:v.options.fcOpts.weekends,allDaySlot:v.options.fcOpts.allDaySlot,firstDay:parseInt(Alfresco.util.message("calendar.widget_config.start_weekday")),firstHour:v.options.fcOpts.firstHour,minTime:(v.options.fcOpts.showWorkHours)?v.options.fcOpts.minTimeWorkHours:v.options.fcOpts.minTimeToggle,maxTime:(v.options.fcOpts.showWorkHours)?v.options.fcOpts.maxTimeWorkHours:v.options.fcOpts.maxTimeToggle,aspectRatio:v.options.fcOpts.aspectRatio,slotMinutes:v.options.fcOpts.slotMinutes,disableDragging:v.options.fcOpts.disableDragging,disableResizing:v.options.fcOpts.disableResizing,height:2000,ignoreTimezone:false,monthNames:v.msg("months.long").split(","),monthNamesShort:v.msg("months.short").split(","),dayNames:v.msg("days.long").split(","),dayNamesShort:v.msg("days.medium").split(","),buttonText:{month:v.msg("label.month"),week:v.msg("label.week"),day:v.msg("label.day")},allDayText:v.msg("label.all-day"),timeFormat:{month:v.msg("fullCalendar.timeFormat.month"),week:v.msg("fullCalendar.timeFormat.week"),day:v.msg("fullCalendar.timeFormat.day")},columnFormat:{month:v.msg("fullCalendar.columnFormat.month"),week:v.msg("fullCalendar.columnFormat.week"),day:v.msg("fullCalendar.columnFormat.day")},titleFormat:{month:v.msg("fullCalendar.titleFormat.month"),week:v.msg("fullCalendar.titleFormat.week"),day:v.msg("fullCalendar.titleFormat.day")},axisFormat:v.msg("fullCalendar.axisFormat"),header:{left:"title",center:"",right:""},editable:v.options.permitToCreateEvents,eventSources:[{url:Alfresco.constants.PROXY_URI+"calendar/events/"+v.options.siteId+"/user?repeating=all",startParam:"from",startParamFn:function(C){return i(C).split("T")[0]},endParam:"to",endParamFn:function(C){return i(C).split("T")[0]},success:function(E){var C=[];if(E.events){var D=v.tagFilter(E.events);YAHOO.Bubbling.fire("eventDataLoad",D);$.each(D,function(F,G){C.push(YAHOO.lang.augmentObject({id:o(G.name),start:s(G.startAt.iso8601),end:s(G.endAt.iso8601),allDay:(G.allday==="true")?true:false,location:o(G.where),uri:"/calendar/event/"+v.options.siteId+"/"+o(G.name)+"?date="+G.startAt.iso8601.split("T")[0],description:o(G.description),title:G.title,where:o(G.where),url:Alfresco.constants.URL_CONTEXT+G.url},G))})}return C}}],eventClick:function x(E,D,C){v.showDialog(D,E);return false},eventDrop:function A(H,F,E,G,D,I,C){v.updateEvent(H,F,E,G,D,I,C)},eventResize:function w(H,F,E,G,D,I,C){v.updateEvent(H,F,E,G,D,I,C)},viewDisplay:function z(C){if(C.name===v.options.fcOpts.monthView){h.fullCalendar("option","height",null)}},dayClick:function B(E,F,D,C){if(v.options.permitToCreateEvents){v.showAddDialog(E)}},afterEventChange:function y(F){var E=h.fullCalendar("clientEvents",F);for(var D=0;D<E.length;D++){var G=E[D],C=i(G.start),H=i(G.end)||C;G.startAt={iso8601:C};G.endAt={iso8601:H}}}})})},getEvents:function j(){h.fullCalendar("refetchEvents");this.refreshTags()},updateEvent:function k(t,v,y,x,z,A,B){var w=t.end||t.start,u={desc:t.description,docfolder:t.docfolder||"",startAt:{iso8601:i(t.start)},endAt:{iso8601:i(w)},page:Alfresco.constants.PAGEID,site:Alfresco.constants.SITE,tags:(t.tags)?t.tags.join():[],what:t.title,where:t.where};if(t.allDay){u.allday="true"}Alfresco.util.Ajax.jsonPut({url:Alfresco.constants.PROXY_URI+"calendar/event/"+Alfresco.constants.SITE+"/"+t.name,dataObj:u,failureCallback:{fn:x}})},onDateNav:function r(t){if(typeof(t)==="string"){t=g(t)}h.fullCalendar("gotoDate",t)},onViewNav:function e(t){h.fullCalendar("changeView",this.getFullCalendarViewType(t))},onToggleWorkHours:function a(){h.fullCalendar("destroy");this.options.fcOpts.showWorkHours=(this.options.fcOpts.showWorkHours)?false:true;this.initFullCalendar()}},true)})();