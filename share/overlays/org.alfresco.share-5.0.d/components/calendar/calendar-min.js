(function(){var d=YAHOO.util.Dom,b=YAHOO.util.Event,c=YAHOO.util.Element;var a=Alfresco.util.encodeHTML;Alfresco.Calendar=function(f){this.name="Alfresco.Calendar";this.id=f;Alfresco.util.ComponentManager.register(this);Alfresco.util.YUILoaderHelper.require(["calendar","button","treeview"],this.onComponentsLoaded,this);return this};Alfresco.Calendar.prototype={eventDialog:null,calendar:null,setSiteId:function(f){this.siteId=f;return this},setMessages:function(f){Alfresco.util.addMessages(f,this.name);return this},onComponentsLoaded:function(){b.onContentReady(this.id,this.init,this,true)},init:function(){Alfresco.util.createYUIButton(this,"thisMonth-button",this.onThisMonthClick);var g=Alfresco.util.getCalendarControlConfiguration();this.calendar=new YAHOO.widget.Calendar("calendar",{navigator:g});Alfresco.util.calI18nParams(this.calendar);var h=Alfresco.util.ComponentManager.findFirst("Alfresco.CalendarView");if(h){var f=h.options.startDate;this.calendar.setMonth(f.getMonth());this.calendar.setYear(f.getFullYear())}this.calendar.render();this.calendar.selectEvent.subscribe(this.onDateSelected,this,true);YAHOO.Bubbling.on("eventDataLoad",this.onEventDataLoad,this);YAHOO.Bubbling.on("eventSaved",this.onEventSaved,this)},onDateSelected:function(g,f,j){var i=f[0];var h=this.calendar.toDate(i[0]);YAHOO.Bubbling.fire("dateChanged",{date:h})},onEventSaved:function(h,f){var i=f[1];if(i&&i.from){var j=i.from;var g=this.calendar.getSelectedDates();dates.push(Alfresco.util.formatDate(Alfresco.thirdparty.fromISO8601(j),"mm/dd/yyyy"));this.calendar.cfg.setProperty("selected",dates.join(","));this.calendar.render();Alfresco.util.PopupManager.displayMessage({text:this._msg("message.add.success",i.name)})}},onEventDataLoad:function(l,f){var h=f[1];if(h){var j=[];for(var g=0;g<h.length;g++){var k=h[g];if(k){var m=k.from||k.dtstart||k.when;j.push(Alfresco.util.formatDate(Alfresco.thirdparty.fromISO8601(m),"mm/dd/yyyy"))}}this.calendar.cfg.setProperty("selected",j.join(","));this.calendar.render()}},onThisMonthClick:function(h,g){var f=new Date();this.calendar.cfg.setProperty("pagedate",f.getMonth()+1+"/"+f.getFullYear());this.calendar.render();b.preventDefault(h)},_msg:function e(f){return Alfresco.util.message.call(this,f,this.name,Array.prototype.slice.call(arguments).slice(1))}}})();