(function(){var d=YAHOO.util.Dom;var a=Alfresco.util.encodeHTML;Alfresco.TagComponent=function(i){Alfresco.TagComponent.superclass.constructor.call(this,"Alfresco.TagComponent",i);YAHOO.Bubbling.on("tagSelected",this.onTagSelected,this);return this};YAHOO.extend(Alfresco.TagComponent,Alfresco.component.Base,{options:{siteId:"",containerId:""},onReady:function e(){this._registerDefaultActionHandler();Alfresco.util.createTwister(this.id+"-h2","TagComponent");YAHOO.Bubbling.on("tagRefresh",this.onTagRefresh,this)},_registerDefaultActionHandler:function h(){YAHOO.Bubbling.addDefaultAction("tag-link",function(k,i){var l=i[1].target;if(l){var j=l.firstChild.nodeValue;YAHOO.Bubbling.fire("tagSelected",{tagname:j})}return true})},onTagRefresh:function g(j){var i=YAHOO.lang.substitute(Alfresco.constants.PROXY_URI+"api/tagscopes/site/{site}/{container}/tags?d={d}",{site:this.options.siteId,container:this.options.containerId,d:new Date().getTime()});Alfresco.util.Ajax.request({method:Alfresco.util.Ajax.GET,url:i,successCallback:{fn:this.onTagsLoaded,scope:this},failureMessage:"Couldn't refresh tag data"})},onTagSelected:function c(j,i){var m=i[1].tagname,l=YAHOO.util.Selector.query("a[rel='"+m.replace("'","\\'")+"']",this.id),k=YAHOO.util.Selector.query("li",this.id);d.removeClass(k,"selected");if(l.length==1){d.addClass(l[0].parentNode.parentNode,"selected")}},onTagsLoaded:function f(o){var p=YAHOO.lang.JSON.parse(o.serverResponse.responseText);if(p&&!YAHOO.lang.isUndefined(p.tags)){var m='<li><span class="tag"><a href="#" class="tag-link" rel="-all-">'+this.msg("label.all-tags")+"</a></span></li>",k=p.tags,j,l,n;for(l=0,n=k.length;l<n;l++){j=k[l];m+=this._generateTagMarkup(j)}d.get(this.id+"-ul").innerHTML=m}},_generateTagMarkup:function b(i){var j='<li><span class="tag">';j+='<a href="#" class="tag-link" rel="'+a(i.name)+'">'+a(i.name)+"</a>&nbsp;("+i.count+")";j+="</span></li>";return j}})})();