(function(){var a=YAHOO.util.Dom,t=YAHOO.util.Event,r=YAHOO.util.Selector;var p=Alfresco.util.encodeHTML,s=Alfresco.util.siteURL;Alfresco.component.Header=function(v){return Alfresco.component.Header.superclass.constructor.call(this,"Alfresco.component.Header",v,["button","menu","container"])};YAHOO.extend(Alfresco.component.Header,Alfresco.component.Base,{options:{siteId:"",siteTitle:"",minSearchTermLength:1,tokens:{}},appItems:null,userItems:null,defaultSearchText:null,statusUpdateTime:null,onReady:function e(){a.removeClass(this.id+"-appItems","hidden");this.replaceUriTokens();this.configureSearch();this.configureMyStatus()},setAppItems:function g(v){this.appItems=v},setUserItems:function b(v){this.userItems=v},showAboutShare:function i(){Alfresco.module.getAboutShareInstance().show()},replaceUriTokens:function q(){var A=YAHOO.lang.merge(Alfresco.constants.URI_TEMPLATES,Alfresco.constants.HELP_PAGES,this.options.tokens),w=r.query("a",this.id),z,v;if(A.userid){A.userid=encodeURIComponent(A.userid)}for(var x=0,y=w.length;x<y;x++){z=w[x];v=a.getAttribute(z,"templateUri");if(v!=null){z.href=Alfresco.util.renderUriTemplate(v,A)}}},configureSearch:function f(){this.widgets.searchBox=a.get(this.id+"-searchText");this.defaultSearchText=this.msg("header.search.default");t.addListener(this.widgets.searchBox,"focus",this.onSearchFocus,null,this);t.addListener(this.widgets.searchBox,"blur",this.onSearchBlur,null,this);this.setDefaultSearchText();var v=this;this.widgets.searchEnterListener=new YAHOO.util.KeyListener(this.widgets.searchBox,{keys:YAHOO.util.KeyListener.KEY.ENTER},{fn:v.submitSearch,scope:this,correctScope:true},"keydown").enable();this.widgets.searchMore=new YAHOO.widget.Button(this.id+"-search_more",{type:"menu",menu:this.id+"-searchmenu_more"})},onSearchFocus:function u(){if(this.widgets.searchBox.value==this.defaultSearchText){a.removeClass(this.widgets.searchBox,"faded");this.widgets.searchBox.value=""}else{this.widgets.searchBox.select()}},onSearchBlur:function l(){var v=YAHOO.lang.trim(this.widgets.searchBox.value);if(v.length===0){YAHOO.lang.later(100,this,this.setDefaultSearchText,[])}},setDefaultSearchText:function c(){a.addClass(this.widgets.searchBox,"faded");this.widgets.searchBox.value=this.defaultSearchText},getSearchText:function d(){return YAHOO.lang.trim(this.widgets.searchBox.value)},submitSearch:function j(){var w=this.getSearchText();if(w.replace(/\*/g,"").length<this.options.minSearchTermLength){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.minimum-length",this.options.minSearchTermLength)})}else{var v="search?t="+encodeURIComponent(w);if(window.location.pathname.match("/repository$")=="/repository"||(window.location.pathname.match("/search$")=="/search"&&window.location.search.indexOf("r=true")!=-1)){v+="&r=true"}window.location=s(v)}},_currentStatus:"",_clickedStatusOnce:false,configureMyStatus:function n(){this.widgets.statusBox=a.get(this.id+"-statusText");this.widgets.statusTime=a.get(this.id+"-statusTime");this._currentStatus=this.widgets.statusBox.value;this.widgets.userMenu=a.get(this.id+"-user_user");t.addListener(this.widgets.userMenu,"click",function(){this.widgets.statusBox.value=this._currentStatus},null,this);var w=this.widgets.statusTime.attributes.title.value;if(w!==""){this.statusUpdateTime=Alfresco.util.fromISO8601(w)}this.setStatusRelativeTime();Alfresco.util.bind(function v(){var D=this.userItems.concat(this.appItems),F;for(var A=0,C=D.length;A<C;A++){F=D[A];if(F instanceof YAHOO.widget.Button&&YAHOO.lang.isFunction(F.getMenu)&&F.getMenu()!==null){var z=F.getMenu().getItems(),B;for(var y=0,E=z.length;y<E;y++){B=z[y];if(a.hasClass(B.element,"HEADER-MARKER")){B.cfg.setProperty("disabled",true);return}}}}},this)();t.on(this.widgets.statusBox,"click",function(y){t.stopEvent(y)});var x=this;YAHOO.util.Event.addListener(this.id+"-statusText","click",function(y){if(x._clickedStatusOnce){}else{x._clickedStatusOnce=true;a.get(x.id+"-statusText").value=""}});YAHOO.util.Event.addListener(this.id+"-statusText","blur",function(y){x._clickedStatusOnce=false});this.widgets.submitStatus=new YAHOO.widget.Button(this.id+"-submitStatus");this.widgets.submitStatus.on("click",this.submitStatus,this.widgets.submitStatus,this)},getStatusText:function h(){return YAHOO.lang.trim(this.widgets.statusBox.value)},setStatusRelativeTime:function m(){var v=(this.statusUpdateTime===null)?this.msg("status.never-updated"):Alfresco.util.relativeTime(this.statusUpdateTime);this.widgets.statusTime.innerHTML=this.msg("status.updated",v)},submitStatus:function o(){this._clickedStatusOnce=false;Alfresco.util.Ajax.jsonPost({url:Alfresco.constants.URL_SERVICECONTEXT+"components/profile/userstatus",dataObj:{status:this.getStatusText()},successCallback:{fn:this.onStatusUpdated,scope:this},failureMessage:this.msg("message.status.failure")})},onStatusUpdated:function k(v){this.statusUpdateTime=Alfresco.util.fromISO8601(v.json.userStatusTime.iso8601);this.setStatusRelativeTime();this._currentStatus=this.getStatusText();Alfresco.util.PopupManager.displayMessage({text:this.msg("message.status.success")})}})})();