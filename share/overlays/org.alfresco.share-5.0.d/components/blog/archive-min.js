(function(){var e=YAHOO.util.Dom;Alfresco.BlogPostListArchive=function(i){Alfresco.BlogPostListArchive.superclass.constructor.call(this,"Alfresco.BlogPostListArchive",i);this.monthId={id:0,months:{}};YAHOO.Bubbling.on("archiveRefresh",this.onArchiveRefresh,this);return this};YAHOO.extend(Alfresco.BlogPostListArchive,Alfresco.component.BaseFilter,{options:{siteId:"",containerId:"blog"},monthId:null,onReady:function c(){Alfresco.BlogPostListArchive.superclass.onReady.call(this);var i=this;YAHOO.Bubbling.addDefaultAction(this.uniqueEventKey,function(l,k){var m=k[1].target;if(m&&!i.controlsDeactivated){var n=e.getAncestorByTagName(m,"li");var j=i._getMonthFromId(n.id);YAHOO.Bubbling.fire("changeFilter",{filterId:"bymonth",filterOwner:i.name,filterData:{year:j.getFullYear(),month:j.getMonth()}})}return true},true);if(this.options.siteId&&this.options.containerId){YAHOO.Bubbling.fire("archiveRefresh")}},onFilterChanged:function g(k,j){var l=j[1];if((l!==null)&&(l.filterId!==null)){if(l.filterOwner==this.name){if(this.selectedFilter!==null){e.removeClass(this.selectedFilter,"selected")}var i=new Date(l.filterData.year,l.filterData.month,1);this.selectedFilter=e.get(this._generateIdFromMonth(i));e.addClass(this.selectedFilter,"selected")}else{if(this.selectedFilter!==null){e.removeClass(this.selectedFilter,"selected");this.selectedFilter=null}}}},onArchiveRefresh:function d(k,j){var l=new Date().getTime();var i=YAHOO.lang.substitute(Alfresco.constants.PROXY_URI+"api/blog/site/{site}/{container}/postspermonth?d="+l,{site:this.options.siteId,container:this.options.containerId});Alfresco.util.Ajax.request({method:Alfresco.util.Ajax.GET,url:i,successCallback:{fn:this.onArchiveRefresh_success,scope:this},failureCallback:{fn:this.onArchiveRefresh_success,scope:this}})},onArchiveRefresh_success:function h(l){if(l&&l.json&&!YAHOO.lang.isUndefined(l.json.items)){var p="";var k=l.json.items;for(var o=0,n=k.length;o<n;o++){var m=new Date(k[o].year,k[o].month,1);p+=this._generateMonthMarkup(m)}var q=e.get(this.id+"-archive");q.innerHTML=p}},_generateMonthMarkup:function b(i){var j='<li id="'+this._generateIdFromMonth(i)+'"><span class="nav-label">';j+='<a href="#" class="'+this.uniqueEventKey+' filter-link">'+Alfresco.util.formatDate(i,Alfresco.util.message("date-format.monthYear"))+"</a>";j+="</span></li>";return j},_generateIdFromMonth:function f(i){return this.id+"-month-"+i.getTime()},_getMonthFromId:function a(j){var i=parseInt(j.substring((this.id+"-month-").length),10);return new Date(i)}})})();