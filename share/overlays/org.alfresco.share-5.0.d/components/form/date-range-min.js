(function(){var l=YAHOO.util.Dom,m=YAHOO.util.Event,d=YAHOO.util.KeyListener;var i=Alfresco.util.encodeHTML;Alfresco.DateRange=function(q,p){Alfresco.DateRange.superclass.constructor.call(this,"Alfresco.DateRange",q,["button","calendar"]);this.valueHtmlId=p;this.currentFromDate="";this.currentToDate="";return this};YAHOO.extend(Alfresco.DateRange,Alfresco.component.Base,{currentFromDate:null,currentToDate:null,onReady:function c(){var u=new Date();var x=new Date();var p=Alfresco.util.fromISO8601;x.setMonth(u.getMonth()-1);if(l.get(this.valueHtmlId).value){var t=l.get(this.valueHtmlId).value.split("|");if(t[0]){t[0]=Alfresco.util.toISO8601(Date.parse(t[0]))||t[0];var w=Alfresco.util.fromISO8601(t[0]).toString(this.msg("form.control.date-picker.entry.date.format"));l.get(this.id+"-date-from").value=w;this.currentFromDate=t[0]}if(t[1]){t[1]=Alfresco.util.toISO8601(Date.parse(t[1]))||t[1];var q=Alfresco.util.fromISO8601(t[1]).toString(this.msg("form.control.date-picker.entry.date.format"));l.get(this.id+"-date-to").value=q;this.currentToDate=t[1]}l.get(this.valueHtmlId).value=t.join("|")}var v=(x.getMonth()+1)+"/"+x.getFullYear();var r=(x.getMonth()+1)+"/"+x.getDate()+"/"+x.getFullYear();var s=Alfresco.util.getCalendarControlConfiguration();this.widgets.calendarFrom=new YAHOO.widget.Calendar(this.id+"-from",this.id+"-from",{title:this.msg("form.control.date-picker.choose"),close:true,navigator:s});this.widgets.calendarFrom.cfg.setProperty("pagedate",v);this.widgets.calendarFrom.cfg.setProperty("selected",r);this.widgets.calendarFrom.hideEvent.subscribe(function(){l.getElementsByClassName("datepicker-icon","img",this.id+"-icon-from")[0].focus()},this,true);Alfresco.util.calI18nParams(this.widgets.calendarFrom);Alfresco.util.useAsButton(l.getElementsByClassName("datepicker-icon","img",this.id+"-icon-from")[0],this._showPickerFrom,null,this);v=(u.getMonth()+1)+"/"+u.getFullYear();r=(u.getMonth()+1)+"/"+u.getDate()+"/"+u.getFullYear();this.widgets.calendarTo=new YAHOO.widget.Calendar(this.id+"-to",this.id+"-to",{title:this.msg("form.control.date-picker.choose"),close:true,navigator:s});this.widgets.calendarTo.cfg.setProperty("pagedate",v);this.widgets.calendarTo.cfg.setProperty("selected",r);this.widgets.calendarTo.hideEvent.subscribe(function(){l.getElementsByClassName("datepicker-icon","img",this.id+"-icon-to")[0].focus()},this,true);Alfresco.util.calI18nParams(this.widgets.calendarTo);Alfresco.util.useAsButton(l.getElementsByClassName("datepicker-icon","img",this.id+"-icon-to")[0],this._showPickerTo,null,this);this.widgets.calendarFrom.selectEvent.subscribe(this._handlePickerChangeFrom,this,true);m.addListener(this.id+"-date-from","keyup",this._handleFieldChangeFrom,this,true);m.addListener(this.id+"-icon-from","click",this._showPickerFrom,this,true);this.widgets.calendarTo.selectEvent.subscribe(this._handlePickerChangeTo,this,true);m.addListener(this.id+"-date-to","keyup",this._handleFieldChangeTo,this,true);m.addListener(this.id+"-icon-to","click",this._showPickerTo,this,true);this.widgets.calendarFrom.render();this.widgets.calendarTo.render()},_showPickerFrom:function g(p){this.widgets.calendarFrom.show()},_showPickerTo:function j(p){this.widgets.calendarTo.show()},_setValueAndSavePosition:function e(t,u){var s=t.selectionStart;var r=t.selectionEnd;var p=false;if(typeof s=="undefined"){p=true;var q=this._getInputSelection(t);s=q.start;r=q.end}t.value=u;if(s==r){if(!p){t.selectionStart=s;t.selectionEnd=r}else{this._setCaretPosition(t,s)}}else{}},_getInputSelection:function n(q){var p=0,r=0,w,t,x,u,s;t=document.selection.createRange();if(t&&t.parentElement()==q){u=q.value.length;w=q.value.replace(/\r\n/g,"\n");x=q.createTextRange();x.moveToBookmark(t.getBookmark());s=q.createTextRange();s.collapse(false);if(x.compareEndPoints("StartToEnd",s)>-1){p=r=u}else{p=-x.moveStart("character",-u);p+=w.slice(0,p).split("\n").length-1;if(x.compareEndPoints("EndToEnd",s)>-1){r=u}else{r=-x.moveEnd("character",-u);r+=w.slice(0,r).split("\n").length-1}}}var v={start:p,end:r};return v},_setCaretPosition:function o(r,q){if(r!=null){if(r.createTextRange){var p=r.createTextRange();p.move("character",q);p.select()}else{if(r.selectionStart){r.focus();r.setSelectionRange(q,q)}else{r.focus()}}}},_handlePickerChangeFrom:function f(u,r,v){var t=r[0];var s=this.widgets.calendarFrom.toDate(t[0]);var q=s.toString(this.msg("form.control.date-picker.entry.date.format"));var v=l.get(this.id+"-date-from");this._setValueAndSavePosition(v,q);if(s!=null){var p=Alfresco.util.toISO8601(s,{milliseconds:false});this.currentFromDate=p;this._updateCurrentValue();l.removeClass(this.id+"-date-from","invalid")}if(l.getStyle(this.id+"-from","display")!="none"){this.widgets.calendarFrom.hide()}},_handlePickerChangeTo:function k(u,r,v){var t=r[0];var s=this.widgets.calendarTo.toDate(t[0]);var q=s.toString(this.msg("form.control.date-picker.entry.date.format"));var v=l.get(this.id+"-date-to");this._setValueAndSavePosition(v,q);if(s!=null){var p=Alfresco.util.toISO8601(s,{milliseconds:false});this.currentToDate=p;this._updateCurrentValue();l.removeClass(this.id+"-date-to","invalid")}if(l.getStyle(this.id+"-to","display")!="none"){this.widgets.calendarTo.hide()}},_updateCurrentValue:function a(){var p=this.currentFromDate+"|"+this.currentToDate;p=p=="|"?"":p;l.get(this.valueHtmlId).value=p},_handleFieldChangeFrom:function b(s){var t=l.get(this.id+"-date-from").value;if(t.length>0){if(s==undefined||(s.keyCode!=d.KEY.TAB&&s.keyCode!=d.KEY.SHIFT)){var r=Date.parseExact(t,this.msg("form.control.date-picker.entry.date.format"));if(r!=null){this.widgets.calendarFrom.select((r.getMonth()+1)+"/"+r.getDate()+"/"+r.getFullYear());var q=this.widgets.calendarFrom.getSelectedDates();if(q.length>0){l.removeClass(this.id+"-date-from","invalid");var p=q[0];this.widgets.calendarFrom.cfg.setProperty("pagedate",(p.getMonth()+1)+"/"+p.getFullYear());this.widgets.calendarFrom.render()}}else{l.addClass(this.id+"-date-from","invalid")}}}else{l.removeClass(this.id+"-date-from","invalid");this.currentFromDate="";this._updateCurrentValue()}},_handleFieldChangeTo:function h(s){var t=l.get(this.id+"-date-to").value;if(t.length>0){var r=Date.parseExact(t,this.msg("form.control.date-picker.entry.date.format"));if(r!=null){this.widgets.calendarTo.select((r.getMonth()+1)+"/"+r.getDate()+"/"+r.getFullYear());var q=this.widgets.calendarTo.getSelectedDates();if(q.length>0){l.removeClass(this.id+"-date-to","invalid");var p=q[0];this.widgets.calendarTo.cfg.setProperty("pagedate",(p.getMonth()+1)+"/"+p.getFullYear());this.widgets.calendarTo.render()}}else{l.addClass(this.id+"-date-to","invalid")}}else{l.removeClass(this.id+"-date-to","invalid");this.currentToDate="";this._updateCurrentValue()}}})})();