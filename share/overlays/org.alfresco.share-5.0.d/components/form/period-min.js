(function(){var d=YAHOO.util.Dom,g=YAHOO.util.Event;var c=Alfresco.util.encodeHTML;Alfresco.Period=function(j,k){this.name="Alfresco.Period";this.id=j;this.currentValueHtmlId=k;Alfresco.util.ComponentManager.register(this);Alfresco.util.YUILoaderHelper.require(["button"],this.onComponentsLoaded,this);this.widgets={};this.periodDefinitionsByType={};this.periodDefinitionsByLabel={};return this};Alfresco.Period.prototype={options:{currentValue:"",data:[],disabled:false,mandatory:false},widgets:null,periodDefinitionsByType:null,periodDefinitionsByLabel:null,setOptions:function e(j){this.options=YAHOO.lang.merge(this.options,j);return this},setMessages:function f(j){Alfresco.util.addMessages(j,this.name);return this},onComponentsLoaded:function h(){g.onContentReady(this.id,this.onReady,this,true)},onReady:function b(){for(var j=0;j<this.options.data.length;j++){this.periodDefinitionsByType[this.options.data[j].type]=this.options.data[j];this.periodDefinitionsByLabel[this.options.data[j].label]=this.options.data[j]}var l={type:"",label:this._msg("form.notset"),hasExpression:false};this.periodDefinitionsByType[l.type]=l;this.periodDefinitionsByLabel[l.label]=l;var m=this.options.currentValue.split("|"),s=this.options.currentValue,q=1;if(m.length==2){s=m[0];q=m[1]}var u=this.periodDefinitionsByType[s];if(this.options.disabled){var r=this.options.currentValue;if(u!==undefined){if(u.hasExpression){r=q+" "+u.label;if(q>1){r+="s"}}else{r=u.label}}d.get(this.id).innerHTML=c(r)}else{var n=[];for(var t in this.periodDefinitionsByType){n.push(this.periodDefinitionsByType[t].label)}n.sort();var k=null,o=d.get(this.id+"-type");for(j=0;j<n.length;j++){k=this.periodDefinitionsByLabel[n[j]];o.options[j]=new Option(k.label,k.type,s===k.type,s===k.type)}if(u!==undefined&&u.hasExpression){d.get(this.id+"-expression").value=q}}g.addListener(this.id+"-type","change",this._handleDataChange,this,true);g.addListener(this.id+"-expression","keyup",this._handleDataChange,this,true)},_handleDataChange:function i(m){var l=d.get(this.id+"-type").value,o=d.get(this.id+"-expression").value,n=l+"|"+o,k=true;if(l===""){n="";d.get(this.id+"-expression").value=""}else{var j=this.periodDefinitionsByType[l];if(j.hasExpression){if(o===""){o=1;n+=o}else{if(isNaN(o)){k=false}}}else{n=l;d.get(this.id+"-expression").value=""}}if(k){YAHOO.util.Dom.get(this.currentValueHtmlId).value=n;if(Alfresco.logger.isDebugEnabled()){Alfresco.logger.debug("Hidden field '"+this.currentValueHtmlId+"' updated to '"+n+"'")}if(this.options.mandatory){YAHOO.Bubbling.fire("mandatoryControlValueUpdated",this)}}},_msg:function a(j){return Alfresco.util.message.call(this,j,"Alfresco.Period",Array.prototype.slice.call(arguments).slice(1))}}})();