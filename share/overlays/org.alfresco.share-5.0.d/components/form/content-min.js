(function(){var f=YAHOO.util.Dom;Alfresco.ContentControl=function(i){return Alfresco.ContentControl.superclass.constructor.call(this,i,"Alfresco.ContentControl")};YAHOO.extend(Alfresco.ContentControl,Alfresco.RichTextControl,{options:{formMode:"edit",nodeRef:null,mimeType:null,plainMimeTypes:"text/plain,text/xml",richMimeTypes:"text/html,text/xhtml",imageMimeTypes:"image/jpeg,image/jpg,image/png",forceEditor:false,forceContent:false},onReady:function e(){if(Alfresco.logger.isDebugEnabled()){Alfresco.logger.debug("Rendering content control for element '"+this.id+"', value = '"+this.options.currentValue+"', nodeRef = '"+this.options.nodeRef+"', mimetype = '"+this.options.mimeType+"'");Alfresco.logger.debug("Configured plain mimetypes for element '"+this.id+"': "+this.options.plainMimeTypes);Alfresco.logger.debug("Configured rich mimetypes for element '"+this.id+"': "+this.options.richMimeTypes);Alfresco.logger.debug("Configured image mimetypes for element '"+this.id+"': "+this.options.imageMimeTypes);Alfresco.logger.debug("Editor parameters for element '"+this.id+"': "+YAHOO.lang.dump(this.options.editorParameters))}var i=this._determineMimeType();if(i!==null){if(this._isRichMimeType(i)){if(this.options.formMode==="create"){if(!this.options.disabled){this._renderEditor()}}else{this._populateContent({successCallback:{fn:function(){if(!this.options.disabled){this._renderEditor()}},scope:this}})}}else{if(this._isPlainMimeType(i)||this.options.forceEditor){this._populateContent()}else{if(this._isImageMimeType(i)){this._hideField();if(Alfresco.logger.isDebugEnabled()){Alfresco.logger.debug("Hidden field '"+this.id+"' as support for images is not completed yet")}}else{this._hideField();if(Alfresco.logger.isDebugEnabled()){Alfresco.logger.debug("Hidden field '"+this.id+"' as the content for the mimetype can not be displayed")}}}}}else{this._hideField();if(Alfresco.logger.isDebugEnabled()){Alfresco.logger.debug("Hidden field '"+this.id+"' as the mimetype is unknown")}}},_populateContent:function a(n){if(this.options.nodeRef!==null&&this.options.nodeRef.length>0){if(Alfresco.logger.isDebugEnabled()){Alfresco.logger.debug("Retrieving content for field '"+this.id+"' using nodeRef: "+this.options.nodeRef)}var l=function m(o){f.get(this.id).value=o.serverResponse.responseText;if(n&&n.successCallback){if(Alfresco.logger.isDebugEnabled()){Alfresco.logger.debug("calling callback")}n.successCallback.fn.call(n.successCallback.scope,o)}};var j=function i(o){this._hideField();if(Alfresco.logger.isDebugEnabled()){Alfresco.logger.debug("Hidden field '"+this.id+"' as content retrieval failed")}};var k=this.options.nodeRef.replace("://","/");Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"api/node/content/"+k,method:"GET",successCallback:{fn:l,scope:this},failureCallback:{fn:j,scope:this}})}else{if(this.options.formMode!=="create"){this._hideField();if(Alfresco.logger.isDebugEnabled()){Alfresco.logger.debug("Hidden field '"+this.id+"' as the nodeRef parameter is missing")}}}},_determineMimeType:function d(){var i=null;if(this.options.currentValue.indexOf("contentUrl=")===0&&this.options.currentValue.indexOf("mimetype=")!==-1){var k=this.options.currentValue.indexOf("mimetype=")+9,j=this.options.currentValue.indexOf("|",k);i=this.options.currentValue.substring(k,j)}if(this.options.mimeType!==null&&this.options.mimeType.length>0){i=this.options.mimeType}if(Alfresco.logger.isDebugEnabled()){Alfresco.logger.debug("Determined mimetype: "+i)}return i},_isRichMimeType:function c(j){var i=false;if(this.options.richMimeTypes!==null&&this.options.richMimeTypes.length>0&&this.options.richMimeTypes.indexOf(j)!=-1){i=true}if(Alfresco.logger.isDebugEnabled()){Alfresco.logger.debug("Testing whether '"+j+"' is a configured rich mimetype: "+i)}return i},_isPlainMimeType:function h(j){var i=false;if(this.options.plainMimeTypes!==null&&this.options.plainMimeTypes.length>0&&this.options.plainMimeTypes.indexOf(j)!=-1){i=true}if(Alfresco.logger.isDebugEnabled()){Alfresco.logger.debug("Testing whether '"+j+"' is a configured plain mimetype: "+i)}return i},_isImageMimeType:function b(j){var i=false;if(this.options.imageMimeTypes!==null&&this.options.imageMimeTypes.length>0&&this.options.imageMimeTypes.indexOf(j)!=-1){i=true}if(Alfresco.logger.isDebugEnabled()){Alfresco.logger.debug("Testing whether '"+j+"' is a configured image mimetype: "+i)}return i},_hideField:function g(){if(!this.options.forceContent){f.get(this.id).name="-"}f.get(this.id+"-field").style.display="none"}})})();